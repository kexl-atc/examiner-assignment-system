import{_ as a}from"./index-zMH_pf55.js";import{y as e,r as l,c as s,h as t,n,z as i,A as o,B as r,L as c,ay as d,R as v,u,E as h,P as p,Q as m,a6 as f,W as g,D as b,U as y,K as w,S as k,J as x,al as M,O as C,az as S}from"./vendor-BDY1VVdw.js";import{c as _,U as j,b as z,_ as L,C as D,a as E,H as A}from"./_plugin-vue_export-helper-C_eiSiqI.js";import{u as B,c as I}from"./useSidebarAutoCollapse-D4SkuiTF.js";import{D as O}from"./dateUtils-D_6usupf.js";import{n as R,S as T}from"./departmentNormalizer-3p5zR7gw.js";import{i as W,L as H}from"./charts-CzD5hMsp.js";import{R as P}from"./refresh-cw-BHDjJkTd.js";import{X as U}from"./x-C-vOU4IE.js";import{U as V}from"./user-BCPPRZCI.js";import"./ui-XhJlTBKO.js";import"./utils-ZMqNovHY.js";
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=_("Building2Icon",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),$={class:"teacher-distribution"},q={class:"section-header"},F={class:"section-actions"},J=["disabled"],K={class:"distribution-grid"},N={class:"chart-panel"},Q={class:"panel-header"},X={class:"panel-title"},G={class:"panel-stats"},Y={class:"stats-badge"},aa={class:"panel-content"},ea={class:"chart-wrapper"},la={key:0,class:"loading-overlay"},sa={key:0,class:"chart-legend"},ta=["onMouseenter","onClick"],na={class:"legend-label"},ia={class:"legend-count"},oa={class:"legend-percent"},ra={class:"chart-panel"},ca={class:"panel-header"},da={class:"panel-title"},va={class:"panel-content"},ua={class:"chart-wrapper"},ha={key:0,class:"loading-overlay"},pa={key:0,class:"chart-summary"},ma={class:"summary-grid"},fa={class:"summary-item"},ga={class:"summary-value"},ba={class:"summary-item"},ya={class:"summary-value"},wa={class:"summary-item"},ka={class:"summary-value"},xa={class:"modal-header"},Ma={class:"modal-title"},Ca={class:"modal-body"},Sa={class:"teacher-list"},_a={class:"teacher-avatar"},ja={class:"teacher-info"},za={class:"teacher-name"},La={class:"teacher-meta"},Da={class:"teacher-status"},Ea=z(e({__name:"TeacherDistribution",setup(e){const y=a=>a?R(a):"未分配科室",w=l(!1),k=l(),x=l(),M=l(!1),C=l({title:"",teachers:[]});l("total");let S=null,_=null;const z=l([]),L=l([]),D=l([]),E=["#667eea","#764ba2","#f093fb","#f5576c","#4facfe","#43e97b","#fa709a","#fee140","#a8edea","#d299c2"],A=s(()=>L.value.reduce((a,e)=>a+e.value,0)),B=s(()=>{if(0===D.value.length)return{name:"无",count:0};const a=D.value.reduce((a,e)=>e.value>a.value?e:a);return{name:a.name,count:a.value}}),I=s(()=>{if(0===D.value.length)return 0;return D.value.reduce((a,e)=>a+e.value,0)/D.value.length}),O=async()=>{w.value=!0;try{const{storageService:e}=await a(async()=>{const{storageService:a}=await import("./storageService-D0OTCPkh.js");return{storageService:a}},[],import.meta.url),l=await e.loadTeachers();if(l.length>0){z.value=l.map(a=>({id:a.id,name:a.name,department:a.department,group:a.group,status:a.status||"可用"}));const a=new Map;z.value.forEach(e=>{const l=y(e.department);a.set(l,(a.get(l)||0)+1)}),L.value=Array.from(a.entries()).map(([a,e])=>({name:a,value:e})).sort((a,e)=>e.value-a.value);const e=new Map;z.value.forEach(a=>{const l=a.group||"未分组",s=e.get(l)||{total:0,available:0,unavailable:0};s.total++,"可用"===a.status?s.available++:s.unavailable++,e.set(l,s)}),D.value=Array.from(e.entries()).map(([a,e])=>({name:a,value:e.total,available:e.available,unavailable:e.unavailable})).sort((a,e)=>e.value-a.value)}else L.value=[{name:"内科",value:15},{name:"外科",value:12},{name:"儿科",value:8},{name:"妇产科",value:10},{name:"急诊科",value:6}],D.value=[{name:"一组",value:13,available:11,unavailable:2},{name:"二组",value:12,available:10,unavailable:2},{name:"三组",value:11,available:9,unavailable:2},{name:"四组",value:15,available:12,unavailable:3}]}catch(e){L.value=[{name:"内科",value:15},{name:"外科",value:12},{name:"儿科",value:8},{name:"妇产科",value:10},{name:"急诊科",value:6}],D.value=[{name:"一组",value:13,available:11,unavailable:2},{name:"二组",value:12,available:10,unavailable:2},{name:"三组",value:11,available:9,unavailable:2},{name:"四组",value:15,available:12,unavailable:3}]}finally{w.value=!1}},T=()=>{if(!k.value)return;S=W(k.value);const a={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c}人 ({d}%)",backgroundColor:"rgba(50, 50, 93, 0.9)",borderColor:"transparent",textStyle:{color:"#fff",fontSize:12},borderRadius:6},legend:{show:!1},series:[{name:"科室分布",type:"pie",radius:["45%","75%"],center:["50%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:6,borderColor:"#fff",borderWidth:2,shadowBlur:8,shadowColor:"rgba(0, 0, 0, 0.1)"},label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold",color:"#333"},itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"},scale:!0,scaleSize:5},labelLine:{show:!1},data:L.value.map((a,e)=>({value:a.value,name:a.name,itemStyle:{color:E[e%E.length]}})),animationType:"scale",animationEasing:"elasticOut",animationDelay:a=>100*a}]};S.setOption(a),S.on("click",a=>{Aa(a.name)})},Ea=()=>{if(!_)return;const a=[{name:"总人数",type:"bar",data:D.value.map(a=>a.value),itemStyle:{color:new H(0,0,0,1,[{offset:0,color:"#667eea"},{offset:1,color:"#764ba2"}]),borderRadius:[6,6,0,0],shadowBlur:8,shadowColor:"rgba(102, 126, 234, 0.3)"},animationDelay:a=>100*a,barWidth:"60%"}],e={tooltip:{trigger:"axis",axisPointer:{type:"shadow",shadowStyle:{color:"rgba(102, 126, 234, 0.1)"}},backgroundColor:"rgba(50, 50, 93, 0.9)",borderColor:"transparent",textStyle:{color:"#fff",fontSize:12},borderRadius:6},grid:{left:"3%",right:"4%",bottom:"8%",top:"8%",containLabel:!0},xAxis:{type:"category",data:D.value.map(a=>a.name),axisTick:{alignWithLabel:!0,lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"#666",fontSize:12,fontWeight:500},axisLine:{lineStyle:{color:"#e0e0e0"}}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12},splitLine:{lineStyle:{color:"#f5f5f5",type:"dashed"}},axisLine:{show:!1},axisTick:{show:!1}},series:a,animationEasing:"elasticOut",animationDuration:800};_&&(_.setOption(e,!0),_.off("click"),_.on("click",a=>{Ba(null==a?void 0:a.name)}))},Aa=a=>{const e=z.value.filter(e=>y(e.department)===a);C.value={title:`${a} - 考官列表`,teachers:e},M.value=!0},Ba=a=>{const e=z.value.filter(e=>(e.group||"未分组")===a);C.value={title:`${a} - 考官列表`,teachers:e},M.value=!0},Ia=()=>{M.value=!1},Oa=async()=>{await O(),S&&T(),_&&Ea()};return t(async()=>{await O(),n(()=>{T(),x.value&&(_=W(x.value),Ea());const a=()=>{null==S||S.resize(),null==_||_.resize()};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),null==S||S.dispose(),null==_||_.dispose()}})}),(a,e)=>(o(),i("div",$,[r("div",q,[e[3]||(e[3]=d('<h2 class="section-title" data-v-088d3dfb><svg class="section-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-088d3dfb><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" data-v-088d3dfb></path><circle cx="9" cy="7" r="4" data-v-088d3dfb></circle><path d="m22 21-3-3m0 0a5.5 5.5 0 1 0-7.78-7.78 5.5 5.5 0 0 0 7.78 7.78Z" data-v-088d3dfb></path></svg> 考官分布情况 </h2>',1)),r("div",F,[r("button",{class:"action-btn",onClick:Oa,disabled:w.value},[v(u(P),{class:h(["btn-icon",{"animate-spin":w.value}])},null,8,["class"]),e[2]||(e[2]=r("span",null,"刷新数据",-1))],8,J)])]),r("div",K,[r("div",N,[r("div",Q,[r("div",X,[v(u(Z),{class:"title-icon"}),e[4]||(e[4]=r("span",null,"科室分布",-1))]),r("div",G,[r("span",Y,"共 "+p(A.value)+" 人",1)])]),r("div",aa,[r("div",ea,[r("div",{ref_key:"departmentChartRef",ref:k,class:"pie-chart-container"},null,512),w.value?(o(),i("div",la,[...e[5]||(e[5]=[r("div",{class:"loading-spinner"},null,-1),r("span",{class:"loading-text"},"加载中...",-1)])])):c("",!0)]),!w.value&&L.value.length>0?(o(),i("div",sa,[(o(!0),i(m,null,f(L.value,(a,l)=>(o(),i("div",{key:a.name,class:"legend-item",onMouseenter:a=>(a=>{S&&S.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:a})})(l),onMouseleave:e[0]||(e[0]=a=>{S&&S.dispatchAction({type:"downplay",seriesIndex:0})}),onClick:e=>Aa(a.name)},[r("div",{class:"legend-dot",style:b({backgroundColor:E[l%E.length]})},null,4),r("span",na,p(a.name),1),r("span",ia,p(a.value)+"人",1),r("span",oa,"("+p((a.value/A.value*100).toFixed(1))+"%)",1)],40,ta))),128))])):c("",!0)])]),r("div",ra,[r("div",ca,[r("div",da,[v(u(j),{class:"title-icon"}),e[6]||(e[6]=r("span",null,"班组分布",-1))])]),r("div",va,[r("div",ua,[r("div",{ref_key:"groupChartRef",ref:x,class:"bar-chart-container"},null,512),w.value?(o(),i("div",ha,[...e[7]||(e[7]=[r("div",{class:"loading-spinner"},null,-1),r("span",{class:"loading-text"},"加载中...",-1)])])):c("",!0)]),!w.value&&D.value.length>0?(o(),i("div",pa,[r("div",ma,[r("div",fa,[e[8]||(e[8]=r("span",{class:"summary-label"},"最大班组",-1)),r("span",ga,p(B.value.name)+" ("+p(B.value.count)+"人)",1)]),r("div",ba,[e[9]||(e[9]=r("span",{class:"summary-label"},"平均人数",-1)),r("span",ya,p(I.value.toFixed(1))+"人",1)]),r("div",wa,[e[10]||(e[10]=r("span",{class:"summary-label"},"班组总数",-1)),r("span",ka,p(D.value.length)+"个",1)])])])):c("",!0)])])]),M.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:Ia},[r("div",{class:"modal-content",onClick:e[1]||(e[1]=g(()=>{},["stop"]))},[r("div",xa,[r("h3",Ma,p(C.value.title),1),r("button",{class:"close-btn",onClick:Ia},[v(u(U),{class:"w-5 h-5"})])]),r("div",Ca,[r("div",Sa,[(o(!0),i(m,null,f(C.value.teachers,a=>(o(),i("div",{key:a.id,class:"teacher-item"},[r("div",_a,[v(u(V),{class:"w-6 h-6"})]),r("div",ja,[r("span",za,p(a.name),1),r("span",La,p(y(a.department))+" · "+p(a.group||"未分组"),1)]),r("div",Da,[r("span",{class:h(["status-badge","可用"===a.status?"available":"unavailable"])},p(a.status),3)])]))),128))])])])])):c("",!0)]))}}),[["__scopeId","data-v-088d3dfb"]]),Aa={class:"app-container"},Ba={class:"sidebar-header"},Ia={class:"logo-container"},Oa={class:"logo-text"},Ra={class:"sidebar-nav"},Ta={class:"nav-items"},Wa={class:"nav-text"},Ha={class:"nav-text"},Pa={class:"nav-text"},Ua={class:"nav-text"},Va={class:"sidebar-footer"},Za={class:"version-info"},$a={class:"version-number"},qa={class:"main-content"},Fa={class:"status-bar"},Ja={class:"status-left"},Ka={class:"status-info"},Na={class:"status-date"},Qa={class:"duty-section"},Xa={class:"duty-cards"},Ga=["onClick"],Ya={class:"duty-card-inner"},ae={class:"duty-icon"},ee={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},le={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},se={key:2,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},te={class:"duty-content"},ne={class:"duty-header"},ie={class:"duty-status"},oe={class:"teacher-distribution-section"},re={class:"modal-header"},ce={class:"modal-title"},de={class:"modal-body"},ve={key:0,class:"loading-state"},ue={key:1,class:"error-state"},he={key:2},pe={class:"duty-info"},me={class:"duty-group-info"},fe={key:0,class:"unavailable-notice"},ge={class:"teachers-list"},be={class:"teacher-info"},ye={class:"teacher-name"},we={class:"teacher-department"},ke={class:"teacher-status"},xe={class:"shift-info"},Me=z(e({__name:"HomePage2",setup(e){S();const{checkContentOverflowDelayed:s,cleanup:n}=B(".main-content",".dashboard-grid",()=>_.value,a=>{_.value=a}),b=l("8.0.15"),_=l(!1),z=l("");let W=null;const H=l(""),P=l([]),U=l(!1),V=l(""),Z=l(!1);l(!1),l([]),l(""),l(!1);const $=()=>{const a=new Date;z.value=O.toDateTimeString(a)},q=()=>{_.value=!_.value},F=()=>{Z.value=!1,H.value="",P.value=[],V.value=""},J=l([]);let K=null;const N=async()=>{const a=new Date;a.toDateString();const e=I(a);e.forEach(a=>{}),J.value=e};return t(async()=>{$(),W=setInterval($,1e3),N(),K=setInterval(N,36e5),s(300)}),y(()=>{W&&(clearInterval(W),W=null),K&&(clearInterval(K),K=null),n()}),(e,l)=>{var s,t;const n=M("router-link");return o(),i(m,null,[r("div",Aa,[r("aside",{class:h(["sidebar",{"sidebar-collapsed":_.value}])},[r("div",Ba,[r("div",Ia,[l[2]||(l[2]=r("div",{class:"logo-icon"},[r("img",{src:L,alt:"系统图标",class:"logo-img"})],-1)),w(r("div",Oa,[...l[1]||(l[1]=[r("h1",{class:"system-title"},"考试自动排班助手",-1),r("p",{class:"system-subtitle"},"Examiner Assignment Assistant",-1)])],512),[[k,!_.value]])])]),r("nav",Ra,[r("div",Ta,[v(n,{to:"/",class:"nav-item nav-item-active"},{default:x(()=>[v(u(A),{class:"nav-icon"}),w(r("span",Wa,"首页",512),[[k,!_.value]])]),_:1}),v(n,{to:"/teachers",class:"nav-item"},{default:x(()=>[v(u(j),{class:"nav-icon"}),w(r("span",Ha,"考官管理",512),[[k,!_.value]])]),_:1}),v(n,{to:"/instructor-assignment",class:"nav-item"},{default:x(()=>[v(u(T),{class:"nav-icon"}),w(r("span",Pa,"考官分配",512),[[k,!_.value]])]),_:1}),v(n,{to:"/schedules",class:"nav-item"},{default:x(()=>[v(u(E),{class:"nav-icon"}),w(r("span",Ua,"自动排班",512),[[k,!_.value]])]),_:1})])]),w(r("div",Va,[r("div",Za,[l[3]||(l[3]=r("span",{class:"version-label"},"版本",-1)),r("span",$a,"v"+p(b.value),1)])],512),[[k,!_.value]]),r("div",{class:"sidebar-toggle",onClick:q},[v(u(D),{class:h(["toggle-icon",{rotated:_.value}])},null,8,["class"])])],2),r("div",qa,[r("div",Fa,[r("div",Ja,[r("div",Ka,[v(u(E),{class:"status-icon"}),r("span",Na,p(z.value),1)]),l[4]||(l[4]=r("div",{class:"system-status"},[r("div",{class:"status-indicator"}),r("span",{class:"status-text"},"系统运行正常")],-1))]),l[5]||(l[5]=r("div",{class:"status-right"},null,-1))]),r("div",Qa,[l[9]||(l[9]=d('<h2 class="section-title" data-v-3f64d239><svg class="section-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3f64d239><path d="M8 2v4" data-v-3f64d239></path><path d="M16 2v4" data-v-3f64d239></path><rect width="18" height="18" x="3" y="4" rx="2" data-v-3f64d239></rect><path d="M3 10h18" data-v-3f64d239></path><path d="M8 14h.01" data-v-3f64d239></path><path d="M12 14h.01" data-v-3f64d239></path><path d="M16 14h.01" data-v-3f64d239></path><path d="M8 18h.01" data-v-3f64d239></path><path d="M12 18h.01" data-v-3f64d239></path><path d="M16 18h.01" data-v-3f64d239></path></svg> 今日执勤班次 </h2>',1)),r("div",Xa,[(o(!0),i(m,null,f(J.value,e=>(o(),i("div",{key:e.group,class:h(["duty-card",e.cardType]),onClick:l=>(async e=>{try{H.value=e,U.value=!0,V.value="";const{storageService:l}=await a(async()=>{const{storageService:a}=await import("./storageService-D0OTCPkh.js");return{storageService:a}},[],import.meta.url),s=(await l.loadTeachers()).filter(a=>a.group===e);if(0===s.length)V.value=`${e}暂无考官数据`,P.value=[];else{const a=I(new Date).find(a=>a.group===e);P.value=s.map(e=>({...e,currentShift:(null==a?void 0:a.status)||"未排班",available:"白班"!==(null==a?void 0:a.status)}))}Z.value=!0}catch(l){V.value="加载考官数据失败，请稍后重试",P.value=[],Z.value=!0}finally{U.value=!1}})(e.group)},[r("div",Ya,[r("div",ae,["白班"===e.status?(o(),i("svg",ee,[...l[6]||(l[6]=[d('<circle cx="12" cy="12" r="5" data-v-3f64d239></circle><path d="M12 1v2" data-v-3f64d239></path><path d="M12 21v2" data-v-3f64d239></path><path d="M4.22 4.22l1.42 1.42" data-v-3f64d239></path><path d="M18.36 18.36l1.42 1.42" data-v-3f64d239></path><path d="M1 12h2" data-v-3f64d239></path><path d="M21 12h2" data-v-3f64d239></path><path d="M4.22 19.78l1.42-1.42" data-v-3f64d239></path><path d="M18.36 5.64l1.42-1.42" data-v-3f64d239></path>',9)])])):"晚班"===e.status?(o(),i("svg",le,[...l[7]||(l[7]=[r("path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"},null,-1)])])):(o(),i("svg",se,[...l[8]||(l[8]=[r("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"},null,-1),r("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"},null,-1)])]))]),r("div",te,[r("div",ne,p(e.group),1),r("div",ie,p(e.status),1)])])],10,Ga))),128))])]),r("div",oe,[v(Ea)])])]),Z.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:F},[r("div",{class:"modal-content",onClick:l[0]||(l[0]=g(()=>{},["stop"]))},[r("div",re,[r("h3",ce,p(H.value)+" - 考官详情",1),r("button",{class:"modal-close",onClick:F},[...l[10]||(l[10]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("path",{d:"M18 6L6 18"}),r("path",{d:"M6 6l12 12"})],-1)])])]),r("div",de,[U.value?(o(),i("div",ve,[...l[11]||(l[11]=[r("div",{class:"loading-spinner"},null,-1),r("span",null,"加载中...",-1)])])):V.value?(o(),i("div",ue,[l[12]||(l[12]=r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[r("circle",{cx:"12",cy:"12",r:"10"}),r("path",{d:"M15 9l-6 6"}),r("path",{d:"M9 9l6 6"})],-1)),r("span",null,p(V.value),1)])):(o(),i("div",he,[r("div",pe,[r("p",me,[C(" 班组状态："+p((null==(s=P.value[0])?void 0:s.currentShift)||"未排班")+" ",1),!1===(null==(t=P.value[0])?void 0:t.available)?(o(),i("span",fe," （白班考官不可担任考官） ")):c("",!0)])]),r("div",ge,[(o(!0),i(m,null,f(P.value,a=>{return o(),i("div",{key:a.id,class:h(["teacher-card",{unavailable:!a.available}])},[r("div",be,[r("h4",ye,p(a.name),1),r("p",we,p((e=a.department,e?R(e):"未分配科室")),1),r("div",ke,[r("span",{class:h(["status-badge",a.available?"available":"unavailable"])},p(a.available?"可用":"不可用"),3),r("span",xe,p(a.currentShift),1)])])],2);var e}),128))])]))])])])):c("",!0)],64)}}}),[["__scopeId","data-v-3f64d239"]]);export{Me as default};
