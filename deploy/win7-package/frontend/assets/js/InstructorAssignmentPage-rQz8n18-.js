const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./excel-C2s3b8zA.js","./utils-ZMqNovHY.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./index-zMH_pf55.js";import{y as a,r as t,c as l,j as n,h as s,n as o,U as i,z as r,A as u,B as d,D as c,E as m,I as v,J as p,al as g,R as f,P as h,O as x,a6 as b,Q as y,l as w,K as _,S as C,u as S,L as k,a4 as D,aD as I}from"./vendor-BDY1VVdw.js";import{c as V,b as $,_ as T,C as E,H as R,U as A,a as O}from"./_plugin-vue_export-helper-C_eiSiqI.js";import{a as z,d as M,b as B,F as P}from"./dutyRotationService-BRNNznq2.js";import{a as j,b as U,c as F,d as Q,u as N}from"./ui-XhJlTBKO.js";import{a as J,n as L,S as q}from"./departmentNormalizer-3p5zR7gw.js";import{E as G}from"./excel-C2s3b8zA.js";import{T as H,U as W,S as Y}from"./upload-CaKLp6sl.js";import{D as K}from"./download-D4BHcBUS.js";import{S as X}from"./settings-Bo2u5DAq.js";import{U as Z}from"./user-BCPPRZCI.js";import{S as ee}from"./search-CnUzOAgR.js";import{R as ae}from"./refresh-cw-BHDjJkTd.js";import"./utils-ZMqNovHY.js";
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=V("DeleteIcon",[["path",{d:"M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z",key:"1oy587"}],["line",{x1:"18",x2:"12",y1:"9",y2:"15",key:"1olkx5"}],["line",{x1:"12",x2:"18",y1:"9",y2:"15",key:"1n50pc"}]]),le=V("UserPlusIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ne={run:e=>z.post("/instructor-assignment/run",e),async saveDepartmentCodes(e){try{return await z.post("/instructor-assignment/config/departments",{departments:e})}catch(a){return{success:!1,error:{message:a instanceof Error?a.message:"Unknown error"}}}},async saveInterconnectGroups(e){try{return await z.post("/instructor-assignment/config/interconnect",{groups:e})}catch(a){return{success:!1,error:{message:a instanceof Error?a.message:"Unknown error"}}}},async saveExamQuestionCount(e){try{return await z.post("/instructor-assignment/config/exam-question-count",{count:e})}catch(a){return{success:!1,error:{message:a instanceof Error?a.message:"Unknown error"}}}}},se={class:"spin-wheel-container"},oe=["width","height"],ie=$(a({__name:"SpinWheel",props:{rooms:{},roomLabels:{default:()=>[]},size:{default:400},colors:{default:()=>[]}},emits:["finished"],setup(e,{expose:a,emit:v}){const p=e,g=v,f=t(null),h=t(null),x=t(!1),b=l(()=>({"--wheel-pointer-half":`${Math.max(10,Math.round(.03*p.size))}px`,"--wheel-pointer-height":`${Math.max(18,Math.round(.065*p.size))}px`,"--wheel-center-radius":`${Math.max(22,Math.round(.06*p.size))}px`}));let y=0,w=0,_=0,C=0,S=3e3,k=0,D=null,I=-1,V=null,$=null,T="",E="";const R=e=>(e%360+360)%360,A=()=>{if($&&T===E)return;T=E,$=document.createElement("canvas"),$.width=p.size,$.height=p.size;const e=$.getContext("2d",{alpha:!1});if(!e)return;const a=p.size/2,t=p.size/2,l=p.size/2-20,n=2*Math.PI/p.rooms.length,s=p.colors.length>0?p.colors:(e=>{const a=["#4CAF50","#FFC107","#9C27B0","#2196F3","#F44336","#00BCD4","#FF5722","#795548","#607D8B","#8BC34A","#FF9800","#E91E63","#3F51B5","#009688","#CDDC39","#FFEB3B","#673AB7","#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5"],t=[];for(let l=0;l<e;l++)t.push(a[l%a.length]);return t})(p.rooms.length),o=Math.max(12,Math.round(.032*p.size));e.fillStyle="#fff",e.fillRect(0,0,p.size,p.size),e.translate(a,t);for(let i=0;i<p.rooms.length;i++){const a=i*n-Math.PI/2,t=(i+1)*n-Math.PI/2;e.beginPath(),e.moveTo(0,0),e.arc(0,0,l,a,t),e.closePath(),e.fillStyle=s[i%s.length],e.fill(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.save(),e.rotate((a+t)/2),e.translate(.7*l,0),e.rotate(Math.PI/2),e.fillStyle="#fff",e.font=`bold ${o}px "Microsoft YaHei", Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle";const r=p.roomLabels[i]||p.rooms[i];e.fillText(r,0,0),e.restore()}},O=()=>{const e=f.value;if(!e||0===p.rooms.length)return;const a=e.getContext("2d",{alpha:!1});if(!a)return;A();const t=p.size/2,l=p.size/2,n=Math.max(22,Math.round(.06*p.size));if(a.fillStyle="#fff",a.fillRect(0,0,p.size,p.size),$){a.save(),a.translate(t,l);const e=R(y);a.rotate(e*Math.PI/180),a.drawImage($,-t,-l),a.restore()}a.beginPath(),a.arc(t,l,n,0,2*Math.PI),a.fillStyle="#fff",a.fill(),a.strokeStyle="#ddd",a.lineWidth=Math.max(2,Math.round(.004*p.size)),a.stroke()};let z=!1,M=0;const B=e=>-(e+.5)*(360/p.rooms.length),P=e=>{0===k&&(k=e,M=w,V&&clearTimeout(V),V=window.setTimeout(()=>{x.value&&null!==D&&j()},6e3));const a=e-k;if(z&&w!==M){const a=1-C;_=y,M=w,S=Math.max(2e3,3e3*a),k=e,C=0,z=!1,V&&clearTimeout(V),V=window.setTimeout(()=>{x.value&&null!==D&&j()},6e3)}C=Math.min(a/S,1);const t=(l=C,1-Math.pow(1-l,4));var l;y=_+(w-_)*t,O(),C<1?D=requestAnimationFrame(P):j()},j=()=>{y=w,I>=0&&(()=>{if(I<0||0===p.rooms.length)return;const e=B(I),a=360*Math.round((y-e)/360)+e,t=360/p.rooms.length,l=Math.min(.3,.01*t);y=R(a)+l,w=y})(),x.value=!1,D&&(cancelAnimationFrame(D),D=null),V&&(clearTimeout(V),V=null),k=0,z=!1,O(),I>=0&&g("finished",I)};return a({spinTo:e=>{if(e<0||e>=p.rooms.length)return;I=e,p.rooms.length;let a=B(e);a=(a%360+360)%360;let t=a-(y%360+360)%360;for(;t<0;)t+=360;const l=y+720+t;x.value&&null!==D?(w=l,z=!0):(_=y,w=l,S=3500,C=0,k=0,x.value=!0,A(),D=requestAnimationFrame(P))},startPreparing:()=>{if(x.value)return;A(),x.value=!0,_=y,I=-1;w=y+1080,M=w,z=!1,S=4e3,C=0,k=0,o(()=>{D||(D=requestAnimationFrame(P))})}}),n(()=>[p.size,p.rooms,p.colors],()=>{E=`${p.size}|${p.rooms.join("|")}|${p.colors.join("|")}`,T="",o(()=>{A(),O()})},{deep:!0,immediate:!0}),s(()=>{o(()=>{O()})}),i(()=>{null!==D&&cancelAnimationFrame(D),null!==V&&clearTimeout(V)}),(e,a)=>(u(),r("div",se,[d("div",{class:"wheel-wrapper",ref_key:"wheelWrapper",ref:h,style:c(b.value)},[d("canvas",{ref_key:"wheelCanvas",ref:f,width:e.size,height:e.size,style:c({width:e.size+"px",height:e.size+"px"}),class:m(["wheel-canvas",{spinning:x.value}])},null,14,oe),a[0]||(a[0]=d("div",{class:"wheel-pointer"},null,-1))],4)]))}}),[["__scopeId","data-v-d6c3b2aa"]]),re={class:"dept-code-manager"},ue={class:"info-section mb-4"},de={class:"action-buttons mt-4"},ce=$(a({__name:"DepartmentCodeManager",props:{modelValue:{type:Boolean},departments:{}},emits:["update:modelValue","save"],setup(e,{emit:a}){const s=e,o=a,i=l({get:()=>s.modelValue,set:e=>o("update:modelValue",e)}),r=t([]);n(()=>s.modelValue,e=>{e&&c()}),n(()=>s.departments,()=>{s.modelValue&&c()},{deep:!0});const c=()=>{s.departments&&s.departments.length>0?r.value=s.departments.map(e=>({...e})):r.value=[{name:"一室",code:"A"},{name:"二室",code:"B"},{name:"三室",code:"C"},{name:"四室",code:"D"},{name:"五室",code:"E"},{name:"六室",code:"F"},{name:"七室",code:"G"}]},m=e=>{const a=e.code.trim().toUpperCase();if(!a)return j.warning(`科室 "${e.name}" 的代码不能为空`),e.code="",!1;if(1!==a.length||!/[A-Z]/.test(a))return j.warning(`科室代码必须是单个英文字母，当前: "${a}"`),e.code="",!1;return r.value.filter(t=>t.code===a&&t.name!==e.name).length>0?(j.warning(`代码 "${a}" 已被使用`),e.code="",!1):(e.code=a,!0)},b=async()=>{if(r.value.length>=26)j.warning("科室数量已达到上限（26个），无法继续添加（科室代码要求为单个英文字母）");else try{const{value:e}=await U.prompt("请输入新科室名称","添加科室",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"科室名称不能为空"});if(e&&e.trim()){const a=e.trim();if(r.value.some(e=>e.name===a))return void j.warning(`科室 "${a}" 已存在`);const t=new Set(r.value.map(e=>e.code));let l="A";for(let e=0;e<26;e++){const a=String.fromCharCode(65+e);if(!t.has(a)){l=a;break}}r.value.push({name:a,code:l}),j.success(`已添加科室 "${a}"，代码为 "${l}"`)}}catch{}},y=async()=>{if(r.value.length>26)j.warning("科室数量超过 26 个，无法重新生成单字母代码。请先删除部分科室。");else try{await U.confirm("确定要重新生成所有科室代码吗？这将覆盖当前的代码设置。","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=Array.from({length:26},(e,a)=>String.fromCharCode(65+a));for(let a=e.length-1;a>0;a--){const t=Math.floor(Math.random()*(a+1));[e[a],e[t]]=[e[t],e[a]]}r.value.forEach((a,t)=>{a.code=e[t]}),j.success("科室代码已重新生成")}catch{}},w=()=>{for(const e of r.value)if(!m(e))return;o("save",r.value),j.success("配置已保存"),_()},_=()=>{i.value=!1};return(e,a)=>{const t=g("el-alert"),l=g("el-table-column"),n=g("el-input"),s=g("el-button"),o=g("el-table"),c=g("el-dialog");return u(),v(c,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),title:"科室代码管理",width:"600px",onClose:_},{default:p(()=>[d("div",re,[d("div",ue,[f(t,{title:"科室代码管理",description:"您可以修改科室对应的代码。科室代码必须是单个英文字母，且不能重复。",type:"info",closable:!1})]),f(o,{data:r.value,border:"",style:{width:"100%"},"max-height":"300"},{default:p(()=>[f(l,{prop:"name",label:"科室名称",width:"200"},{default:p(e=>[d("span",null,h(e.row.name),1)]),_:1}),f(l,{prop:"code",label:"科室代码",width:"150"},{default:p(e=>[f(n,{modelValue:e.row.code,"onUpdate:modelValue":a=>e.row.code=a,maxlength:"1",style:{width:"80px"},onBlur:a=>m(e.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),f(l,{label:"操作",width:"100"},{default:p(e=>[f(s,{type:"danger",size:"small",onClick:a=>(async e=>{if(r.value.length<=2)return void j.warning("至少需要保留2个科室");const a=r.value[e];try{await U.confirm(`确定要删除科室 "${a.name}" (代码: ${a.code}) 吗？\n\n注意：删除后该科室的所有相关数据将无法恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value.splice(e,1),j.success("科室已删除")}catch{}})(e.$index),disabled:r.value.length<=2},{default:p(()=>[...a[1]||(a[1]=[x(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"]),d("div",de,[f(s,{onClick:b},{default:p(()=>[...a[2]||(a[2]=[x("添加科室",-1)])]),_:1}),f(s,{onClick:y},{default:p(()=>[...a[3]||(a[3]=[x("重新生成所有代码",-1)])]),_:1}),a[6]||(a[6]=d("div",{style:{flex:"1"}},null,-1)),f(s,{onClick:_},{default:p(()=>[...a[4]||(a[4]=[x("取消",-1)])]),_:1}),f(s,{type:"primary",onClick:w},{default:p(()=>[...a[5]||(a[5]=[x("保存配置",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-ece014f8"]]),me={class:"interconnect-settings"},ve={class:"info-section mb-4"},pe={class:"current-groups mb-4"},ge={class:"add-group-content"},fe={class:"checkbox-group"},he={class:"action-buttons mt-4"},xe=$(a({__name:"InterconnectSettings",props:{modelValue:{type:Boolean},departments:{},groups:{}},emits:["update:modelValue","save"],setup(e,{emit:a}){const s=e,o=a,i=l({get:()=>s.modelValue,set:e=>o("update:modelValue",e)}),c=l(()=>s.departments||[]),m=t([]),w=t([]);n(()=>s.modelValue,e=>{e&&_()}),n(()=>s.groups,()=>{s.modelValue&&_()},{deep:!0});const _=()=>{s.groups&&s.groups.length>0?m.value=s.groups.map(e=>({...e})):m.value=[],w.value=[]},C=()=>{if(w.value.length<2||w.value.length>3)return void j.warning("请选择2个或3个科室");const e=[...w.value].sort().join(",");if(m.value.some(a=>[...a.codes].sort().join(",")===e))return void j.warning("该互通组已存在");const a=w.value.map(e=>{const a=c.value.find(a=>a.code===e);return a?a.name:e});m.value.push({codes:[...w.value],names:a,display:a.join(" + ")}),w.value=[],j.success("互通组已添加")},S=async()=>{if(0!==m.value.length)try{await U.confirm("确定要清空所有互通组吗？","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=[],j.success("已清空所有互通组")}catch{}},k=()=>{o("save",m.value),j.success("配置已保存"),D()},D=()=>{i.value=!1};return(e,a)=>{const t=g("el-alert"),l=g("el-table-column"),n=g("el-button"),s=g("el-table"),o=g("el-checkbox"),_=g("el-card"),I=g("el-dialog");return u(),v(I,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:"科室互通设置",width:"700px",onClose:D},{default:p(()=>[d("div",me,[d("div",ve,[f(t,{title:"科室互通设置",description:"设置互通的科室将被视为一个整体。例如：三室和七室互通后，三室考生不能分配三室或七室的考官。",type:"info",closable:!1})]),d("div",pe,[a[3]||(a[3]=d("h3",{class:"text-lg font-semibold mb-2"},"当前互通组：",-1)),f(s,{data:m.value,border:"",style:{width:"100%"},"max-height":"200"},{default:p(()=>[f(l,{prop:"display",label:"互通科室"}),f(l,{label:"操作",width:"100"},{default:p(e=>[f(n,{type:"danger",size:"small",onClick:a=>(async e=>{try{await U.confirm(`确定要删除互通组 "${m.value[e].display}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value.splice(e,1),j.success("互通组已删除")}catch{}})(e.$index)},{default:p(()=>[...a[2]||(a[2]=[x(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),f(_,{class:"add-group-card"},{header:p(()=>[...a[4]||(a[4]=[d("span",null,"添加新互通组",-1)])]),default:p(()=>[d("div",ge,[a[6]||(a[6]=d("p",{class:"mb-3 text-sm text-gray-600"},"选择2个或3个科室设置为互通：",-1)),d("div",fe,[(u(!0),r(y,null,b(c.value,e=>(u(),v(o,{key:e.code,modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),label:e.code},{default:p(()=>[x(h(e.name)+" ("+h(e.code)+") ",1)]),_:2},1032,["modelValue","label"]))),128))]),f(n,{type:"success",class:"mt-3",onClick:C,disabled:w.value.length<2||w.value.length>3},{default:p(()=>[...a[5]||(a[5]=[x(" 添加互通组 ",-1)])]),_:1},8,["disabled"])])]),_:1}),d("div",he,[f(n,{type:"danger",onClick:S},{default:p(()=>[...a[7]||(a[7]=[x("清空所有",-1)])]),_:1}),a[10]||(a[10]=d("div",{style:{flex:"1"}},null,-1)),f(n,{onClick:D},{default:p(()=>[...a[8]||(a[8]=[x("取消",-1)])]),_:1}),f(n,{type:"primary",onClick:k},{default:p(()=>[...a[9]||(a[9]=[x("确定",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-bcd64b67"]]),be={class:"exam-config"},ye={class:"info-section mb-4"},we={class:"current-config-content"},_e={class:"text-lg font-bold text-blue-600"},Ce={class:"config-content"},Se={class:"spinner-section"},ke={class:"action-buttons mt-4"},De=$(a({__name:"ExamConfig",props:{modelValue:{type:Boolean},currentCount:{}},emits:["update:modelValue","save"],setup(e,{emit:a}){const s=e,o=a,i=l({get:()=>s.modelValue,set:e=>o("update:modelValue",e)}),r=t(2);n(()=>s.modelValue,e=>{e&&c()}),n(()=>s.currentCount,()=>{s.modelValue&&c()});const c=()=>{r.value=s.currentCount||2},m=()=>{r.value<1||r.value>10?j.warning("考题数量必须在1-10之间"):(o("save",r.value),j.success(`考题配置已保存！当前设置：${r.value}套考题`),b())},b=()=>{i.value=!1};return(e,a)=>{const t=g("el-alert"),l=g("el-card"),n=g("el-input-number"),s=g("el-button"),o=g("el-dialog");return u(),v(o,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:"考题配置",width:"450px",onClose:b},{default:p(()=>[d("div",be,[d("div",ye,[f(t,{title:"考题数量配置",description:"设置系统中有几套考题。分配考官二时，将从配置的考题中随机选择。",type:"info",closable:!1})]),f(l,{class:"current-config-card mb-4"},{header:p(()=>[...a[2]||(a[2]=[d("span",null,"当前配置",-1)])]),default:p(()=>[d("div",we,[d("p",_e," 当前考题数量："+h(r.value)+"套 ",1)])]),_:1}),f(l,{class:"config-card"},{header:p(()=>[...a[3]||(a[3]=[d("span",null,"设置考题数量",-1)])]),default:p(()=>[d("div",Ce,[a[6]||(a[6]=d("p",{class:"mb-3 text-sm text-gray-600"},"选择系统中的考题套数（1-10套）：",-1)),d("div",Se,[a[4]||(a[4]=d("span",{class:"mr-2"},"考题数量：",-1)),f(n,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),min:1,max:10,step:1,size:"large",style:{width:"120px"}},null,8,["modelValue"]),a[5]||(a[5]=d("span",{class:"ml-2"},"套",-1))]),a[7]||(a[7]=d("p",{class:"mt-3 text-sm text-gray-500 italic"}," 例如：设置为3套时，分配考官二时将随机分配考题一、二、三 ",-1))])]),_:1}),d("div",ke,[f(s,{onClick:b},{default:p(()=>[...a[8]||(a[8]=[x("取消",-1)])]),_:1}),f(s,{type:"primary",onClick:m},{default:p(()=>[...a[9]||(a[9]=[x("保存配置",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-eb1391ae"]]);
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=new class{analyzeDepartmentAvailability(e,a){const t=new Map,l=new Map;e.forEach(e=>{const a=this.normalizeDepartment(e.department);l.has(a)||l.set(a,[]),l.get(a).push(e)});for(const[n,s]of Array.from(l)){const e=this.analyzeSingleDepartment(s,a);t.set(n,{department:n,...e})}return t}analyzeSingleDepartment(e,a){const t=e.length;let l=1/0,n=1/0,s=0,o=0,i=0,r=0;for(const v of a){let a=0,t=0,u=0,d=0;for(const l of e){const e=l.group;if(!e||"无"===e||""===e){d++;continue}const n=M.calculateDutySchedule(v);e===n.dayShift?u++:e===n.nightShift?a++:n.restGroups.includes(e)&&t++}const c=a+t+d,m=a+t;l=Math.min(l,c),n=Math.min(n,m),s+=a,o+=t,i+=u,r+=d}const u=a.length||1,d={nightShiftCount:Math.round(s/u),restDayCount:Math.round(o/u),dayShiftCount:Math.round(i/u),noGroupCount:Math.round(r/u)};l===1/0&&(l=t,n=0);const c=t>0?l/t:0,m=this.calculatePriorityScore(t,l,n);return{totalExaminers:t,availableExaminers:l,highPriorityExaminers:n,availabilityRatio:c,priorityScore:m,recommendation:this.getRecommendationLevel(m,l),details:d}}calculatePriorityScore(e,a,t){if(0===e)return 0;const l=a/e*50,n=t/e*30,s=Math.min(2*a,20);return Math.round(l+n+s)}getRecommendationLevel(e,a){return a<1?"not_recommended":e>=70?"highly_recommended":e>=50?"recommended":e>=30?"acceptable":"not_recommended"}generateSmartRecommendation(e,a,t){const l=this.normalizeDepartment(e),n=this.analyzeDepartmentAvailability(a,t),s=n.get(l),o=[];for(const[p,g]of Array.from(n))p!==l&&this.canBeExaminer2Dept(l,p)&&o.push(g);o.sort((e,a)=>a.priorityScore-e.priorityScore);const i=[],r=[];!s||s.availableExaminers<1?i.push(`学员科室(${l})可用考官不足`):r.push(`学员科室(${l})有${s.availableExaminers}名可用考官`);const u=o[0];(!u||u.availableExaminers<1)&&i.push("其他科室可用考官不足");const d=l;r.push(`考官一推荐科室: ${d} (学员同科室，符合HC2硬约束)`);const c=(null==u?void 0:u.department)||"";c&&(r.push(`考官二推荐科室: ${c} (优先级分数: ${u.priorityScore})`),r.push(`  - 可用考官: ${u.availableExaminers}名`),r.push(`  - 高优先级考官: ${u.highPriorityExaminers}名`));const m=this.calculateConfidence(s,u),v=o.slice(1,4).map(e=>({examiner1Dept:d,examiner2Dept:e.department,confidence:this.calculateConfidence(s,e)}));return{examiner1Dept:d,examiner2Dept:c,confidence:m,reasoning:r,alternatives:v,warnings:i}}calculateConfidence(e,a){if(!e||!a)return 0;const t=(e.priorityScore+a.priorityScore)/2,l=Math.min(e.availableExaminers,a.availableExaminers);return l<1?10:l<2?Math.min(t,50):Math.min(t,95)}canBeExaminer2Dept(e,a){return e!==a}normalizeDepartment(e){return J(e)}batchGenerateRecommendations(e,a,t){const l=new Map;this.analyzeDepartmentAvailability(a,t);for(const n of e){const e=this.generateSmartRecommendation(n.department,a,t);l.set(n.id,e)}return l}generateAvailabilityReport(e,a){const t=this.analyzeDepartmentAvailability(e,a),l=Array.from(t.values()).sort((e,a)=>a.priorityScore-e.priorityScore),n=[],s=[],o=l.filter(e=>"highly_recommended"===e.recommendation),i=l.filter(e=>"not_recommended"===e.recommendation);o.length>0&&n.push(`强烈推荐科室: ${o.map(e=>e.department+"室").join("、")}`),i.length>0&&s.push(`不推荐科室: ${i.map(e=>e.department+"室").join("、")} (可用考官不足)`);const r=l.reduce((e,a)=>e+a.totalExaminers,0),u=l.reduce((e,a)=>e+a.availableExaminers,0),d=r>0?Math.round(u/r*100):0,c=`考试日期: ${a.join(" ~ ")} | 总考官: ${r}名 | 可用考官: ${u}名 | 整体可用率: ${d}%`;return d<50&&s.push(`整体可用率较低(${d}%)，建议调整考试日期`),{summary:c,details:l,recommendations:n,warnings:s}}},Ve={class:"app-container",id:"instructor-assignment-page"},$e={class:"sidebar-header"},Te={class:"logo-container"},Ee={class:"logo-text"},Re={class:"sidebar-nav"},Ae={class:"nav-items"},Oe={class:"nav-text"},ze={class:"nav-text"},Me={class:"nav-text"},Be={class:"nav-text"},Pe={class:"sidebar-footer"},je={class:"version-info"},Ue={class:"version-number"},Fe={class:"dashboard-page"},Qe={class:"page-header"},Ne={class:"header-actions"},Je={class:"bg-white rounded-lg shadow-sm p-6 mb-3"},Le={class:"flex items-center justify-between mb-4"},qe={class:"text-sm text-gray-500"},Ge={key:0,class:"student-list-container"},He=["onClick"],We={class:"student-name-simple"},Ye={class:"name-text"},Ke=["title"],Xe={key:1,class:"empty-state"},Ze={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch"},ea={class:"lg:col-span-2 bg-white rounded-lg shadow-sm p-6 flex flex-col"},aa={class:"flex flex-col items-center"},ta={class:"bg-white rounded-lg shadow-sm p-6 flex flex-col h-full"},la={class:"flex items-center justify-between mb-4 flex-shrink-0"},na={class:"mb-4 flex-1 overflow-y-auto min-h-0"},sa={class:"space-y-3"},oa={class:"flex items-center justify-between w-full"},ia={class:"info-value info-value-name text-right flex-1"},ra={class:"flex items-center justify-between w-full"},ua={class:"info-value info-value-dept text-right flex-1"},da={class:"flex items-center justify-between w-full"},ca={class:"info-value info-value-examiner1 text-right flex-1"},ma={class:"flex items-center justify-between w-full"},va={class:"info-value info-value-examiner2 text-right flex-1"},pa={class:"flex items-center justify-between w-full"},ga={class:"info-value info-value-exam text-right flex-1 relative overflow-hidden",style:{"min-height":"24px"}},fa={key:0,class:"exam-question-marquee"},ha={key:1,class:"exam-question-result"},xa={class:"flex flex-col gap-6 flex-shrink-0 mt-6"},ba={key:0,class:"text-xs text-gray-500 text-center mt-2"},ya={key:0,class:"text-green-600"},wa={key:1,class:"text-blue-600"},_a={key:2,class:"text-yellow-600"},Ca={key:3,class:"text-gray-400"},Sa={class:"history-container"},ka={class:"flex items-center justify-between mb-4"},Da={class:"mb-4"},Ia={class:"flex items-center justify-between mb-4"},Va={class:"flex items-center gap-3"},$a={class:"flex items-center gap-2"},Ta={class:"student-info-table-container"},Ea={class:"mt-4 text-sm text-gray-500"},Ra={key:0,class:"student-detail-container"},Aa={class:"detail-section"},Oa={class:"detail-grid"},za={class:"detail-item"},Ma={class:"detail-value"},Ba={class:"detail-item"},Pa={class:"detail-value"},ja={class:"detail-section"},Ua={class:"detail-grid"},Fa={class:"detail-item"},Qa={class:"detail-item"},Na={class:"detail-item"},Ja={class:"detail-item"},La={class:"detail-value"},qa={class:"detail-section"},Ga={class:"progress-container"},Ha={class:"progress-labels"},Wa={class:"mb-6"},Ya={key:0,class:"grid grid-cols-5 gap-4"},Ka={class:"info-field"},Xa={class:"info-value"},Za={class:"info-field"},et={class:"info-value"},at={class:"info-field"},tt={class:"info-value"},lt={class:"info-field"},nt={class:"info-value"},st={class:"info-field"},ot={class:"info-value"},it={key:1,class:"text-center text-gray-400 py-4"},rt={class:"flex flex-col gap-3"},ut={class:"dialog-footer"},dt={class:"dialog-footer"},ct={key:0},mt={key:1},vt={class:"mb-4"},pt={key:0,class:"mb-4"},gt={class:"error-list"},ft={key:1,class:"mb-4"},ht={class:"warning-list"},xt={class:"preview-table-container"},bt=["onClick"],yt=["onClick"],wt=["onClick"],_t={class:"mt-4 text-sm text-gray-500"},Ct={class:"dialog-footer"},St={class:"dialog-footer"},kt={class:"backup-actions mb-4"},Dt={key:0,class:"empty-state"},It="instructor_assignment_students",Vt="instructor_assignment_history",$t="instructor_assignment_logs",Tt="instructor_assignment_settings",Et="instructor_assignment_backup",Rt="instructor_assignment_admin_password",At=$(a({__name:"InstructorAssignmentPage",setup(a){const V=e=>e?L(e):"-";I();const $=t([]),z=t(""),M=l(()=>$.value.find(e=>e.name===z.value)),J=w({studentDept:"",availableRooms:[]}),se=t(""),oe=t("");t(["",""]);const re=t(new Map),ue=t(null);t(!1);const de=t(!1),me=t(!1),ve=t(""),pe=t(!1),ge=t(!1),fe=t(null),he=t(null),be=t(920),ye=t(80),we=t(80),_e=t(7);let Ce=null;const Se=t([]),ke=t([]),At=t([]),Ot=t([]),zt=t([]),Mt=t([]),Bt=w({totalStudents:0,assignedStudents:0,todayAssignments:0,totalOperations:0,actionDistribution:{}}),Pt=t([]),jt=w({hasErrors:!1,errors:[],warnings:[]}),Ut=t([]),Ft=t(!1),Qt=t(!1),Nt=w({row:-1,field:""}),Jt=t(),Lt=t("all"),qt=t("");let Gt=null,Ht=0,Wt=0;const Yt=e=>!!e&&!!(e.examiner1&&e.examiner2&&e.examQuestion),Kt=e=>{if(!e)return!1;const a=!!e.examiner1,t=!!e.examiner2,l=!!e.examQuestion;return(a||t||l)&&!Yt(e)},Xt=e=>!e||!e.examiner1&&!e.examiner2&&!e.examQuestion,Zt=e=>Yt(e)?"已完成":Kt(e)?"进行中":"待处理",el=e=>Yt(e)?"status-dot-completed":Kt(e)?"status-dot-partial":"status-dot-pending",al=e=>{if(!e)return"";const a=mn.value.find(a=>a.name===e);if(a)return a.code;const t=mn.value.find(a=>a.code===e);if(t)return t.code;const l=mn.value.find(a=>a.name.replace(/^[一二三四五六七八九十]+室/,"")===e.replace(/^[一二三四五六七八九十]+室/,"")||a.name.includes(e)||e.includes(a.name));if(l)return l.code;const n=e.match(/([一二三四五六七八九十]+)室/);if(n){const e=mn.value.find(e=>e.name===`${n[1]}室`);if(e)return e.code}return e},tl=(e,a)=>{if(!e||!a)return!1;if(e===a)return!0;const t=al(e),l=al(a);if(t===l)return!0;const n=mn.value.find(e=>e.code===t),s=mn.value.find(e=>e.code===l);if(n&&s&&n.name===s.name)return!0;const o=e.match(/([一二三四五六七八九十]+)室/),i=a.match(/([一二三四五六七八九十]+)室/);return!(!o||!i||o[1]!==i[1])},ll=e=>{if(!e)return"";const a=mn.value.find(a=>a.code===e);if(a)return a.name;const t=mn.value.find(a=>a.name===e);if(t)return t.name;const l=e.replace(/室$/,""),n=mn.value.find(e=>e.code===l);if(n)return n.name;const s=e.replace(/^区域/,""),o=mn.value.find(e=>e.name===s||e.name.replace(/^区域/,"")===s);return o?o.name:e},nl=e=>{if(!e)return"";const a=mn.value.find(a=>a.code===e||a.name===e);return a?a.name:e},sl=()=>{try{const e={departmentList:mn.value,interconnectGroups:pn.value,examQuestionCount:gn.value,availableRoomOptions:Ot.value};localStorage.setItem(Tt,JSON.stringify(e))}catch(e){}};s(()=>{(()=>{try{const e=localStorage.getItem(Tt);if(e){const a=JSON.parse(e);a.departmentList&&(mn.value=a.departmentList),a.interconnectGroups&&(pn.value=a.interconnectGroups),void 0!==a.examQuestionCount&&(gn.value=a.examQuestionCount),a.availableRoomOptions?(Ot.value=a.availableRoomOptions,J.availableRooms=[...a.availableRoomOptions]):mn.value.length>0&&(Ot.value=mn.value.map(e=>e.name),J.availableRooms=[...Ot.value])}else mn.value.length>0&&(Ot.value=mn.value.map(e=>e.name),J.availableRooms=[...Ot.value]);J.availableRooms.length>0&&(ke.value=J.availableRooms.map(e=>al(e)),At.value=J.availableRooms.map(e=>al(e)))}catch(e){mn.value.length>0&&(Ot.value=mn.value.map(e=>e.name),J.availableRooms=[...Ot.value],ke.value=Ot.value.map(e=>al(e)),At.value=Ot.value.map(e=>al(e)))}})(),Gl(),Kl(),Wl(),o(()=>{const e={sidebar:document.querySelector("#instructor-assignment-page .sidebar"),sidebarToggle:document.querySelector("#instructor-assignment-page .sidebar .sidebar-toggle"),mainContent:document.querySelector("#instructor-assignment-page .main-content"),appContainer:document.querySelector("#instructor-assignment-page")},a={sidebar:document.querySelector(".app-container .sidebar"),sidebarToggle:document.querySelector(".app-container .sidebar-toggle"),mainContent:document.querySelector(".app-container .main-content")},t=e=>{if(!e)return null;const a=window.getComputedStyle(e);return{position:a.position,zIndex:a.zIndex,overflowX:a.overflowX,overflowY:a.overflowY,rect:e.getBoundingClientRect()}},l={thisPage:{sidebar:t(e.sidebar),sidebarToggle:t(e.sidebarToggle),mainContent:t(e.mainContent),appContainer:t(e.appContainer)},homePage:{sidebar:t(a.sidebar),sidebarToggle:t(a.sidebarToggle),mainContent:t(a.mainContent)}};fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:onMounted:comparison",message:"Comparing sidebar styles between pages",data:l,timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{})}),o(()=>{const e=he.value;if(!e||"undefined"==typeof ResizeObserver)return;const a=()=>{const a=e.getBoundingClientRect(),t=a.width,l=a.height;if(!t||!l)return;const n=Math.max(920,560)+48,s=(o=Math.min(t/n,l/1136),i=.42,r=1,Math.min(r,Math.max(i,o)));var o,i,r;be.value=Math.round(920*s),ye.value=Math.round(160*s*.5),we.value=Math.round(80*s),_e.value=s<.62?5:7};a(),Ce=new ResizeObserver(()=>a()),Ce.observe(e)})}),i(()=>{null!==Ml.value&&(clearTimeout(Ml.value),Ml.value=null),Ce&&he.value&&Ce.unobserve(he.value),null==Ce||Ce.disconnect(),Ce=null});const ol=t(!1),il=t("8.0.15"),rl=()=>{ol.value=!ol.value},ul=async e=>{var a,t,l,n,s,o,i,r,u,d,c,m,v;if(fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:startSpin:entry",message:"startSpin called",data:{type:e,studentDept:J.studentDept,availableRooms:J.availableRooms,smartRec:ue.value?{examiner1Dept:ue.value.examiner1Dept,examiner2Dept:ue.value.examiner2Dept,confidence:ue.value.confidence}:null,currentStudent:null==(a=M.value)?void 0:a.name},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"A"})}).catch(()=>{}),!J.studentDept)return void j.warning("请输入考生科室代码");if(0===J.availableRooms.length)return void j.warning("请选择至少一个可用科室");Ht=e,me.value=!0,ve.value="",pe.value=!1;const p=(e=>{fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1207",message:"开始过滤可用科室",data:{type:e,studentDept:J.studentDept,examiner1:se.value,availableRoomsCount:J.availableRooms.length},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H5"})}).catch(()=>{});let a=[...J.availableRooms];const t=al(J.studentDept);if(fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1215",message:"学生科室代码",data:{studentDeptCode:t,originalStudentDept:J.studentDept},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H5"})}).catch(()=>{}),1===e&&t){fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1218",message:"考官一：开始排除学生同科室",data:{studentDeptCode:t,originalStudentDept:J.studentDept,beforeFilter:a.length,availableRooms:a,interconnectGroups:pn.value},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H5"})}).catch(()=>{});const e=pn.value.find(e=>{if(e.codes.includes(t))return!0;const a=mn.value.find(e=>e.code===t||e.name===J.studentDept);return!(!a||!e.codes.includes(a.code))||e.codes.some(e=>{const a=mn.value.find(a=>a.code===e);return a&&(a.name===J.studentDept||a.code===t)})});e&&fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1228",message:"考官一：找到互通组",data:{studentGroupCodes:e.codes,studentGroupNames:e.names},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H5"})}).catch(()=>{}),a=a.filter(a=>{var t;const l=al(a),n=a,s=tl(a,J.studentDept);let o=!1;return e&&(o=e.codes.includes(l)||e.codes.some(e=>{const a=mn.value.find(a=>a.code===e);return a&&(a.name===n||a.code===l)})||(null==(t=e.names)?void 0:t.some(e=>e===n))),!(s||o)})}if(2===e){const e=se.value?al(se.value):null;if(fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1250",message:"考官二：开始过滤",data:{examiner1Code:e,examiner1Original:se.value,studentDeptCode:t,beforeFilter:a.length},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H6"})}).catch(()=>{}),e){const t=pn.value.find(a=>{if(a.codes.includes(e))return!0;const t=mn.value.find(a=>a.code===e||a.name===se.value);return!(!t||!a.codes.includes(t.code))||a.codes.some(a=>{const t=mn.value.find(e=>e.code===a);return t&&(t.name===se.value||t.code===e)})});t&&fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1285",message:"考官二：找到考官一互通组",data:{examiner1GroupCodes:t.codes,examiner1GroupNames:t.names},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H6"})}).catch(()=>{}),a=a.filter(e=>{var a;const l=al(e),n=e,s=tl(e,se.value);let o=!1;return t&&(o=t.codes.includes(l)||t.codes.some(e=>{const a=mn.value.find(a=>a.code===e);return a&&(a.name===n||a.code===l)})||(null==(a=t.names)?void 0:a.some(e=>e===n))),!(s||o)})}if(t){fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1279",message:"考官二：开始排除学生同科室",data:{studentDeptCode:t,originalStudentDept:J.studentDept,interconnectGroups:pn.value},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H6"})}).catch(()=>{});const e=pn.value.find(e=>{if(e.codes.includes(t))return!0;const a=mn.value.find(e=>e.code===t||e.name===J.studentDept);return!(!a||!e.codes.includes(a.code))||e.codes.some(e=>{const a=mn.value.find(a=>a.code===e);return a&&(a.name===J.studentDept||a.code===t)})});e&&fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1295",message:"考官二：找到互通组",data:{studentGroupCodes:e.codes,studentGroupNames:e.names},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:"H6"})}).catch(()=>{}),a=a.filter(a=>{var t;const l=al(a),n=a,s=tl(a,J.studentDept);let o=!1;return e&&(o=e.codes.includes(l)||e.codes.some(e=>{const a=mn.value.find(a=>a.code===e);return a&&(a.name===n||a.code===l)})||(null==(t=e.names)?void 0:t.some(e=>e===n))),!(s||o)})}}return fetch("http://127.0.0.1:7245/ingest/bc33d6a7-c361-4ce6-8555-cf86753b7b19",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:1295",message:"过滤完成",data:{type:e,afterFilter:a.length,filteredRooms:a.map(e=>al(e))},timestamp:Date.now(),sessionId:"debug-session",runId:"pre-fix",hypothesisId:1===e?"H5":"H6"})}).catch(()=>{}),a.map(e=>al(e))})(e);if(0===p.length)return me.value=!1,Ht=0,void j.warning("没有可用科室满足回避规则");Se.value=p,ke.value=J.availableRooms.map(e=>al(e)),At.value=J.availableRooms.map(e=>al(e)),Wt=p.length,fe.value&&fe.value.startPreparing&&(fe.value.startPreparing(),ge.value=!0);const g=1===e?null==(t=ue.value)?void 0:t.examiner1Dept:null==(l=ue.value)?void 0:l.examiner2Dept,f={action:"suggest_assignment",student_dept:al(J.studentDept),available_rooms:p,assignment_type:e,exclude_examiner:2===e?al(se.value):void 0,preferred_room:g?al(g):void 0,recommendation_confidence:(null==(n=ue.value)?void 0:n.confidence)||0};fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:startSpin:beforeAPI",message:"完整的API请求数据",data:{type:e,formStudentDept:J.studentDept,apiStudentDept:f.student_dept,apiAvailableRooms:f.available_rooms,apiPreferredRoom:f.preferred_room,requestRoomsRaw:p,formAvailableRooms:J.availableRooms},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"VERIFY_API_DATA"})}).catch(()=>{});try{const a=await ne.run(f),t=1===e?null==(s=ue.value)?void 0:s.examiner1Dept:null==(o=ue.value)?void 0:o.examiner2Dept,l=null==(i=a.data)?void 0:i.suggested_room,n=t&&l?al(l)===al(t)?"✓ 匹配":"✗ 不匹配":"无推荐";if(fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:startSpin:apiResult",message:"API结果与推荐对比",data:{examinerType:1===e?"考官一":"考官二",apiSuggestedRoom:l,recommendedRoom:t||"无推荐",matchStatus:n,apiSuccess:a.success&&(null==(r=a.data)?void 0:r.success)},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"VERIFY_REC"})}).catch(()=>{}),a.success&&(null==(u=a.data)?void 0:u.success)&&(null==(d=a.data)?void 0:d.suggested_room)){const t=al(a.data.suggested_room),l=ke.value.findIndex(e=>al(e)===t);l>=0&&fe.value?(ge.value=!0,fe.value.spinTo(l)):(Zl(e,t,a.data.available_count||0),Se.value=[])}else me.value=!1,pe.value=!0,ve.value=(null==(c=a.data)?void 0:c.reason)||(null==(m=a.data)?void 0:m.error)||(null==(v=a.error)?void 0:v.message)||"分配失败",j.error(ve.value),Se.value=[]}catch(h){me.value=!1,pe.value=!0,ve.value=h.message||"系统错误",j.error(ve.value),Se.value=[]}},dl=e=>{ge.value=!1,me.value=!1;const a=ke.value,t=a[e];t&&Ht>0&&(Zl(Ht,t,Wt||a.length),Ht=0,Wt=0,Se.value=[])},cl=e=>{e&&(z.value=e,ml(e))},ml=e=>{if(!e)return;let a=$.value.find(a=>a.name===e);a||(a={name:e,department:J.studentDept||"",examiner1:"",examiner2:"",examQuestion:""},$.value.push(a)),J.studentDept=a.department,se.value=a.examiner1||"",oe.value=a.examiner2||""},vl=t(!1),pl=w({name:"",department:"",group:""}),gl=()=>{pl.name="",pl.department="",pl.group="",vl.value=!0},fl=async()=>{if(0!==$.value.length)try{await U.confirm(`确定要清空所有 ${$.value.length} 位考生数据吗？此操作不可恢复。`,"确认清空",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"warning"}),$.value=[],z.value="",se.value="",oe.value="",J.studentDept="",ue.value=null,localStorage.removeItem("assignment_students"),B.clearAssignmentData(),j.success("已清空所有考生数据"),jl("info","清空了所有考生数据")}catch{}else j.warning("当前没有考生数据")},hl=()=>{if(!pl.name||!pl.department||!pl.group)return void j.warning("请填写完整的考生信息");if($.value.find(e=>e.name===pl.name))return void j.warning("该考生已存在，请使用导入功能更新信息");const e={name:pl.name,department:pl.department,group:pl.group,examiner1:"",examiner2:"",examQuestion:""};$.value.push(e),ql(),Dn(),j.success(`成功添加考生：${pl.name}`),vl.value=!1,cl(pl.name)},xl=async e=>{Ut.value=[e],await bl(e.raw)},bl=async e=>{try{Ft.value=!0,Pt.value=[],jt.hasErrors=!1,jt.errors=[],jt.warnings=[];const a=e.name.endsWith(".csv"),t=e.name.endsWith(".xlsx")||e.name.endsWith(".xls");if(!a&&!t)return void j.error("不支持的文件格式，请上传 .xlsx, .xls 或 .csv 文件");let l=[];l=a?await yl(e):await wl(e),Cl(l),Pt.value=l}catch(a){j.error(a.message||"解析文件失败"),Pt.value=[]}finally{Ft.value=!1}},yl=async e=>new Promise((a,t)=>{const l=new FileReader;l.onload=e=>{var l;try{const n=(null==(l=e.target)?void 0:l.result).split("\n").filter(e=>e.trim());if(n.length<2)return void t(new Error("文件内容不足，至少需要标题行和一行数据"));const s=n[0].split(",").map(e=>e.trim().replace(/"/g,"")),o=[],i=_l(s,["姓名","名字","考生姓名","name"]),r=_l(s,["科室","部门","所在科室","department"]),u=_l(s,["所在班组","班组","组别","group"]),d=_l(s,["考官一","考官1","examiner1","第一考官"]),c=_l(s,["考官二","考官2","examiner2","第二考官"]),m=_l(s,["考题","考试题目","examQuestion","题目"]);for(let e=1;e<n.length;e++){const a=n[e].split(",").map(e=>e.trim().replace(/"/g,"")),t={name:i>=0?(a[i]||"").trim():"",department:r>=0?(a[r]||"").trim():"",group:u>=0?(a[u]||"").trim():"",examiner1:d>=0?(a[d]||"").trim():void 0,examiner2:c>=0?(a[c]||"").trim():void 0,examQuestion:m>=0?(a[m]||"").trim():void 0,_valid:{name:!1,department:!1,group:!1,all:!1}};t._valid.name=!!t.name,t._valid.department=!!t.department,t._valid.group=!!t.group,t._valid.all=t._valid.name&&t._valid.department&&t._valid.group,(t._valid.all||t.name||t.department)&&o.push(t)}a(o)}catch(n){t(n)}},l.onerror=()=>t(new Error("文件读取失败")),l.readAsText(e,"utf-8")}),wl=async a=>new Promise(async(t,l)=>{try{const n=await e(()=>import("./excel-C2s3b8zA.js").then(e=>e.x),__vite__mapDeps([0,1]),import.meta.url),s=new FileReader;s.onload=e=>{var a;try{const s=new Uint8Array(null==(a=e.target)?void 0:a.result),o=n.read(s,{type:"array"}),i=o.SheetNames[0],r=o.Sheets[i],u=n.utils.sheet_to_json(r,{header:1});if(u.length<2)return void l(new Error("Excel文件内容不足，至少需要标题行和一行数据"));const d=(u[0]||[]).map(e=>String(e||"").trim()),c=[],m=_l(d,["姓名","名字","考生姓名","name"]),v=_l(d,["科室","部门","所在科室","department"]),p=_l(d,["所在班组","班组","组别","group"]),g=_l(d,["考官一","考官1","examiner1","第一考官"]),f=_l(d,["考官二","考官2","examiner2","第二考官"]),h=_l(d,["考题","考试题目","examQuestion","题目"]);for(let e=1;e<u.length;e++){const a=u[e]||[],t={name:m>=0?String(a[m]||"").trim():"",department:v>=0?String(a[v]||"").trim():"",group:p>=0?String(a[p]||"").trim():"",examiner1:g>=0?String(a[g]||"").trim():void 0,examiner2:f>=0?String(a[f]||"").trim():void 0,examQuestion:h>=0?String(a[h]||"").trim():void 0,_valid:{name:!1,department:!1,group:!1,all:!1}};t._valid.name=!!t.name,t._valid.department=!!t.department,t._valid.group=!!t.group,t._valid.all=t._valid.name&&t._valid.department&&t._valid.group,(t._valid.all||t.name||t.department)&&c.push(t)}t(c)}catch(s){l(s)}},s.onerror=()=>l(new Error("文件读取失败")),s.readAsArrayBuffer(a)}catch(n){l(n)}}),_l=(e,a)=>{for(const t of a){const a=e.findIndex(e=>e&&(e.includes(t)||t.includes(e)||e.toLowerCase()===t.toLowerCase()));if(a>=0)return a}return-1},Cl=e=>{const a=[],t=[];e.forEach((l,n)=>{const s=n+2;if(l._valid.name||a.push(`第${s}行：姓名为空`),l._valid.department||a.push(`第${s}行：科室为空`),l._valid.group||a.push(`第${s}行：所在班组为空，请补充班组信息`),l.group&&vn.value.length>0){vn.value.some(e=>e===l.group)||t.push(`第${s}行：考生"${l.name}"的班组"${l.group}"不在预设班组列表中，将使用该值`)}if(l.department&&mn.value.length>0){mn.value.some(e=>e.name===l.department)||t.push(`第${s}行：科室"${l.department}"不在系统科室列表中，导入时将自动添加`)}const o=e.filter((e,a)=>e.name===l.name&&a!==n).length;o>0&&t.push(`第${s}行：考生"${l.name}"在导入数据中出现${o}次，可能导致数据覆盖`)}),jt.hasErrors=a.length>0,jt.errors=a,jt.warnings=t},Sl=e=>Pt.value.some(a=>!a._valid[e])?"validation-error-column":"",kl=l(()=>Pt.value.filter(e=>e._valid.all).length),Dl=()=>{Pt.value=[],Ut.value=[],jt.hasErrors=!1,jt.errors=[],jt.warnings=[],Nt.row=-1,Nt.field=""},Il=async()=>{const e=Pt.value.filter(e=>e._valid.all);if(0===e.length)return void j.warning("没有有效的数据可以导入");const a=e.filter(e=>$.value.some(a=>a.name===e.name));let t="merge";if(a.length>0||$.value.length>0)try{const l=await U.confirm(`检测到系统中已有 ${$.value.length} 条考生数据，导入数据中有 ${a.length} 条与现有数据重复。\n\n请选择导入方式：`,"导入方式选择",{confirmButtonText:"直接删除已有信息",cancelButtonText:"先存储信息，再覆盖",distinguishCancelAndClose:!0,type:"warning",showClose:!0,closeOnClickModal:!1});if("confirm"===l)try{await U.confirm(`确认删除所有 ${$.value.length} 条现有考生数据，然后导入 ${e.length} 条新数据？\n\n⚠️ 此操作不可恢复！`,"危险操作确认",{confirmButtonText:"确认删除并导入",cancelButtonText:"取消",type:"error",distinguishCancelAndClose:!0}),t="replace"}catch{return}else{if("cancel"!==l)return;try{await U.confirm(`将先备份现有 ${$.value.length} 条数据到本地存储，然后导入 ${e.length} 条新数据覆盖。\n\n备份数据可在需要时恢复。`,"备份并覆盖确认",{confirmButtonText:"确认备份并导入",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}),t="backup"}catch{return}}}catch{return}if("replace"===t)$.value=[],ql(),j.info("已清空所有现有考生数据");else if("backup"===t){const e=`students_backup_${Date.now()}`,a={timestamp:(new Date).toISOString(),count:$.value.length,data:JSON.parse(JSON.stringify($.value))};localStorage.setItem(e,JSON.stringify(a));const t=JSON.parse(localStorage.getItem(Et)||"[]");t.push({key:e,timestamp:a.timestamp,count:a.count}),localStorage.setItem(Et,JSON.stringify(t)),j.success(`已备份 ${$.value.length} 条数据，备份ID: ${e.substring(e.length-8)}`),$.value=[],ql()}const l=e.map(e=>({name:e.name,department:e.department,group:e.group,examiner1:e.examiner1&&e.examiner1.trim()?e.examiner1.trim():"",examiner2:e.examiner2&&e.examiner2.trim()?e.examiner2.trim():"",examQuestion:e.examQuestion&&e.examQuestion.trim()?e.examQuestion.trim():""}));"replace"===t||"backup"===t?l.forEach(e=>{$.value.push(e)}):l.forEach(e=>{const a=$.value.find(a=>a.name===e.name);a?(a.department=e.department,a.group=e.group,a.examiner1=e.examiner1,a.examiner2=e.examiner2,a.examQuestion=e.examQuestion):$.value.push(e)}),ql(),Dn();const n="replace"===t?"（已清空旧数据）":"backup"===t?"（已备份旧数据）":"";j.success(`成功导入 ${e.length} 条考生数据${n}`),Qt.value=!1,Dl()},Vl=(e,a)=>{Nt.row=e,Nt.field=a,o(()=>{"name"===a&&Jt.value&&Jt.value.focus()})},$l=(e,a)=>{const t=Pt.value[e];t&&(t._valid.name=!!t.name,t._valid.department=!!t.department,t._valid.group=!!t.group,t._valid.all=t._valid.name&&t._valid.department&&t._valid.group,Cl(Pt.value),Nt.row=-1,Nt.field="")},Tl=async()=>{if(0!==$.value.length)try{const e=new G.Workbook,a=e.addWorksheet("考官分配结果"),t=["姓名","科室","班组","考官一","考官二","考题"],l=a.addRow(t);l.font={bold:!0,size:14},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},l.alignment={vertical:"middle",horizontal:"center"},$.value.forEach(e=>{a.addRow([e.name,ll(e.department),e.group||"",ll(e.examiner1||""),ll(e.examiner2||""),e.examQuestion||""]).alignment={vertical:"middle",horizontal:"center"}}),a.getColumn(1).width=15,a.getColumn(2).width=12,a.getColumn(3).width=12,a.getColumn(4).width=12,a.getColumn(5).width=12,a.getColumn(6).width=10;const n=await e.xlsx.writeBuffer(),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`考官分配结果_${(new Date).toISOString().split("T")[0]}.xlsx`,o.click(),j.success("导出成功")}catch(e){j.error(e.message||"导出失败")}else j.warning("没有可导出的数据")};l(()=>["一","二","三","四","五","六","七","八","九"]);const El=l(()=>{const e=["一","二","三","四","五","六","七","八","九","十"],a=Math.max(1,Math.min(gn.value||2,e.length));return e.slice(0,a)}),Rl=t(!1),Al=t(0),Ol=t(0),zl=t([]),Ml=t(null),Bl=async()=>{if(se.value)if(M.value){me.value=!0,Rl.value=!0;try{const e=El.value;zl.value=[...e,...e,...e],Ol.value=0,Al.value=0;const a=e.map(e=>({exam:e,count:$.value.filter(a=>a.examQuestion===e).length})),t=Math.min(...a.map(e=>e.count)),l=a.filter(e=>e.count===t),n=l[Math.floor(Math.random()*l.length)].exam,s=e.indexOf(n);if(-1===s)throw new Error("无法找到选中的考题");const o=32,i=1200,r=i/60,u=e.length+s,d=(Math.floor(3*Math.random()),-u*o);let c=0;const m=Date.now(),v=()=>{c++;const e=Date.now()-m,a=Math.min(e/i,1),t=1-Math.pow(1-a,3);Al.value=d*t;const l=Math.abs(Al.value)+16,s=Math.round(l/o);if(Ol.value=s,a<1)Ml.value=window.setTimeout(v,r);else{const e=u,a=-e*o;Al.value=a,Ol.value=e,setTimeout(()=>{Rl.value=!1,M.value&&(M.value.examQuestion=n,j.success(`考题分配成功：考题${n}`),jl("success",`考题分配成功：考题${n}`),Fl(M.value.name,"分配考题",`考题${n}`,{examiner1:se.value,examiner2:oe.value}),ql(),Dn()),me.value=!1},300)}};v()}catch(e){Rl.value=!1,j.error(e.message||"分配考题失败"),jl("error",`分配考题失败：${e.message}`),me.value=!1}}else j.warning("请先选择考生");else j.warning("请先分配第一考官")};let Pl=null;const jl=(e,a)=>{const t={timestamp:Date.now(),type:e,message:a};zt.value.unshift(t),zt.value.length>100&&(zt.value=zt.value.slice(0,100)),Pl&&clearTimeout(Pl),Pl=setTimeout(()=>{Yl()},1e3)};let Ul=null;const Fl=(e,a,t,l)=>{const n={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),student:e,action:a,result:t,details:l};Mt.value.unshift(n),Mt.value.length>200&&(Mt.value=Mt.value.slice(0,200)),Ul&&clearTimeout(Ul),Ul=setTimeout(()=>{Hl()},1e3)},Ql=l(()=>{let e=Mt.value;if("all"!==Lt.value&&(e=e.filter(e=>{var a;return(null==(a={assignment:["抽取第一考官","抽取第二考官"],exam:["分配考题"],import:["导入Excel","导入考生"],export:["导出结果","导出Excel"]}[Lt.value])?void 0:a.includes(e.action))||!1})),qt.value){const a=qt.value.toLowerCase();e=e.filter(e=>e.student.toLowerCase().includes(a)||e.action.toLowerCase().includes(a)||e.result.toLowerCase().includes(a))}return e}),Nl=e=>new Date(e.timestamp).toLocaleString("zh-CN");let Jl="",Ll=0;const ql=()=>{try{const e=JSON.stringify($.value);localStorage.setItem(It,e)}catch(e){}},Gl=()=>{try{const e=localStorage.getItem(It);e&&($.value=JSON.parse(e),$.value.length>0&&!z.value&&(z.value=$.value[0].name,ml($.value[0].name)))}catch(e){}},Hl=()=>{try{localStorage.setItem(Vt,JSON.stringify(Mt.value))}catch(e){}},Wl=()=>{try{const e=localStorage.getItem(Vt);e&&(Mt.value=JSON.parse(e))}catch(e){}},Yl=()=>{try{localStorage.setItem($t,JSON.stringify(zt.value))}catch(e){}},Kl=()=>{try{const e=localStorage.getItem($t);e&&(zt.value=JSON.parse(e))}catch(e){}};let Xl=null;n($,()=>{Xl&&clearTimeout(Xl),Xl=setTimeout(()=>{ql()},500),Gt&&clearTimeout(Gt),Gt=setTimeout(()=>{(()=>{const e=(new Date).toDateString();Bt.totalStudents=$.value.length,Bt.assignedStudents=$.value.filter(e=>e.examiner1||e.examiner2).length,Jl!==e&&(Jl=e,Ll=Mt.value.filter(a=>new Date(a.timestamp).toDateString()===e&&(a.action.includes("抽取")||a.action.includes("分配"))).length),Bt.todayAssignments=Ll,Bt.totalOperations=Mt.value.length;const a={};Mt.value.slice(0,500).forEach(e=>{a[e.action]=(a[e.action]||0)+1}),Bt.actionDistribution=a})()},1e3)},{deep:!0});const Zl=(e,a,t)=>{var l,n,s,o,i,r,u;const d=al(a),c=al(1===e?(null==(l=ue.value)?void 0:l.examiner1Dept)||"":(null==(n=ue.value)?void 0:n.examiner2Dept)||""),m=ue.value&&d&&c&&d===c;fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:finishAssignment",message:"assignment finished",data:{type:e,room:a,matchesRecommendation:m,recommendedDept:1===e?null==(s=ue.value)?void 0:s.examiner1Dept:null==(o=ue.value)?void 0:o.examiner2Dept,studentName:null==(i=M.value)?void 0:i.name},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"A"})}).catch(()=>{}),1===e?(se.value=a,M.value&&(M.value.examiner1=a,M.value.examiner2="",oe.value=""),jl("success",`第一考官分配成功：${a}${m?" ✓ (符合智能推荐)":""}`),Fl((null==(r=M.value)?void 0:r.name)||"未知","抽取第一考官",a,{availableCount:t,studentDept:J.studentDept,matchesRecommendation:m})):(oe.value=a,M.value&&(M.value.examiner2=a),jl("success",`第二考官分配成功：${a}${m?" ✓ (符合智能推荐)":""}`),Fl((null==(u=M.value)?void 0:u.name)||"未知","抽取第二考官",a,{availableCount:t,studentDept:J.studentDept,examiner1:se.value,matchesRecommendation:m})),ve.value=m?`抽签成功：${a} ✓ 符合智能推荐（高可用性科室）`:`抽签成功：从 ${t} 个可用科室中随机选中`,me.value=!1,ql(),Dn()},en=()=>{const e=new Date,a=new Date(e);a.setMonth(a.getMonth()+1);const t=[],l=new Date(e);for(l.setDate(l.getDate()+1);l<=a&&t.length<10;){const e=l.getDay();if(0!==e&&6!==e){const e=l.toISOString().split("T")[0];t.push(e)}l.setDate(l.getDate()+1)}return t.slice(0,2)};n(()=>M.value,()=>{(()=>{var e,a;if(fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:generateRecommendation",message:"generateRecommendation called",data:{hasCurrentStudent:!!M.value,studentName:null==(e=M.value)?void 0:e.name,studentDept:null==(a=M.value)?void 0:a.department},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"A"})}).catch(()=>{}),M.value)try{const e=localStorage.getItem("teachers"),a=e?JSON.parse(e):[];if(fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:generateRecommendation:teachersCheck",message:"checking teachers data",data:{teachersCount:a.length,hasTeachersData:!!e,sampleTeacher:a[0]?{name:a[0].name,dept:a[0].department,group:a[0].group}:null},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"E"})}).catch(()=>{}),0===a.length)return void(ue.value=null);const t=en(),l=Ie.generateSmartRecommendation(M.value.department,a.map(e=>({name:e.name,department:e.department,group:e.group||"无"})),t);ue.value=l,l.reasoning.forEach(e=>{}),l.warnings.forEach(e=>{})}catch(t){ue.value=null}else ue.value=null})()},{immediate:!0}),s(()=>{setTimeout(()=>{(async()=>{if(!de.value){de.value=!0;try{const e=localStorage.getItem("teachers"),a=e?JSON.parse(e):[];if(0===a.length)return void(de.value=!1);const t=en(),l=Ie.analyzeDepartmentAvailability(a.map(e=>({name:e.name,department:e.department,group:e.group||"无"})),t);re.value=l;const n=Ie.generateAvailabilityReport(a.map(e=>({name:e.name,department:e.department,group:e.group||"无"})),t);n.recommendations.forEach(e=>{}),n.warnings.forEach(e=>{})}catch(e){}finally{de.value=!1}}})()},1e3)});const an=t(!1),tn=t(!1),ln=t(!1),nn=t(!1),sn=t(!1),on=t(!1),rn=t(!1),un=t(!1),dn=t(""),cn=t([]),mn=t([{name:"一室",code:"A"},{name:"二室",code:"B"},{name:"三室",code:"C"},{name:"四室",code:"D"},{name:"五室",code:"E"},{name:"六室",code:"F"},{name:"七室",code:"G"}]),vn=t(["第一组","第二组","第三组","第四组"]),pn=t([]),gn=t(2),fn=e=>{switch(e){case"template":(async()=>{try{const e=new G.Workbook,a=e.addWorksheet("考生信息"),t=["姓名","科室","所在班组","考官一","考官二","考题"],l=a.addRow(t);l.font={bold:!0,size:14},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},l.alignment={vertical:"middle",horizontal:"center"},a.getColumn(1).width=12,a.getColumn(2).width=12,a.getColumn(3).width=15,a.getColumn(4).width=12,a.getColumn(5).width=12,a.getColumn(6).width=10,[["张三","一室","第一组","","",""],["李四","二室","第二组","","",""],["王五","三室","第三组","","",""]].forEach(e=>{a.addRow(e).alignment={vertical:"middle",horizontal:"center"}});const n=await e.xlsx.writeBuffer(),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`考生信息导入模板_${(new Date).toISOString().split("T")[0]}.xlsx`,o.click(),j.success("示例文档已生成，请下载后填写考生信息")}catch(e){j.error(e.message||"生成示例文档失败")}})();break;case"assignment-settings":sn.value=!0;break;case"dept-code":an.value=!0;break;case"interconnect":tn.value=!0;break;case"exam-config":ln.value=!0;break;case"backup":hn()}},hn=()=>{localStorage.getItem(Rt)?(rn.value=!0,yn()):on.value=!0},xn=()=>{if(!dn.value||0===dn.value.trim().length)return j.warning("请输入管理员密码"),!1;const e=localStorage.getItem(Rt);return e?dn.value.trim()===e?(on.value=!1,rn.value=!0,yn(),!0):(j.error("密码错误"),!1):(localStorage.setItem(Rt,dn.value.trim()),j.success("管理员密码已设置"),on.value=!1,rn.value=!0,yn(),!0)},bn=()=>{const e={timestamp:(new Date).toISOString(),students:$.value,history:Mt.value,settings:{departmentList:mn.value,groupList:vn.value,interconnectGroups:pn.value,examQuestionCount:gn.value}},a=JSON.parse(localStorage.getItem(Et)||"[]");a.push(e),a.length>10&&a.shift(),localStorage.setItem(Et,JSON.stringify(a)),yn(),j.success("数据备份已创建")},yn=()=>{try{const e=JSON.parse(localStorage.getItem(Et)||"[]");cn.value=e.map((e,a)=>{var t;return{id:a,timestamp:new Date(e.timestamp),studentCount:(null==(t=e.students)?void 0:t.length)||0,data:e}})}catch(e){cn.value=[]}},wn=async e=>{await ul(e),await o()},_n=async()=>{await Bl(),await o()},Cn=async e=>{const a=Array.isArray(mn.value)?[...mn.value]:[];mn.value=e,sl();try{(await ne.saveDepartmentCodes(e)).success?j.success("科室代码配置已保存（已同步到服务器）"):j.success("科室代码配置已保存（本地）")}catch(n){j.success("科室代码配置已保存（本地）")}const t=new Map;e.forEach(e=>{(null==e?void 0:e.name)&&(null==e?void 0:e.code)&&t.set(String(e.name),String(e.code))});const l=new Map;a.forEach(e=>{(null==e?void 0:e.code)&&(null==e?void 0:e.name)&&l.set(String(e.code),String(e.name))}),pn.value=(pn.value||[]).map(e=>{const a=Array.isArray(null==e?void 0:e.names)&&e.names.length>0?e.names.map(e=>String(e)):Array.isArray(null==e?void 0:e.codes)?e.codes.map(e=>l.get(String(e))||String(e)):[],n=a.map(e=>t.get(e)||String(e));return{...e,names:a,codes:n,display:Array.isArray(a)?a.join(" + "):null==e?void 0:e.display}}),Ot.value=e.map(e=>e.name),J.availableRooms=[...Ot.value],sl()},Sn=async e=>{pn.value=e,sl();try{(await ne.saveInterconnectGroups(e)).success?j.success("科室互通设置已保存（已同步到服务器）"):j.success("科室互通设置已保存（本地）")}catch(a){j.success("科室互通设置已保存（本地）")}},kn=async e=>{gn.value=e,sl();try{(await ne.saveExamQuestionCount(e)).success?j.success("考题配置已保存（已同步到服务器）"):j.success("考题配置已保存（本地）")}catch(a){j.success("考题配置已保存（本地）")}},Dn=()=>{try{fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"InstructorAssignmentPage.vue:syncToSchedulePage",message:"syncToSchedulePage called",data:{studentCount:$.value.length,firstStudentData:$.value[0]?{name:$.value[0].name,department:$.value[0].department,group:$.value[0].group,examiner1:$.value[0].examiner1,examiner2:$.value[0].examiner2}:null},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"B"})}).catch(()=>{});const e=$.value.map(e=>({name:e.name,department:ll(e.department),group:e.group,examiner1:e.examiner1?ll(e.examiner1):void 0,examiner2:e.examiner2?ll(e.examiner2):void 0,examQuestion:e.examQuestion}));B.saveAssignmentData(e)}catch(e){}},In=t(""),Vn=t(""),$n=t(""),Tn=t(!1),En=t(null),Rn=l(()=>$.value.filter(e=>{const a=!In.value||e.name.toLowerCase().includes(In.value.toLowerCase()),t=!Vn.value||e.department===Vn.value,l=!$n.value||An(e)===$n.value;return a&&t&&l})),An=e=>{const a=!!e.examiner1,t=!!e.examiner2,l=!!e.examQuestion;return a&&t&&l?"completed":a||t||l?"partial":"pending"},On=e=>{switch(An(e)){case"completed":return"已完成";case"partial":return"进行中";case"pending":return"待处理";default:return"未知"}},zn=e=>{let a=0;return e.examiner1&&a++,e.examiner2&&a++,e.examQuestion&&a++,Math.round(a/3*100)},Mn=()=>{if(0===Rn.value.length)return void j.warning("没有可导出的数据");const e=Rn.value.map(e=>[e.name,ll(e.department),e.group||"-",e.examiner1?ll(e.examiner1):"-",e.examiner2?ll(e.examiner2):"-",e.examQuestion||"-",On(e)]),a=[["姓名","科室","班组","考官一","考官二","考题","状态"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),t=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=`考生信息_${(new Date).toLocaleDateString()}.csv`,l.click(),URL.revokeObjectURL(l.href),j.success(`已导出 ${Rn.value.length} 条考生信息`)};return(e,a)=>{var t,l,n,s,o,i,w,I,B,L,G;const ne=g("router-link"),oe=g("el-button"),re=g("el-dropdown-item"),ue=g("el-dropdown-menu"),de=g("el-dropdown"),ve=g("el-tag"),pe=g("el-input"),ye=g("el-option"),we=g("el-select"),_e=g("el-table-column"),Ce=g("el-table"),Se=g("el-progress"),Ie=g("el-form-item"),It=g("el-divider"),Vt=g("el-form"),$t=g("el-icon"),Tt=g("el-alert"),Rt=g("el-empty");return u(),r("div",Ve,[d("aside",{class:m(["sidebar",{"sidebar-collapsed":ol.value}])},[d("div",$e,[d("div",Te,[a[33]||(a[33]=d("div",{class:"logo-icon"},[d("img",{src:T,alt:"系统图标",class:"logo-img"})],-1)),_(d("div",Ee,[...a[32]||(a[32]=[d("h1",{class:"system-title"},"考试自动排班助手",-1),d("p",{class:"system-subtitle"},"Examiner Assignment Assistant",-1)])],512),[[C,!ol.value]])])]),d("nav",Re,[d("div",Ae,[f(ne,{to:"/",class:"nav-item"},{default:p(()=>[f(S(R),{class:"nav-icon"}),_(d("span",Oe,"首页",512),[[C,!ol.value]])]),_:1}),f(ne,{to:"/teachers",class:"nav-item"},{default:p(()=>[f(S(A),{class:"nav-icon"}),_(d("span",ze,"考官管理",512),[[C,!ol.value]])]),_:1}),f(ne,{to:"/instructor-assignment",class:"nav-item nav-item-active"},{default:p(()=>[f(S(q),{class:"nav-icon"}),_(d("span",Me,"考官分配",512),[[C,!ol.value]])]),_:1}),f(ne,{to:"/schedules",class:"nav-item"},{default:p(()=>[f(S(O),{class:"nav-icon"}),_(d("span",Be,"自动排班",512),[[C,!ol.value]])]),_:1})])]),_(d("div",Pe,[d("div",je,[a[34]||(a[34]=d("span",{class:"version-label"},"版本",-1)),d("span",Ue,"v"+h(il.value),1)])],512),[[C,!ol.value]]),d("div",{class:"sidebar-toggle",onClick:rl},[f(S(E),{class:m(["toggle-icon",{rotated:ol.value}])},null,8,["class"])])],2),d("div",{class:m(["main-content",{"sidebar-collapsed":ol.value}])},[d("div",Fe,[d("div",Qe,[a[45]||(a[45]=d("div",{class:"header-left"},[d("h1",{class:"page-title"},"考官分配")],-1)),d("div",Ne,[f(oe,{size:"small",type:"danger",plain:"",onClick:fl,disabled:0===$.value.length},{icon:p(()=>[f(S(H),{class:"w-4 h-4"})]),default:p(()=>[a[35]||(a[35]=x(" 清空考生 ",-1))]),_:1},8,["disabled"]),f(oe,{size:"small",onClick:a[0]||(a[0]=e=>Qt.value=!0)},{icon:p(()=>[f(S(W),{class:"w-4 h-4"})]),default:p(()=>[a[36]||(a[36]=x(" 导入考生信息 ",-1))]),_:1}),f(oe,{size:"small",onClick:Tl,disabled:0===$.value.length},{icon:p(()=>[f(S(K),{class:"w-4 h-4"})]),default:p(()=>[a[37]||(a[37]=x(" 导出结果 ",-1))]),_:1},8,["disabled"]),f(oe,{size:"small",onClick:gl,type:"primary"},{icon:p(()=>[f(S(le),{class:"w-4 h-4"})]),default:p(()=>[a[38]||(a[38]=x(" 添加考生 ",-1))]),_:1}),f(de,{onCommand:fn},{dropdown:p(()=>[f(ue,null,{default:p(()=>[f(re,{divided:"",command:"template"},{default:p(()=>[...a[40]||(a[40]=[x("示例文档",-1)])]),_:1}),f(re,{command:"dept-code"},{default:p(()=>[...a[41]||(a[41]=[x("科室代码管理",-1)])]),_:1}),f(re,{command:"interconnect"},{default:p(()=>[...a[42]||(a[42]=[x("科室互通设置",-1)])]),_:1}),f(re,{command:"exam-config"},{default:p(()=>[...a[43]||(a[43]=[x("考题配置",-1)])]),_:1}),f(re,{divided:"",command:"backup"},{default:p(()=>[...a[44]||(a[44]=[x("数据备份与恢复",-1)])]),_:1})]),_:1})]),default:p(()=>[f(oe,{type:"primary",plain:""},{icon:p(()=>[f(S(X),{class:"w-4 h-4"})]),default:p(()=>[a[39]||(a[39]=x(" 设置 ",-1))]),_:1})]),_:1})])]),d("div",Je,[d("div",Le,[a[46]||(a[46]=d("h2",{class:"text-lg font-semibold text-gray-900"},"考生选择",-1)),d("span",qe,"共 "+h($.value.length)+" 位考生",1)]),$.value.length>0?(u(),r("div",Ge,[(u(!0),r(y,null,b($.value,e=>(u(),r("div",{key:e.name,class:m(["student-item",{"student-item-selected":z.value===e.name,"student-item-completed":Yt(e),"student-item-partial":Kt(e),"student-item-pending":Xt(e)}]),onClick:a=>cl(e.name)},[d("div",We,[d("span",Ye,h(e.name),1),d("div",{class:m(["student-status-dot",el(e)]),title:Zt(e)},null,10,Ke)])],10,He))),128))])):(u(),r("div",Xe,[...a[47]||(a[47]=[d("p",{class:"text-gray-400 text-center py-8"},"暂无考生数据，请先导入考生信息",-1)])]))]),d("div",Ze,[d("div",ea,[a[49]||(a[49]=d("div",{class:"mb-6"},[d("h2",{class:"text-lg font-semibold text-gray-900"},"转盘抽签")],-1)),d("div",{ref_key:"wheelAreaRef",ref:he,class:"flex flex-col items-center justify-start flex-1 min-h-[560px] pt-4"},[d("div",aa,[f(ie,{ref_key:"spinWheelRef",ref:fe,rooms:ke.value,"room-labels":At.value,size:be.value,onFinished:dl},null,8,["rooms","room-labels","size"])]),a[48]||(a[48]=d("div",{class:"flex flex-col items-center mt-8"},null,-1))],512)]),d("div",ta,[d("div",la,[a[52]||(a[52]=d("h2",{class:"text-lg font-semibold text-gray-900"},"考生信息",-1)),M.value?(u(),v(ve,{key:0,type:"success",size:"small"},{default:p(()=>[...a[50]||(a[50]=[x("已选择",-1)])]),_:1})):(u(),v(ve,{key:1,type:"info",size:"small"},{default:p(()=>[...a[51]||(a[51]=[x("未选择",-1)])]),_:1}))]),d("div",na,[d("div",sa,[d("div",{class:m(["info-field info-field-vertical",{"info-field-empty":!M.value}])},[d("div",oa,[a[53]||(a[53]=d("div",{class:"info-label info-label-name"},"姓名：",-1)),d("div",ia,h((null==(t=M.value)?void 0:t.name)||"-"),1)])],2),d("div",{class:m(["info-field info-field-vertical",{"info-field-empty":!M.value}])},[d("div",ra,[a[54]||(a[54]=d("div",{class:"info-label info-label-dept"},"科室：",-1)),d("div",ua,h(V(null==(l=M.value)?void 0:l.department)),1)])],2),d("div",{class:m(["info-field info-field-vertical",{"info-field-filled":null==(n=M.value)?void 0:n.examiner1,"info-field-empty":!(null==(s=M.value)?void 0:s.examiner1)}])},[d("div",da,[a[55]||(a[55]=d("div",{class:"info-label info-label-examiner1"},"考官一：",-1)),d("div",ca,h((null==(o=M.value)?void 0:o.examiner1)||"-"),1)])],2),d("div",{class:m(["info-field info-field-vertical",{"info-field-filled":null==(i=M.value)?void 0:i.examiner2,"info-field-empty":!(null==(w=M.value)?void 0:w.examiner2)}])},[d("div",ma,[a[56]||(a[56]=d("div",{class:"info-label info-label-examiner2"},"考官二：",-1)),d("div",va,h((null==(I=M.value)?void 0:I.examiner2)||"-"),1)])],2),d("div",{class:m(["info-field info-field-vertical",{"info-field-filled":null==(B=M.value)?void 0:B.examQuestion,"info-field-empty":!(null==(L=M.value)?void 0:L.examQuestion)}])},[d("div",pa,[a[58]||(a[58]=d("div",{class:"info-label info-label-exam"},"考题：",-1)),d("div",ga,[Rl.value?(u(),r("div",fa,[a[57]||(a[57]=d("div",{class:"exam-question-indicator"},[d("div",{class:"indicator-line"})],-1)),d("div",{class:"exam-question-item",style:c({transform:`translateY(${Al.value}px)`})},[(u(!0),r(y,null,b(zl.value,(e,a)=>(u(),r("div",{key:`marquee-${a}`,class:m(["exam-question-option",{active:a===Ol.value}])}," 考题"+h(e),3))),128))],4)])):(u(),r("div",ha,h((null==(G=M.value)?void 0:G.examQuestion)?`考题${M.value.examQuestion}`:"-"),1))])])],2)])]),d("div",xa,[f(oe,{type:"primary",size:"large",class:"action-btn-vertical action-btn-gradient action-btn-primary-gradient",onClick:a[1]||(a[1]=e=>ul(1)),loading:me.value||ge.value,disabled:!J.studentDept||0===J.availableRooms.length||!M.value,title:M.value?J.studentDept?"":"请设置考生科室代码":"请先选择考生"},{icon:p(()=>[f(S(Z),{class:"w-4 h-4"})]),default:p(()=>[a[59]||(a[59]=x(" 考官一 ",-1))]),_:1},8,["loading","disabled","title"]),f(oe,{type:"success",size:"large",class:"action-btn-vertical action-btn-gradient action-btn-success-gradient",onClick:a[2]||(a[2]=e=>ul(2)),loading:me.value||ge.value,disabled:!se.value||!J.studentDept||!M.value,title:M.value?se.value?"":"请先分配第一考官":"请先选择考生"},{icon:p(()=>[f(S(A),{class:"w-4 h-4"})]),default:p(()=>[a[60]||(a[60]=x(" 考官二 ",-1))]),_:1},8,["loading","disabled","title"]),f(oe,{type:"warning",size:"large",class:"action-btn-vertical action-btn-gradient action-btn-warning-gradient",onClick:Bl,loading:me.value,disabled:!se.value||!M.value,title:M.value?se.value?"":"请先分配第一考官":"请先选择考生"},{icon:p(()=>[f(S(P),{class:"w-4 h-4"})]),default:p(()=>[a[61]||(a[61]=x(" 考题 ",-1))]),_:1},8,["loading","disabled","title"]),M.value?(u(),r("div",ba,[M.value.examiner1&&M.value.examiner2&&M.value.examQuestion?(u(),r("span",ya," ✓ 分配完成 ")):M.value.examiner1&&M.value.examiner2?(u(),r("span",wa," ⏳ 待分配考题 ")):M.value.examiner1?(u(),r("span",_a," ⏳ 待分配考官二 ")):(u(),r("span",Ca," ⏳ 待开始分配 "))])):k("",!0)])])])])],2),f(S(F),{modelValue:un.value,"onUpdate:modelValue":a[5]||(a[5]=e=>un.value=e),title:"历史记录",width:"800px"},{default:p(()=>[d("div",Sa,[d("div",ka,[f(pe,{modelValue:qt.value,"onUpdate:modelValue":a[3]||(a[3]=e=>qt.value=e),placeholder:"搜索历史记录...",style:{width:"300px"},clearable:""},{prefix:p(()=>[f(S(ee),{class:"w-4 h-4"})]),_:1},8,["modelValue"]),f(we,{modelValue:Lt.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Lt.value=e),style:{width:"150px"},placeholder:"筛选类型"},{default:p(()=>[f(ye,{label:"全部",value:"all"}),f(ye,{label:"抽签操作",value:"assignment"}),f(ye,{label:"考题分配",value:"exam"}),f(ye,{label:"数据导入",value:"import"}),f(ye,{label:"数据导出",value:"export"})]),_:1},8,["modelValue"])]),f(Ce,{data:Ql.value,style:{width:"100%"},"max-height":"400"},{default:p(()=>[f(_e,{prop:"timestamp",label:"时间",width:"180",formatter:Nl}),f(_e,{prop:"student",label:"考生",width:"120"}),f(_e,{prop:"action",label:"操作",width:"120"}),f(_e,{prop:"result",label:"结果"}),f(_e,{label:"操作",width:"100"},{default:p(e=>[f(oe,{size:"small",onClick:a=>{return t=e.row,void j.info(`查看详情：${t.student} - ${t.action} - ${t.result}`);var t}},{default:p(()=>[...a[62]||(a[62]=[x("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),f(ce,{modelValue:an.value,"onUpdate:modelValue":a[6]||(a[6]=e=>an.value=e),departments:mn.value,onSave:Cn},null,8,["modelValue","departments"]),f(xe,{modelValue:tn.value,"onUpdate:modelValue":a[7]||(a[7]=e=>tn.value=e),departments:mn.value,groups:pn.value,onSave:Sn},null,8,["modelValue","departments","groups"]),f(De,{modelValue:ln.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ln.value=e),"current-count":gn.value,onSave:kn},null,8,["modelValue","current-count"]),f(S(F),{modelValue:nn.value,"onUpdate:modelValue":a[12]||(a[12]=e=>nn.value=e),title:"考生信息管理",width:"1000px","close-on-click-modal":!1},{default:p(()=>[d("div",Da,[d("div",Ia,[d("div",Va,[f(pe,{modelValue:In.value,"onUpdate:modelValue":a[9]||(a[9]=e=>In.value=e),placeholder:"搜索考生姓名...",style:{width:"200px"},clearable:""},{prefix:p(()=>[f(S(ee),{class:"w-4 h-4"})]),_:1},8,["modelValue"]),f(we,{modelValue:Vn.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Vn.value=e),style:{width:"150px"},placeholder:"筛选科室",clearable:""},{default:p(()=>[f(ye,{label:"全部科室",value:""}),(u(!0),r(y,null,b(mn.value,e=>(u(),v(ye,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(we,{modelValue:$n.value,"onUpdate:modelValue":a[11]||(a[11]=e=>$n.value=e),style:{width:"150px"},placeholder:"筛选状态",clearable:""},{default:p(()=>[f(ye,{label:"全部状态",value:""}),f(ye,{label:"已完成",value:"completed"}),f(ye,{label:"进行中",value:"partial"}),f(ye,{label:"待处理",value:"pending"})]),_:1},8,["modelValue"])]),d("div",$a,[f(oe,{size:"small",onClick:Mn,disabled:0===Rn.value.length},{icon:p(()=>[f(S(K),{class:"w-4 h-4"})]),default:p(()=>[a[63]||(a[63]=x(" 导出数据 ",-1))]),_:1},8,["disabled"])])])]),d("div",Ta,[f(Ce,{data:Rn.value,border:"",stripe:"","max-height":"500",style:{width:"100%"}},{default:p(()=>[f(_e,{prop:"name",label:"姓名",width:"120",fixed:"left"}),f(_e,{prop:"department",label:"科室",width:"120"}),f(_e,{prop:"group",label:"班组",width:"100"},{default:p(e=>[d("span",{class:m({"text-success":e.row.group})},h(e.row.group||"-"),3)]),_:1}),f(_e,{prop:"examiner1",label:"考官一",width:"120"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examiner1})},h(e.row.examiner1||"-"),3)]),_:1}),f(_e,{prop:"examiner2",label:"考官二",width:"120"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examiner2})},h(e.row.examiner2||"-"),3)]),_:1}),f(_e,{prop:"examQuestion",label:"考题",width:"100"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examQuestion})},h(e.row.examQuestion||"-"),3)]),_:1}),f(_e,{label:"状态",width:"100"},{default:p(e=>[f(ve,{type:An(e.row),size:"small"},{default:p(()=>[x(h(On(e.row)),1)]),_:2},1032,["type"])]),_:1}),f(_e,{label:"操作",width:"120",fixed:"right"},{default:p(e=>[f(oe,{size:"small",type:"primary",text:"",onClick:a=>{return t=e.row,En.value=t,void(Tn.value=!0);var t}},{default:p(()=>[...a[64]||(a[64]=[x(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),d("div",Ea,[d("p",null,"共 "+h($.value.length)+" 位考生，显示 "+h(Rn.value.length)+" 位",1)])]),_:1},8,["modelValue"]),f(S(F),{modelValue:Tn.value,"onUpdate:modelValue":a[13]||(a[13]=e=>Tn.value=e),title:"考生详情",width:"600px","close-on-click-modal":!1},{default:p(()=>[En.value?(u(),r("div",Ra,[d("div",Aa,[a[67]||(a[67]=d("h3",{class:"detail-section-title"},"基本信息",-1)),d("div",Oa,[d("div",za,[a[65]||(a[65]=d("div",{class:"detail-label"},"姓名",-1)),d("div",Ma,h(En.value.name),1)]),d("div",Ba,[a[66]||(a[66]=d("div",{class:"detail-label"},"科室",-1)),d("div",Pa,h(V(En.value.department)),1)])])]),d("div",ja,[a[72]||(a[72]=d("h3",{class:"detail-section-title"},"分配信息",-1)),d("div",Ua,[d("div",Fa,[a[68]||(a[68]=d("div",{class:"detail-label"},"考官一",-1)),d("div",{class:m(["detail-value",{"text-success":En.value.examiner1,"text-gray-400":!En.value.examiner1}])},h(En.value.examiner1||"未分配"),3)]),d("div",Qa,[a[69]||(a[69]=d("div",{class:"detail-label"},"考官二",-1)),d("div",{class:m(["detail-value",{"text-success":En.value.examiner2,"text-gray-400":!En.value.examiner2}])},h(En.value.examiner2||"未分配"),3)]),d("div",Na,[a[70]||(a[70]=d("div",{class:"detail-label"},"考题",-1)),d("div",{class:m(["detail-value",{"text-success":En.value.examQuestion,"text-gray-400":!En.value.examQuestion}])},h(En.value.examQuestion||"未分配"),3)]),d("div",Ja,[a[71]||(a[71]=d("div",{class:"detail-label"},"状态",-1)),d("div",La,[f(ve,{type:An(En.value),size:"small"},{default:p(()=>[x(h(On(En.value)),1)]),_:1},8,["type"])])])])]),d("div",qa,[a[73]||(a[73]=d("h3",{class:"detail-section-title"},"完成进度",-1)),d("div",Ga,[f(Se,{percentage:zn(En.value),status:100===zn(En.value)?"success":void 0},null,8,["percentage","status"]),d("div",Ha,[d("span",{class:m(["progress-label",{completed:!!En.value.examiner1}])}," 考官一 ",2),d("span",{class:m(["progress-label",{completed:!!En.value.examiner2}])}," 考官二 ",2),d("span",{class:m(["progress-label",{completed:!!En.value.examQuestion}])}," 考题 ",2)])])])])):k("",!0)]),_:1},8,["modelValue"]),f(S(F),{modelValue:sn.value,"onUpdate:modelValue":a[20]||(a[20]=e=>sn.value=e),title:"抽签参数设置",width:"800px","close-on-click-modal":!1},{footer:p(()=>[d("span",ut,[f(oe,{onClick:a[19]||(a[19]=e=>sn.value=!1)},{default:p(()=>[...a[84]||(a[84]=[x("关闭",-1)])]),_:1})])]),default:p(()=>[d("div",Wa,[a[79]||(a[79]=d("h3",{class:"text-lg font-semibold text-gray-900 mb-4 text-center"},"考生信息",-1)),M.value?(u(),r("div",Ya,[d("div",Ka,[a[74]||(a[74]=d("div",{class:"info-label text-green-600"},"姓名：",-1)),d("div",Xa,h(M.value.name||"-"),1)]),d("div",Za,[a[75]||(a[75]=d("div",{class:"info-label text-blue-600"},"科室：",-1)),d("div",et,h(V(M.value.department)),1)]),d("div",at,[a[76]||(a[76]=d("div",{class:"info-label text-green-600"},"考官一：",-1)),d("div",tt,h(M.value.examiner1||"-"),1)]),d("div",lt,[a[77]||(a[77]=d("div",{class:"info-label text-purple-600"},"考官二：",-1)),d("div",nt,h(M.value.examiner2||"-"),1)]),d("div",st,[a[78]||(a[78]=d("div",{class:"info-label text-orange-600"},"考题：",-1)),d("div",ot,h(M.value.examQuestion||"-"),1)])])):(u(),r("div",it," 请先选择考生 "))]),f(Vt,{model:J,"label-position":"top",size:"large"},{default:p(()=>[f(Ie,{label:"考生科室代码"},{default:p(()=>{var e;return[f(pe,{modelValue:J.studentDept,"onUpdate:modelValue":a[14]||(a[14]=e=>J.studentDept=e),placeholder:"请输入考生所在科室代码",value:(null==(e=M.value)?void 0:e.department)||J.studentDept,onInput:a[15]||(a[15]=e=>J.studentDept=e)},null,8,["modelValue","value"])]}),_:1}),f(Ie,{label:"可用考官科室池"},{default:p(()=>[f(we,{modelValue:J.availableRooms,"onUpdate:modelValue":a[16]||(a[16]=e=>J.availableRooms=e),multiple:"",placeholder:"请选择参与抽签的科室",style:{width:"100%"},"tag-type":"primary","collapse-tags":"","collapse-tags-tooltip":""},{default:p(()=>[(u(!0),r(y,null,b(Ot.value,e=>(u(),v(ye,{key:e,label:nl(e),value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(It,{"content-position":"left"},{default:p(()=>[...a[80]||(a[80]=[x("操作区域",-1)])]),_:1}),d("div",rt,[f(oe,{type:"primary",size:"large",class:"w-full",onClick:a[17]||(a[17]=e=>wn(1)),loading:me.value||ge.value,disabled:!J.studentDept||0===J.availableRooms.length},{icon:p(()=>[f(S(Z),{class:"w-4 h-4"})]),default:p(()=>[a[81]||(a[81]=x(" 抽取第一考官 ",-1))]),_:1},8,["loading","disabled"]),f(oe,{type:"success",size:"large",class:"w-full",onClick:a[18]||(a[18]=e=>wn(2)),loading:me.value||ge.value,disabled:!se.value||!J.studentDept},{icon:p(()=>[f(S(A),{class:"w-4 h-4"})]),default:p(()=>[a[82]||(a[82]=x(" 抽取第二考官 ",-1))]),_:1},8,["loading","disabled"]),f(oe,{type:"warning",size:"large",class:"w-full",onClick:_n,loading:me.value,disabled:!se.value},{icon:p(()=>[f(S(P),{class:"w-4 h-4"})]),default:p(()=>[a[83]||(a[83]=x(" 分配考题 ",-1))]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])]),_:1},8,["modelValue"]),f(S(F),{modelValue:vl.value,"onUpdate:modelValue":a[25]||(a[25]=e=>vl.value=e),title:"添加考生",width:"500px","close-on-click-modal":!1},{footer:p(()=>[d("span",dt,[f(oe,{onClick:a[24]||(a[24]=e=>vl.value=!1)},{default:p(()=>[...a[85]||(a[85]=[x("取消",-1)])]),_:1}),f(oe,{type:"primary",onClick:hl,disabled:!pl.name||!pl.department||!pl.group},{default:p(()=>[...a[86]||(a[86]=[x(" 确定 ",-1)])]),_:1},8,["disabled"])])]),default:p(()=>[f(Vt,{model:pl,"label-width":"100px","label-position":"left"},{default:p(()=>[f(Ie,{label:"姓名",required:""},{default:p(()=>[f(pe,{modelValue:pl.name,"onUpdate:modelValue":a[21]||(a[21]=e=>pl.name=e),placeholder:"请输入考生姓名",clearable:""},null,8,["modelValue"])]),_:1}),f(Ie,{label:"科室",required:""},{default:p(()=>[f(we,{modelValue:pl.department,"onUpdate:modelValue":a[22]||(a[22]=e=>pl.department=e),placeholder:"请选择科室",style:{width:"100%"},filterable:""},{default:p(()=>[(u(!0),r(y,null,b(mn.value,e=>(u(),v(ye,{key:e.code,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(Ie,{label:"所在班组",required:""},{default:p(()=>[f(we,{modelValue:pl.group,"onUpdate:modelValue":a[23]||(a[23]=e=>pl.group=e),placeholder:"请选择所在班组",style:{width:"100%"},filterable:"","allow-create":"","default-first-option":""},{default:p(()=>[(u(!0),r(y,null,b(vn.value,e=>(u(),v(ye,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),f(S(F),{modelValue:Qt.value,"onUpdate:modelValue":a[27]||(a[27]=e=>Qt.value=e),title:"导入考生数据",width:"900px","close-on-click-modal":!1},{footer:p(()=>[d("span",Ct,[f(oe,{onClick:Dl},{default:p(()=>[...a[90]||(a[90]=[x("重新选择",-1)])]),_:1}),f(oe,{onClick:a[26]||(a[26]=e=>Qt.value=!1)},{default:p(()=>[...a[91]||(a[91]=[x("取消",-1)])]),_:1}),f(oe,{type:"primary",onClick:Il,loading:Ft.value,disabled:!Pt.value||0===Pt.value.length||jt.hasErrors},{default:p(()=>[...a[92]||(a[92]=[x(" 确认导入 ",-1)])]),_:1},8,["loading","disabled"])])]),default:p(()=>[Pt.value&&0!==Pt.value.length?(u(),r("div",mt,[d("div",vt,[f(Tt,{type:jt.hasErrors?"error":"success",title:jt.hasErrors?`发现 ${jt.errors.length} 个错误`:`成功解析 ${Pt.value.length} 条考生数据`,closable:!1,"show-icon":""},null,8,["type","title"])]),jt.errors.length>0?(u(),r("div",pt,[f(Tt,{type:"error",title:"数据验证错误",closable:!1},{default:p(()=>[d("ul",gt,[(u(!0),r(y,null,b(jt.errors,(e,a)=>(u(),r("li",{key:a},h(e),1))),128))])]),_:1})])):k("",!0),jt.warnings.length>0?(u(),r("div",ft,[f(Tt,{type:"warning",title:"数据警告",closable:!1},{default:p(()=>[d("ul",ht,[(u(!0),r(y,null,b(jt.warnings,(e,a)=>(u(),r("li",{key:a},h(e),1))),128))])]),_:1})])):k("",!0),d("div",xt,[f(Ce,{data:Pt.value,border:"",stripe:"","max-height":"400",style:{width:"100%"}},{default:p(()=>[f(_e,{prop:"name",label:"姓名",width:"120","class-name":Sl("name")},{default:p(e=>[Nt.row===e.$index&&"name"===Nt.field?(u(),v(pe,{key:0,modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a,size:"small",onBlur:a=>$l(e.$index),onKeyup:D(a=>$l(e.$index),["enter"]),ref_key:"nameInputRef",ref:Jt,class:m({"input-error":!e.row._valid.name})},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup","class"])):(u(),r("span",{key:1,class:m({"text-error":!e.row._valid.name,"editable-cell":!0}),onClick:a=>Vl(e.$index,"name")},[x(h(e.row.name||"(空)")+" ",1),f($t,{class:"edit-icon"},{default:p(()=>[f(S(Y))]),_:1})],10,bt))]),_:1},8,["class-name"]),f(_e,{prop:"department",label:"科室",width:"130","class-name":Sl("department")},{default:p(e=>[Nt.row===e.$index&&"department"===Nt.field?(u(),v(we,{key:0,modelValue:e.row.department,"onUpdate:modelValue":a=>e.row.department=a,size:"small",filterable:"","allow-create":"",onBlur:a=>$l(e.$index),onChange:a=>$l(e.$index),class:m({"input-error":!e.row._valid.department})},{default:p(()=>[(u(!0),r(y,null,b(mn.value,e=>(u(),v(ye,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onBlur","onChange","class"])):(u(),r("span",{key:1,class:m({"text-error":!e.row._valid.department,"editable-cell":!0}),onClick:a=>Vl(e.$index,"department")},[x(h(e.row.department||"(空)")+" ",1),f($t,{class:"edit-icon"},{default:p(()=>[f(S(Y))]),_:1})],10,yt))]),_:1},8,["class-name"]),f(_e,{prop:"group",label:"班组",width:"100","class-name":Sl("group")},{default:p(e=>[Nt.row===e.$index&&"group"===Nt.field?(u(),v(we,{key:0,modelValue:e.row.group,"onUpdate:modelValue":a=>e.row.group=a,size:"small",filterable:"","allow-create":"",onBlur:a=>$l(e.$index),onChange:a=>$l(e.$index),class:m({"input-error":!e.row._valid.group})},{default:p(()=>[(u(!0),r(y,null,b(vn.value,e=>(u(),v(ye,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","onBlur","onChange","class"])):(u(),r("span",{key:1,class:m({"text-error":!e.row._valid.group,"editable-cell":!0}),onClick:a=>Vl(e.$index,"group")},[x(h(e.row.group||"(空)")+" ",1),f($t,{class:"edit-icon"},{default:p(()=>[f(S(Y))]),_:1})],10,wt))]),_:1},8,["class-name"]),f(_e,{prop:"examiner1",label:"考官一",width:"90",align:"center"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examiner1})},h(e.row.examiner1||"-"),3)]),_:1}),f(_e,{prop:"examiner2",label:"考官二",width:"90",align:"center"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examiner2})},h(e.row.examiner2||"-"),3)]),_:1}),f(_e,{prop:"examQuestion",label:"考题",width:"80",align:"center"},{default:p(e=>[d("span",{class:m({"text-success":e.row.examQuestion})},h(e.row.examQuestion||"-"),3)]),_:1}),f(_e,{label:"状态",width:"80",align:"center"},{default:p(e=>[f(ve,{type:e.row._valid.all?"success":"danger",size:"small"},{default:p(()=>[x(h(e.row._valid.all?"有效":"无效"),1)]),_:2},1032,["type"])]),_:1}),f(_e,{label:"操作",width:"80",fixed:"right"},{default:p(e=>[f(oe,{type:"danger",size:"small",text:"",onClick:a=>{return t=e.$index,Pt.value.splice(t,1),Cl(Pt.value),void(Nt.row===t?(Nt.row=-1,Nt.field=""):Nt.row>t&&Nt.row--);var t}},{default:p(()=>[f($t,null,{default:p(()=>[f(S(te))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),d("div",_t,[d("p",null,"共 "+h(Pt.value.length)+" 条数据，其中有效数据 "+h(kl.value)+" 条，无效数据 "+h(Pt.value.length-kl.value)+" 条",1),a[89]||(a[89]=d("p",{class:"mt-1 text-blue-600"},"提示：点击表格中的单元格可直接编辑缺失信息，红色标记表示必填字段为空",-1))])])):(u(),r("div",ct,[f(S(Q),{class:"upload-demo",drag:"","auto-upload":!1,"on-change":xl,"file-list":Ut.value,accept:".xlsx,.xls,.csv"},{tip:p(()=>[...a[87]||(a[87]=[d("div",{class:"el-upload__tip"},[x(" 支持 .xlsx, .xls, .csv 格式文件"),d("br"),d("strong",null,"必填字段："),x("姓名、科室、所在班组"),d("br"),d("strong",null,"可选字段："),x("考官一、考官二、考题 ")],-1)])]),default:p(()=>[f($t,{class:"el-icon--upload"},{default:p(()=>[f(S(N))]),_:1}),a[88]||(a[88]=d("div",{class:"el-upload__text"},[x(" 将文件拖到此处，或"),d("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]))]),_:1},8,["modelValue"]),f(S(F),{modelValue:on.value,"onUpdate:modelValue":a[30]||(a[30]=e=>on.value=e),title:"管理员身份验证",width:"400px","close-on-click-modal":!1},{footer:p(()=>[d("span",St,[f(oe,{onClick:a[29]||(a[29]=e=>on.value=!1)},{default:p(()=>[...a[93]||(a[93]=[x("取消",-1)])]),_:1}),f(oe,{type:"primary",onClick:xn},{default:p(()=>[...a[94]||(a[94]=[x("确认",-1)])]),_:1})])]),default:p(()=>[f(Vt,{"label-position":"top"},{default:p(()=>[f(Ie,{label:"管理员密码"},{default:p(()=>[f(pe,{modelValue:dn.value,"onUpdate:modelValue":a[28]||(a[28]=e=>dn.value=e),type:"password",placeholder:"请输入管理员密码","show-password":"",onKeyup:D(xn,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),f(S(F),{modelValue:rn.value,"onUpdate:modelValue":a[31]||(a[31]=e=>rn.value=e),title:"数据备份与恢复",width:"900px","close-on-click-modal":!1},{default:p(()=>[d("div",kt,[f(oe,{type:"primary",onClick:bn},{icon:p(()=>[f(S(K),{class:"w-4 h-4"})]),default:p(()=>[a[95]||(a[95]=x(" 创建备份 ",-1))]),_:1}),a[96]||(a[96]=d("span",{class:"text-sm text-gray-500 ml-2"},"最多保留10个备份，超过后自动删除最早的备份",-1))]),f(Ce,{data:cn.value,border:"",stripe:"","max-height":"400",style:{width:"100%"}},{default:p(()=>[f(_e,{prop:"id",label:"序号",width:"80"}),f(_e,{label:"备份时间",width:"180"},{default:p(e=>[x(h(e.row.timestamp.toLocaleString()),1)]),_:1}),f(_e,{prop:"studentCount",label:"考生数量",width:"120"}),f(_e,{label:"操作",width:"300"},{default:p(e=>[f(oe,{size:"small",type:"primary",onClick:a=>{return t=e.row,void U.confirm(`确认恢复 ${t.timestamp.toLocaleString()} 的备份？当前数据将被覆盖。`,"恢复备份",{confirmButtonText:"确认恢复",cancelButtonText:"取消",type:"warning"}).then(()=>{try{const e=t.data;$.value=e.students||[],Mt.value=e.history||[],e.settings&&(mn.value=e.settings.departmentList||mn.value,vn.value=e.settings.groupList||vn.value,pn.value=e.settings.interconnectGroups||[],gn.value=e.settings.examQuestionCount||2),ql(),Hl(),sl(),j.success("数据备份已恢复"),rn.value=!1}catch(e){j.error("恢复备份失败")}}).catch(()=>{});var t}},{icon:p(()=>[f(S(ae),{class:"w-4 h-4"})]),default:p(()=>[a[97]||(a[97]=x(" 恢复 ",-1))]),_:1},8,["onClick"]),f(oe,{size:"small",onClick:a=>(e=>{const a=JSON.stringify(e.data,null,2),t=new Blob([a],{type:"application/json"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=`backup_${e.timestamp.getTime()}.json`,l.click(),URL.revokeObjectURL(l.href),j.success("备份文件已导出")})(e.row)},{icon:p(()=>[f(S(K),{class:"w-4 h-4"})]),default:p(()=>[a[98]||(a[98]=x(" 导出 ",-1))]),_:1},8,["onClick"]),f(oe,{size:"small",type:"danger",onClick:a=>{return t=e.row.id,void U.confirm("确认删除此备份？","删除备份",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"}).then(()=>{try{const e=JSON.parse(localStorage.getItem(Et)||"[]");e.splice(t,1),localStorage.setItem(Et,JSON.stringify(e)),yn(),j.success("备份已删除")}catch(e){j.error("删除备份失败")}}).catch(()=>{});var t}},{icon:p(()=>[f(S(te),{class:"w-4 h-4"})]),default:p(()=>[a[99]||(a[99]=x(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),0===cn.value.length?(u(),r("div",Dt,[f(Rt,{description:"暂无备份数据"})])):k("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-31beb11c"]]);export{At as default};
