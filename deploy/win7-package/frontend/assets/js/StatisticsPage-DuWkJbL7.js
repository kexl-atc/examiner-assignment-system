import{l as a,r as e,h as t,U as s,j as l,z as c,A as i,L as r,B as o,K as n,S as d,R as u,J as v,u as h,al as p,P as b,E as m,I as w,O as g,D as y,Q as k,a6 as x,M as f,ar as C,az as _}from"./vendor-BDY1VVdw.js";import{c as S,b as z,_ as R,H as M,U as V,a as D,C as j}from"./_plugin-vue_export-helper-C_eiSiqI.js";import{D as E}from"./dateUtils-D_6usupf.js";import{C as I,a as T,b as U,P as W,c as A,B as L,p as B,d as O,e as P,A as q,f as H}from"./charts-CzD5hMsp.js";import{R as N}from"./refresh-cw-BHDjJkTd.js";import{D as F}from"./download-D4BHcBUS.js";import{T as $,C as J}from"./trending-up-DwAoyw8n.js";import{S as K}from"./search-CnUzOAgR.js";
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=S("BarChart3Icon",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),G=S("MaximizeIcon",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),X=S("MenuIcon",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Y=S("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Z=S("TrendingDownIcon",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),aa={class:"app-container"},ea={class:"sidebar-header"},ta={class:"logo-container"},sa={class:"logo-text"},la={class:"sidebar-nav"},ca={class:"nav-items"},ia={class:"nav-text"},ra={class:"nav-text"},oa={class:"nav-text"},na={class:"nav-text"},da={class:"sidebar-footer"},ua={class:"version-info"},va={class:"version-number"},ha={class:"status-bar"},pa={class:"status-left"},ba={class:"status-info"},ma={class:"status-date"},wa={class:"system-status"},ga={class:"status-text"},ya={class:"status-right"},ka={class:"quick-stats"},xa={class:"stat-value"},fa={class:"quick-actions"},Ca=["disabled"],_a={class:"overview-section"},Sa={class:"overview-grid"},za={class:"card-icon"},Ra={class:"card-content"},Ma={class:"card-value"},Va={class:"card-trend"},Da={class:"card-icon"},ja={class:"card-content"},Ea={class:"card-value"},Ia={class:"card-progress"},Ta={class:"progress-bar"},Ua={class:"card-icon"},Wa={class:"card-content"},Aa={class:"card-value"},La={class:"card-icon"},Ba={class:"card-content"},Oa={class:"card-value"},Pa={class:"card-progress"},qa={class:"progress-bar"},Ha={class:"filter-section"},Na={class:"filter-panel"},Fa={class:"filter-row"},$a={class:"filter-item"},Ja={class:"filter-item"},Ka={class:"filter-item"},Qa={class:"filter-actions"},Ga={class:"charts-section"},Xa={class:"charts-grid"},Ya={class:"chart-card"},Za={class:"chart-header"},ae={class:"chart-actions"},ee={class:"chart-content"},te={class:"chart-card"},se={class:"chart-header"},le={class:"chart-actions"},ce={class:"chart-content"},ie={class:"chart-card"},re={class:"chart-header"},oe={class:"chart-actions"},ne={class:"chart-content"},de={ref:"trendChart",class:"chart-container"},ue={class:"chart-card"},ve={class:"chart-header"},he={class:"chart-actions"},pe={class:"chart-content"},be={ref:"classDistributionChart",class:"chart-container"},me={class:"table-section"},we={class:"table-card"},ge={class:"table-header"},ye={class:"table-tabs"},ke=["onClick"],xe={class:"table-controls"},fe={class:"table-content"},Ce={key:0,class:"table-wrapper"},_e={class:"workload-value"},Se={key:1,class:"table-wrapper"},ze={class:"workload-value"},Re={class:"workload-value"},Me={class:"completion-rate"},Ve={class:"rate-bar"},De={class:"rate-text"},je={key:2,class:"table-wrapper"},Ee={class:"pagination-wrapper"},Ie=z({__name:"StatisticsPage",setup(S){I.register(T,U,W,A,L,B,O,P,q,H);const z=_(),Ie=a({totalSchedules:0,scheduleTrend:0,activeExaminers:0,totalExaminers:0,avgWorkload:0,completionRate:0}),Te=a({dateRange:null,teacherIds:[],classes:[],departments:[]}),Ue=a({current:1,size:20,total:0}),We=e("8.0.15"),Ae=e(!1),Le=e(!1),Be=e(!1),Oe=e(!1),Pe=e(!0),qe=e(""),He=e(""),Ne=()=>{Le.value=window.innerWidth<=768,Le.value||(Be.value=!1)},Fe=()=>{Ae.value=!Ae.value},$e=()=>{Be.value=!0},Je=()=>{Be.value=!1},Ke=()=>{Le.value&&Je()},Qe=()=>{const a=new Date;qe.value=E.toDateTimeString(a),He.value=E.toTimeString(a)},Ge=async()=>{Oe.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),Qe()}catch(a){}finally{Oe.value=!1}},Xe=async()=>{switch(tableView.value){case"schedule":await Ye();break;case"teacher":await Ze();break;case"student":await at()}},Ye=async()=>{try{const a=await apiService.getSchedule("all");a.success&&a.data&&(scheduleData.value=Array.isArray(a.data)?a.data:[],Ue.total=Array.isArray(a.data)?a.data.length:0)}catch(a){}},Ze=async()=>{try{const a=await apiService.getTeachers({page:Ue.current,pageSize:Ue.size,...Te});a.success&&a.data&&(teacherData.value=a.data.map(a=>({...a,totalWorkload:a.totalWorkload||0,avgWorkload:a.avgWorkload||0,completionRate:a.completionRate||0})),Ue.total=a.data.length)}catch(a){}},at=async()=>{try{const a=await apiService.getStudents({page:Ue.current,pageSize:Ue.size,...Te});a.success&&a.data&&(studentData.value=a.data.map(a=>({...a,examCount:a.examCount||0,status:a.status||"正常"})),Ue.total=a.data.length)}catch(a){}},et=async()=>{await Ge()},tt=()=>{Object.assign(Te,{dateRange:null,teacherIds:[],classes:[],departments:[]}),et()},st=a=>{ElMessageBox.alert(`查看${a}详细信息`,"详细信息",{confirmButtonText:"确定"})},lt=()=>{Xe()},ct=async()=>{try{const a=await statisticsService.exportStatistics(Te,"excel"),e=URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=`statistics_${E.toStandardDate(new Date)}.xlsx`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),ElMessage.success("导出成功")}catch(a){ElMessage.error("导出失败")}},it=()=>{};return t(()=>{Ne(),Qe(),window.addEventListener("resize",Ne);const a=setInterval(Qe,1e3);s(()=>{window.removeEventListener("resize",Ne),clearInterval(a)})}),l(()=>z.currentRoute.value,()=>{Le.value&&Je()}),(a,e)=>{const t=p("router-link"),s=p("el-date-picker"),l=p("el-option"),_=p("el-select"),S=p("RotateCcw"),z=p("WorkloadChart"),E=p("HeatmapChart"),I=p("el-table-column"),T=p("el-tag"),U=p("el-table"),W=p("el-pagination"),A=C("loading");return i(),c("div",aa,[Le.value&&Be.value?(i(),c("div",{key:0,class:"mobile-overlay",onClick:Je})):r("",!0),o("aside",{class:m(["sidebar",{"sidebar-collapsed":Ae.value&&!Le.value,"mobile-open":Le.value&&Be.value}])},[o("div",ea,[o("div",ta,[e[18]||(e[18]=o("div",{class:"logo-icon"},[o("img",{src:R,alt:"系统图标",class:"logo-img"})],-1)),n(o("div",sa,[...e[17]||(e[17]=[o("h1",{class:"system-title"},"考试自动排班助手",-1),o("p",{class:"system-subtitle"},"Examiner Assignment Assistant",-1)])],512),[[d,!Ae.value||Le.value&&Be.value]])])]),o("nav",la,[o("div",ca,[u(t,{to:"/",class:"nav-item",onClick:Ke},{default:v(()=>[u(h(M),{class:"nav-icon"}),n(o("span",ia,"首页",512),[[d,!Ae.value||Le.value&&Be.value]])]),_:1}),u(t,{to:"/teachers",class:"nav-item",onClick:Ke},{default:v(()=>[u(h(V),{class:"nav-icon"}),n(o("span",ra,"考官管理",512),[[d,!Ae.value||Le.value&&Be.value]])]),_:1}),u(t,{to:"/schedules",class:"nav-item",onClick:Ke},{default:v(()=>[u(h(D),{class:"nav-icon"}),n(o("span",oa,"排班管理",512),[[d,!Ae.value||Le.value&&Be.value]])]),_:1}),u(t,{to:"/statistics",class:"nav-item nav-item-active",onClick:Ke},{default:v(()=>[u(h(Q),{class:"nav-icon"}),n(o("span",na,"数据统计",512),[[d,!Ae.value||Le.value&&Be.value]])]),_:1})])]),n(o("div",da,[o("div",ua,[e[19]||(e[19]=o("span",{class:"version-label"},"版本",-1)),o("span",va,"v"+b(We.value),1)])],512),[[d,!Ae.value||Le.value&&Be.value]]),Le.value?r("",!0):(i(),c("div",{key:0,class:"sidebar-toggle",onClick:Fe},[u(h(j),{class:m(["toggle-icon",{"rotate-180":Ae.value}])},null,8,["class"])]))],2),o("div",{class:m(["main-content",{"sidebar-collapsed":Ae.value&&!Le.value,"mobile-layout":Le.value}])},[o("div",ha,[o("div",pa,[Le.value?(i(),c("button",{key:0,class:"mobile-menu-btn",onClick:$e},[u(h(X),{style:{width:"24px",height:"24px"}})])):r("",!0),o("div",ba,[u(h(D),{class:"status-icon"}),o("span",ma,b(qe.value),1)]),o("div",wa,[o("div",{class:m(["status-indicator",{connected:Pe.value}])},null,2),o("span",ga,b(Pe.value?"实时连接":"连接断开"),1)])]),o("div",ya,[o("div",ka,[o("div",{class:"stat-item clickable",onClick:Ge},[e[20]||(e[20]=o("span",{class:"stat-label"},"数据刷新",-1)),o("span",xa,b(He.value),1)])]),o("div",fa,[o("button",{class:"quick-btn",onClick:Ge,disabled:Oe.value},[u(h(N),{class:m(["btn-icon",{"animate-spin":Oe.value}])},null,8,["class"]),e[21]||(e[21]=o("span",null,"刷新数据",-1))],8,Ca),o("button",{class:"quick-btn",onClick:it},[u(h(F),{class:"btn-icon"}),e[22]||(e[22]=o("span",null,"导出报表",-1))])])])]),o("div",_a,[e[28]||(e[28]=o("h2",{class:"section-title"},"数据概览",-1)),o("div",Sa,[o("div",{class:"overview-card primary",onClick:e[0]||(e[0]=a=>st("schedules"))},[o("div",za,[u(h(D),{style:{width:"32px",height:"32px"}})]),o("div",Ra,[e[23]||(e[23]=o("div",{class:"card-label"},"总排班数",-1)),o("div",Ma,b((L=Ie.totalSchedules,null==L?"0":L.toLocaleString())),1),o("div",Va,[Ie.scheduleTrend>0?(i(),w(h($),{key:0,style:{width:"16px",height:"16px"}})):Ie.scheduleTrend<0?(i(),w(h(Z),{key:1,style:{width:"16px",height:"16px"}})):(i(),w(h(Y),{key:2,style:{width:"16px",height:"16px"}})),g(" "+b(Math.abs(Ie.scheduleTrend))+"% ",1)])])]),o("div",{class:"overview-card success",onClick:e[1]||(e[1]=a=>st("teachers"))},[o("div",Da,[u(h(V),{style:{width:"32px",height:"32px"}})]),o("div",ja,[e[24]||(e[24]=o("div",{class:"card-label"},"活跃考官",-1)),o("div",Ea,b(Ie.activeExaminers)+"/"+b(Ie.totalExaminers),1),o("div",Ia,[o("div",Ta,[o("div",{class:"progress-fill",style:y({width:Ie.activeExaminers/Ie.totalExaminers*100+"%"})},null,4)])])])]),o("div",{class:"overview-card warning",onClick:e[2]||(e[2]=a=>st("workload"))},[o("div",Ua,[u(h(Q),{style:{width:"32px",height:"32px"}})]),o("div",Wa,[e[25]||(e[25]=o("div",{class:"card-label"},"平均工作量",-1)),o("div",Aa,b(Ie.avgWorkload.toFixed(1))+"h",1),e[26]||(e[26]=o("div",{class:"card-description"},"每日平均",-1))])]),o("div",{class:"overview-card info",onClick:e[3]||(e[3]=a=>st("completion"))},[o("div",La,[u(h(J),{style:{width:"32px",height:"32px"}})]),o("div",Ba,[e[27]||(e[27]=o("div",{class:"card-label"},"完成率",-1)),o("div",Oa,b((100*Ie.completionRate).toFixed(1))+"%",1),o("div",Pa,[o("div",qa,[o("div",{class:"progress-fill",style:y({width:100*Ie.completionRate+"%"})},null,4)])])])])])]),o("div",Ha,[e[34]||(e[34]=o("h2",{class:"section-title"},"数据筛选",-1)),o("div",Na,[o("div",Fa,[o("div",$a,[e[29]||(e[29]=o("label",{class:"filter-label"},"时间范围",-1)),u(s,{modelValue:Te.dateRange,"onUpdate:modelValue":e[4]||(e[4]=a=>Te.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",class:"filter-input"},null,8,["modelValue"])]),o("div",Ja,[e[30]||(e[30]=o("label",{class:"filter-label"},"考官",-1)),u(_,{modelValue:Te.teacherIds,"onUpdate:modelValue":e[5]||(e[5]=a=>Te.teacherIds=a),multiple:"",placeholder:"选择考官",filterable:"",clearable:"",class:"filter-input"},{default:v(()=>[(i(!0),c(k,null,x(a.teachers,a=>(i(),w(l,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",Ka,[e[31]||(e[31]=o("label",{class:"filter-label"},"班级",-1)),u(_,{modelValue:Te.classes,"onUpdate:modelValue":e[6]||(e[6]=a=>Te.classes=a),multiple:"",placeholder:"选择班级",filterable:"",clearable:"",class:"filter-input"},{default:v(()=>[(i(!0),c(k,null,x(a.classOptions,a=>(i(),w(l,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",Qa,[o("button",{class:"filter-btn primary",onClick:et},[u(h(K),{style:{width:"16px",height:"16px"}}),e[32]||(e[32]=g(" 查询 ",-1))]),o("button",{class:"filter-btn secondary",onClick:tt},[u(S,{style:{width:"16px",height:"16px"}}),e[33]||(e[33]=g(" 重置 ",-1))])])])])]),o("div",Ga,[e[39]||(e[39]=o("h2",{class:"section-title"},"数据可视化",-1)),o("div",Xa,[o("div",Ya,[o("div",Za,[e[35]||(e[35]=o("h3",{class:"chart-title"},"考官工作量分布",-1)),o("div",ae,[o("button",{class:"chart-action-btn",onClick:e[7]||(e[7]=e=>a.downloadChart("workload"))},[u(h(F),{style:{width:"16px",height:"16px"}})]),o("button",{class:"chart-action-btn",onClick:e[8]||(e[8]=e=>a.fullscreenChart("workload"))},[u(h(G),{style:{width:"16px",height:"16px"}})])])]),o("div",ee,[u(z,{data:a.workloadData,loading:Oe.value,height:"350px"},null,8,["data","loading"])])]),o("div",te,[o("div",se,[e[36]||(e[36]=o("h3",{class:"chart-title"},"排班热力图",-1)),o("div",le,[o("button",{class:"chart-action-btn",onClick:e[9]||(e[9]=e=>a.downloadChart("heatmap"))},[u(h(F),{style:{width:"16px",height:"16px"}})]),o("button",{class:"chart-action-btn",onClick:e[10]||(e[10]=e=>a.fullscreenChart("heatmap"))},[u(h(G),{style:{width:"16px",height:"16px"}})])])]),o("div",ce,[u(E,{data:a.heatmapData,loading:Oe.value,height:"350px"},null,8,["data","loading"])])]),o("div",ie,[o("div",re,[e[37]||(e[37]=o("h3",{class:"chart-title"},"工作量趋势",-1)),o("div",oe,[o("button",{class:"chart-action-btn",onClick:e[11]||(e[11]=e=>a.downloadChart("trend"))},[u(h(F),{style:{width:"16px",height:"16px"}})]),o("button",{class:"chart-action-btn",onClick:e[12]||(e[12]=e=>a.fullscreenChart("trend"))},[u(h(G),{style:{width:"16px",height:"16px"}})])])]),o("div",ne,[o("div",de,null,512)])]),o("div",ue,[o("div",ve,[e[38]||(e[38]=o("h3",{class:"chart-title"},"班级考试分布",-1)),o("div",he,[o("button",{class:"chart-action-btn",onClick:e[13]||(e[13]=e=>a.downloadChart("class"))},[u(h(F),{style:{width:"16px",height:"16px"}})]),o("button",{class:"chart-action-btn",onClick:e[14]||(e[14]=e=>a.fullscreenChart("class"))},[u(h(G),{style:{width:"16px",height:"16px"}})])])]),o("div",pe,[o("div",be,null,512)])])])]),o("div",me,[e[40]||(e[40]=o("h2",{class:"section-title"},"详细数据",-1)),o("div",we,[o("div",ge,[o("div",ye,[(i(!0),c(k,null,x(a.tableViews,e=>(i(),c("button",{key:e.key,class:m(["table-tab",{active:a.tableView===e.key}]),onClick:a=>(a=>{tableView.value=a,Xe()})(e.key)},[(i(),w(f(e.icon),{style:{width:"16px",height:"16px"}})),g(" "+b(e.label),1)],10,ke))),128))]),o("div",xe,[o("button",{class:"control-btn",onClick:lt},[u(h(N),{style:{width:"16px",height:"16px"}})]),o("button",{class:"control-btn",onClick:ct},[u(h(F),{style:{width:"16px",height:"16px"}})])])]),o("div",fe,["schedule"===a.tableView?(i(),c("div",Ce,[n((i(),w(U,{data:a.scheduleData,stripe:"",border:"",class:"data-table"},{default:v(()=>[u(I,{prop:"date",label:"日期",width:"120",sortable:""}),u(I,{prop:"teacherName",label:"考官",width:"120",sortable:""}),u(I,{prop:"className",label:"班级",width:"120",sortable:""}),u(I,{prop:"subject",label:"科目",width:"120",sortable:""}),u(I,{prop:"workload",label:"工作量",width:"100",sortable:""},{default:v(({row:a})=>[o("span",_e,b(a.workload)+"h",1)]),_:1}),u(I,{prop:"status",label:"状态",width:"100"},{default:v(({row:e})=>[u(T,{type:a.getStatusType(e.status)},{default:v(()=>[g(b(e.status),1)]),_:2},1032,["type"])]),_:1}),u(I,{prop:"createdAt",label:"创建时间",width:"160",sortable:""})]),_:1},8,["data"])),[[A,Oe.value]])])):"teacher"===a.tableView?(i(),c("div",Se,[n((i(),w(U,{data:a.teacherData,stripe:"",border:"",class:"data-table"},{default:v(()=>[u(I,{prop:"name",label:"姓名",width:"120",sortable:""}),u(I,{prop:"department",label:"部门",width:"120",sortable:""}),u(I,{prop:"totalWorkload",label:"总工作量",width:"120",sortable:""},{default:v(({row:a})=>[o("span",ze,b(a.totalWorkload)+"h",1)]),_:1}),u(I,{prop:"avgWorkload",label:"平均工作量",width:"120",sortable:""},{default:v(({row:a})=>[o("span",Re,b(a.avgWorkload)+"h",1)]),_:1}),u(I,{prop:"completionRate",label:"完成率",width:"100",sortable:""},{default:v(({row:a})=>[o("div",Me,[o("div",Ve,[o("div",{class:"rate-fill",style:y({width:a.completionRate+"%"})},null,4)]),o("span",De,b(a.completionRate)+"%",1)])]),_:1})]),_:1},8,["data"])),[[A,Oe.value]])])):(i(),c("div",je,[n((i(),w(U,{data:a.studentData,stripe:"",border:"",class:"data-table"},{default:v(()=>[u(I,{prop:"name",label:"姓名",width:"120",sortable:""}),u(I,{prop:"studentId",label:"学号",width:"120",sortable:""}),u(I,{prop:"className",label:"班级",width:"120",sortable:""}),u(I,{prop:"examCount",label:"考试次数",width:"100",sortable:""}),u(I,{prop:"status",label:"状态",width:"100"},{default:v(({row:e})=>[u(T,{type:a.getStatusType(e.status)},{default:v(()=>[g(b(e.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[A,Oe.value]])])),o("div",Ee,[u(W,{"current-page":Ue.current,"onUpdate:currentPage":e[15]||(e[15]=a=>Ue.current=a),"page-size":Ue.size,"onUpdate:pageSize":e[16]||(e[16]=a=>Ue.size=a),total:Ue.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])])],2)]);var L}}},[["__scopeId","data-v-cb050ce2"]]);
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Ie as default};
