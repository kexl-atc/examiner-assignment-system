const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./excel-C2s3b8zA.js","./utils-ZMqNovHY.js"])))=>i.map(i=>d[i]);
import{_ as a}from"./index-zMH_pf55.js";import{y as e,r as t,j as l,c as s,h as n,U as o,z as i,A as r,B as c,L as u,K as d,S as v,R as m,J as p,al as b,P as f,E as h,u as g,Q as y,a6 as k,W as w,aj as D,ax as C,ay as x,ag as S,O as P,ae as _}from"./vendor-BDY1VVdw.js";import{_ as j,C as E,U as T,H as $,a as A,b as V}from"./_plugin-vue_export-helper-C_eiSiqI.js";import{u as U,g as I,a as R}from"./useSidebarAutoCollapse-D4SkuiTF.js";import{storageService as H}from"./storageService-D0OTCPkh.js";import{u as L,P as O,C as q}from"./useResponsive-Bp-XFVFf.js";import{D as z}from"./dateUtils-D_6usupf.js";import{n as M,S as W}from"./departmentNormalizer-3p5zR7gw.js";import{T as B,U as F,S as N}from"./upload-CaKLp6sl.js";import{D as J}from"./download-D4BHcBUS.js";import{X as K}from"./x-C-vOU4IE.js";import{S as Q}from"./settings-Bo2u5DAq.js";import"./ui-XhJlTBKO.js";import"./utils-ZMqNovHY.js";const G={class:"app-container"},X={class:"sidebar-header"},Y={class:"logo-container"},Z={class:"logo-text"},aa={class:"sidebar-nav"},ea={class:"nav-items"},ta={class:"nav-text"},la={class:"nav-text"},sa={class:"nav-text"},na={class:"nav-text"},oa={class:"sidebar-footer"},ia={class:"version-info"},ra={class:"version-number"},ca={class:"main-content"},ua={class:"page-header"},da={class:"header-left"},va={class:"storage-info"},ma={key:0,class:"storage-stats"},pa={class:"stats-item"},ba={class:"stats-item"},fa={class:"stats-item"},ha={class:"header-actions"},ga={class:"table-container"},ya={class:"teachers-table"},ka={class:"checkbox-column"},wa=["checked"],Da={class:"checkbox-column"},Ca=["onUpdate:modelValue","onChange"],xa={class:"unavailable-dates-cell"},Sa={key:0,class:"dates-list"},Pa=["title"],_a={class:"date-range"},ja={key:0},Ea={key:0,class:"date-reason"},Ta={key:1,class:"no-dates"},$a=["onClick","title"],Aa={class:"action-buttons"},Va=["onClick"],Ua=["onClick"],Ia={key:0},Ra={colspan:"7",class:"empty-state"},Ha={class:"empty-content"},La={class:"modal-header"},Oa={class:"modal-title"},qa={class:"modal-body"},za={class:"form-row"},Ma={class:"form-group"},Wa={class:"form-group"},Ba={class:"form-row"},Fa={class:"form-group"},Na={class:"form-group"},Ja=["value"],Ka={class:"form-row"},Qa={class:"form-group full-width"},Ga={class:"radio-group"},Xa={class:"radio-item"},Ya={class:"radio-item"},Za={class:"modal-footer"},ae={class:"modal-header"},ee={class:"modal-body"},te={class:"confirm-content"},le={class:"confirm-text"},se={class:"modal-header"},ne={class:"modal-title"},oe={class:"modal-body"},ie={class:"unavailable-form"},re={class:"form-grid"},ce={class:"form-group"},ue={class:"form-group"},de=["min"],ve={class:"form-group"},me={key:0,class:"unavailable-list"},pe={class:"unavailable-items"},be={class:"item-content"},fe={class:"item-dates"},he={class:"date-value"},ge={key:0,class:"date-separator"},ye={key:1,class:"date-value"},ke={key:2,class:"expired-badge"},we={class:"item-reason"},De={class:"reason-value"},Ce=["onClick"],xe={key:1,class:"unavailable-empty"},Se={class:"modal-header"},Pe={class:"modal-body"},_e={key:0,class:"duplicate-analysis"},je={class:"analysis-summary"},Ee={class:"summary-item"},Te={class:"summary-value"},$e={class:"summary-item success"},Ae={class:"summary-value"},Ve={key:0,class:"summary-item warning"},Ue={class:"summary-value"},Ie={key:1,class:"summary-item error"},Re={class:"summary-value"},He={class:"import-options"},Le={class:"radio-group"},Oe={class:"radio-option"},qe={class:"radio-option"},ze={class:"radio-option"},Me={class:"data-details"},We={class:"details-list"},Be={class:"item-info"},Fe={class:"item-name"},Ne={class:"item-dept"},Je={class:"item-group"},Ke={class:"item-status"},Qe={class:"item-badges"},Ge={key:0,class:"badge badge-new"},Xe={key:1,class:"badge badge-duplicate"},Ye={key:2,class:"badge badge-anomaly"},Ze={key:0,class:"item-errors"},at=V(e({__name:"TeachersPage",setup(e){const V=a=>a?M(a):"未分配科室";L();const at=t("8.0.15"),et=t(!1);t(!1),t("可用");const tt=t(!1),lt=t(!1),st=t(null),nt=t(null),ot=t(!1),it=t(null),rt=t(!1),ct=t([]),ut=t(null),dt=t("new-only"),vt=t(!1),mt=t(null),pt=t({startDate:"",endDate:"",reason:""}),{checkContentOverflowDelayed:bt}=U(".app-container",".teachers-table",()=>et.value,a=>{et.value=a},{enableLogging:!1}),ft=t({environment:"web",primary:"localStorage",cacheHits:0,cacheMisses:0,cacheHitRate:"0%",avgResponseTime:0,dataSize:"0 B"}),ht=async a=>{try{await H.saveTeachers(a),ft.value=H.getStorageStats()}catch(e){const a=e instanceof Error?e.message:String(e);alert("数据保存失败: "+a)}},gt=t([]),yt=t(!0),kt=async()=>{yt.value=!0;try{await(async()=>{try{await H.init(),ft.value=H.getStorageStats()}catch(a){}})();const a=await(async()=>{try{return(await H.loadTeachers()).map(a=>{const e=R(a);return e.unavailablePeriods||(e.unavailablePeriods=[]),e})}catch(a){return[]}})();gt.value=a,bt(300)}catch(a){}finally{yt.value=!1}};let wt=null;l(gt,a=>{yt.value||(async a=>{wt&&clearTimeout(wt),wt=setTimeout(async()=>{await ht(a)},500)})(a)},{deep:!0});const Dt=t({name:"",department:"",group:"",shift:"",status:"可用"}),Ct=s(()=>gt.value.filter(a=>a.selected)),xt=s(()=>Ct.value.length>0),St=()=>{et.value=!et.value},Pt=()=>{const a=gt.value.every(a=>a.selected);gt.value.forEach(e=>{e.selected=!a})},_t=()=>{ot.value=!1,it.value=null,Dt.value={name:"",department:"",group:"",shift:"",status:"可用"},tt.value=!0},jt=()=>{if(!Dt.value.group)return void(Dt.value.shift="");const a=I(new Date,Dt.value.group);Dt.value.shift=a?a.status:"未排班"},Et=()=>{tt.value=!1,ot.value=!1,it.value=null,Dt.value={name:"",department:"",group:"",shift:"",status:"可用"}},Tt=()=>{if(Dt.value.name&&Dt.value.department&&Dt.value.group)if(ot.value&&it.value){const a=gt.value.findIndex(a=>a.id===it.value);if(a>-1){const e=gt.value[a],t={id:e.id,name:Dt.value.name,department:Dt.value.department,group:Dt.value.group,shift:"",status:Dt.value.status||"可用",selected:e.selected,unavailablePeriods:e.unavailablePeriods||[]};gt.value[a]=R(t),Et(),alert("考官信息已更新")}}else{const a={id:Date.now().toString(),name:Dt.value.name,department:Dt.value.department,group:Dt.value.group,shift:"",status:Dt.value.status||"可用",selected:!1,unavailablePeriods:[]},e=R(a);gt.value.push(e),Et(),alert("考官添加成功")}else alert("请填写必要信息（姓名、科室、班组）")},$t=Tt,At=()=>{xt.value?lt.value=!0:alert("请先选择要删除的考官")},Vt=()=>{if(st.value){const a=gt.value.findIndex(a=>a.id===st.value.id);a>-1&&gt.value.splice(a,1)}else gt.value=gt.value.filter(a=>!a.selected);lt.value=!1,st.value=null,alert("删除成功")},Ut=()=>{lt.value=!1,st.value=null},It=()=>{var a;null==(a=nt.value)||a.click()},Rt=async a=>{var e;const t=a.target,l=null==(e=t.files)?void 0:e[0];if(!l)return;const s=l.name.endsWith(".xlsx")||l.name.endsWith(".xls"),n=l.name.endsWith(".csv");if(s||n){try{let a=[];if(a=s?await Ht(l):await Lt(l),a.length>0){const e=zt(a);e.hasDuplicates||e.hasAnomalies?(ct.value=a,ut.value=e,rt.value=!0):(gt.value.push(...a),alert(`成功导入 ${a.length} 条考官数据！`))}else alert("没有有效的数据可导入")}catch(o){const a=o instanceof Error?o.message:String(o);alert("导入失败，请检查文件格式是否正确："+a)}t.value=""}else alert("请选择Excel文件(.xlsx, .xls)或CSV文件")},Ht=async e=>{const t=await a(()=>import("./excel-C2s3b8zA.js").then(a=>a.x),__vite__mapDeps([0,1]),import.meta.url);return new Promise((a,l)=>{const s=new FileReader;s.onload=e=>{var s;try{const n=new Uint8Array(null==(s=e.target)?void 0:s.result),o=t.read(n,{type:"array"}),i=o.SheetNames[0],r=o.Sheets[i],c=t.utils.sheet_to_json(r,{header:1});if(c.length<2)return void l(new Error("Excel文件格式不正确，至少需要标题行和一行数据"));const u=c[0].map(a=>String(a||"").trim()).filter(a=>a),d={"姓名":["姓名","名字","name","考官姓名","员工姓名","人员姓名"],"所在科室":["所在科室","科室","部门","department","所属科室","工作科室"],"所在班组":["所在班组","班组","group","组别","小组","工作组"],"状态":["状态","status","可用状态","考官状态","工作状态"]},v={};Object.keys(d).forEach(a=>{const e=d[a];for(let t=0;t<u.length;t++){const l=u[t].toLowerCase().trim();if(e.some(a=>{const e=a.toLowerCase();return l===e||l.includes(e)||e.includes(l)})){v[a]=t;break}}});const m=["姓名","所在科室","所在班组"].filter(a=>void 0===v[a]);if(m.length>0){const a=u.join(", "),e=`\n\n调试信息:\n- 实际列数: ${u.length}\n- 实际列标题: [${a}]\n- 缺少的列: [${m.join(", ")}]\n- 支持的姓名列格式: ${d["姓名"].join(", ")}`;return void l(new Error(`Excel文件缺少必要的列：${m.join(", ")}${e}\n\n提示：请确保Excel文件包含必要的列，列标题可以是中文或英文`))}const p=[];for(let a=1;a<c.length;a++){const e=c[a];if(!e||0===e.length)continue;const t=String(e[v["姓名"]]||"").trim(),l=String(e[v["所在科室"]]||"").trim(),s=String(e[v["所在班组"]]||"").trim(),n=String(e[v["状态"]]||"").trim(),o=Ot(l),i=qt(s);if(!t||!o||!i)continue;const r={id:Date.now().toString()+"_"+a,name:t,department:o,group:i,shift:"",status:"不可用"===n?"不可用":"可用",selected:!1},u=R(r);p.push(u)}a(p)}catch(n){l(n instanceof Error?n:new Error(String(n)))}},s.onerror=()=>l(new Error("读取文件失败")),s.readAsArrayBuffer(e)})},Lt=async a=>new Promise((e,t)=>{const l=new FileReader;l.onload=a=>{var l;try{const n=null==(l=a.target)?void 0:l.result;if(!n)return void t(new Error("文件内容为空"));const o=n.split("\n").filter(a=>a.trim());if(o.length<2)return void t(new Error("CSV文件格式不正确，至少需要标题行和一行数据"));const i=Jt(o[0]),r=["姓名","所在科室","所在班组","状态"],c=["姓名","所在科室","所在班组"].filter(a=>!i.includes(a));if(c.length>0)return void t(new Error(`CSV文件缺少必要的列：${c.join(", ")}\n\n期望的列：${r.join(", ")}`));const u=[];for(let a=1;a<o.length;a++)try{const e=Jt(o[a]);if(0===e.length)continue;const t={};if(i.forEach((a,l)=>{t[a]=e[l]||""}),!t["姓名"]||!t["所在科室"]||!t["所在班组"])continue;const l=t["所在科室"].trim(),s=Ot(l),n=t["所在班组"].trim(),r=qt(n),c={id:Date.now().toString()+"_"+a,name:t["姓名"].trim(),department:s,group:r,shift:"",status:"不可用"===t["状态"]?"不可用":"可用",selected:!1},d=R(c);u.push(d)}catch(s){}e(u)}catch(s){t(s instanceof Error?s:new Error(String(s)))}},l.onerror=()=>t(new Error("读取文件失败")),l.readAsText(a,"utf-8")}),Ot=a=>{if(!a||!a.trim())return"";const e=a.trim().toLowerCase(),t=["模拟机","现场","口试","理论","实操","实践","笔试"];for(const n of t)if(e.includes(n.toLowerCase()))throw new Error(`数据错误：考官科室 "${a}" 是考试科目，不是科室名称！\n请检查CSV文件中"所在科室"列的数据。`);const l={"区域一室":"一","区域二室":"二","区域三室":"三","区域四室":"四","区域五室":"五","区域六室":"六","区域七室":"七","区域八室":"八","区域九室":"九","区域十室":"十","区域1室":"一","区域2室":"二","区域3室":"三","区域4室":"四","区域5室":"五","区域6室":"六","区域7室":"七","区域8室":"八","区域9室":"九","区域10室":"十","一室":"一","二室":"二","三室":"三","四室":"四","五室":"五","六室":"六","七室":"七","八室":"八","九室":"九","十室":"十","1室":"一","2室":"二","3室":"三","4室":"四","5室":"五","6室":"六","7室":"七","8室":"八","9室":"九","10室":"十","区域1":"一","区域2":"二","区域3":"三","区域4":"四","区域5":"五","区域6":"六","区域7":"七","区域8":"八","区域9":"九","区域10":"十","第一区域":"一","第二区域":"二","第三区域":"三","第四区域":"四","第五区域":"五","第六区域":"六","第七区域":"七","第八区域":"八","第九区域":"九","第十区域":"十","1区":"一","2区":"二","3区":"三","4区":"四","5区":"五","6区":"六","7区":"七","8区":"八","9区":"九","10区":"十","一区":"一","二区":"二","三区":"三","四区":"四","五区":"五","六区":"六","七区":"七","八区":"八","九区":"九","十区":"十",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十"}[e];if(l)return l;const s=[{pattern:/区域?[一1]/,target:"一"},{pattern:/区域?[二2]/,target:"二"},{pattern:/区域?[三3]/,target:"三"},{pattern:/区域?[四4]/,target:"四"},{pattern:/区域?[五5]/,target:"五"},{pattern:/区域?[六6]/,target:"六"},{pattern:/区域?[七7]/,target:"七"},{pattern:/区域?[八8]/,target:"八"},{pattern:/区域?[九9]/,target:"九"},{pattern:/区域?[十10]/,target:"十"}];for(const{pattern:n,target:o}of s)if(n.test(e))return o;return a.trim()},qt=a=>{if(!a||!a.trim())return"一组";const e={"一组":"一组","二组":"二组","三组":"三组","四组":"四组","一":"一组","二":"二组","三":"三组","四":"四组","1组":"一组","2组":"二组","3组":"三组","4组":"四组",1:"一组",2:"二组",3:"三组",4:"四组","白班":"白班","日常班":"日常班","晚班":"晚班","周末班":"周末班","行政班":"行政班","无":"无"}[a.trim()];return e||a.trim()},zt=a=>{const e=[];let t=0,l=0,s=0;for(const n of a){const a=gt.value.find(a=>a.name===n.name&&a.department===n.department&&a.group===n.group),o=[];n.name&&""!==n.name.trim()||o.push("姓名为空"),n.department&&""!==n.department.trim()||o.push("科室为空");const i=["一组","二组","三组","四组","行政班","无"];n.group&&i.includes(n.group)||o.push(`班组"${n.group}"不合法（应为：${i.join("、")}）`),a&&a.status!==n.status&&o.push(`状态冲突：现有"${a.status}" vs 导入"${n.status}"`);const r=!!a,c=o.length>0;r?t++:l++,c&&s++,e.push({importedTeacher:n,existingTeacher:a||null,isDuplicate:r,isAnomaly:c,anomalyReasons:o})}return{hasDuplicates:t>0,hasAnomalies:s>0,duplicateCount:t,newCount:l,anomalyCount:s,items:e}},Mt=()=>{if(!ut.value||0===ct.value.length)return;const a=dt.value,e=ut.value;let t=0,l=0,s=0;switch(a){case"overwrite":for(const a of e.items)if(a.isDuplicate&&a.existingTeacher){const e=gt.value.findIndex(e=>e.id===a.existingTeacher.id);e>-1&&(gt.value[e]=a.importedTeacher,s++)}else gt.value.push(a.importedTeacher),t++;alert(`导入完成！新增${t}条，覆盖${s}条数据`);break;case"skip":for(const a of e.items)a.isDuplicate?l++:(gt.value.push(a.importedTeacher),t++);alert(`导入完成！新增${t}条，跳过${l}条重复数据`);break;case"new-only":for(const a of e.items)a.isDuplicate||a.isAnomaly?a.isDuplicate&&l++:(gt.value.push(a.importedTeacher),t++);alert(`导入完成！新增${t}条，跳过${l}条数据（包含重复和异常）`);break;case"manual":alert('手动选择模式开发中，将采用"仅导入新数据"策略');for(const a of e.items)a.isDuplicate||a.isAnomaly||(gt.value.push(a.importedTeacher),t++)}Wt()},Wt=()=>{rt.value=!1,ct.value=[],ut.value=null,dt.value="new-only"},Bt=()=>{vt.value=!1,mt.value=null,pt.value={startDate:"",endDate:"",reason:""}},Ft=()=>{if(!mt.value)return;const{startDate:a,endDate:e,reason:t}=pt.value;if(!a||!e)return void alert("请选择开始日期和结束日期");if(z.compareDates(a,e)>0)return void alert("开始日期不能晚于结束日期");const l={id:Date.now().toString(),startDate:a,endDate:e,reason:t||"未填写原因",createdAt:z.toStandardDate(new Date)};mt.value.unavailablePeriods||(mt.value.unavailablePeriods=[]),mt.value.unavailablePeriods.push(l),mt.value.unavailablePeriods.length>0&&(mt.value.status="不可用"),ht(gt.value),Bt(),alert(`已为考官「${mt.value.name}」添加不可用期`)},Nt=a=>z.isDateInPast(a.endDate),Jt=a=>{const e=[];let t="",l=!1,s=0;for(;s<a.length;){const n=a[s];'"'===n?l&&'"'===a[s+1]?(t+='"',s+=2):(l=!l,s++):","!==n||l?(t+=n,s++):(e.push(t.trim()),t="",s++)}return e.push(t.trim()),e},Kt=async()=>{if(0!==gt.value.length)try{const e=await a(()=>import("./excel-C2s3b8zA.js").then(a=>a.x),__vite__mapDeps([0,1]),import.meta.url),t=gt.value.map(a=>({"姓名":a.name,"所在科室":V(a.department),"所在班组":a.group,"当日班次":a.shift,"状态":a.status})),l=e.utils.book_new(),s=e.utils.json_to_sheet(t),n=[];Object.keys(t[0]||{}).forEach((a,e)=>{let l=2*a.length;t.forEach(e=>{const t=String(e[a]||""),s=t.length*(t.match(/[\u4e00-\u9fa5]/g)?2:1);l=Math.max(l,s)}),n.push({wch:Math.min(Math.max(l,10),30)})}),s["!cols"]=n,e.utils.book_append_sheet(l,s,"考官数据");const o=`考官数据_${z.toStorageDate(new Date)}.xlsx`;e.writeFile(l,o),alert("考官数据导出成功！")}catch(e){const a=e instanceof Error?e.message:String(e);alert("导出失败，请稍后重试: "+a)}else alert("没有考官数据可导出！")},Qt=()=>{gt.value=gt.value.map(a=>R(a))},Gt=()=>{const a=new Date;a.setHours(0,0,0,0);let e=!1;gt.value.forEach(t=>{if(!t.unavailablePeriods||0===t.unavailablePeriods.length)return;const l=t.unavailablePeriods.length;t.unavailablePeriods=t.unavailablePeriods.filter(e=>{const t=new Date(e.endDate);return t.setHours(23,59,59,999),t>=a}),t.unavailablePeriods.length<l&&(e=!0),0===t.unavailablePeriods.length&&"不可用"===t.status&&(t.status="可用",e=!0)}),e&&ht(gt.value)},Xt=()=>{Zt&&clearTimeout(Zt),al&&clearInterval(al);const a=(()=>{const a=new Date,e=new Date(a);return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e.getTime()-a.getTime()})();Zt=setTimeout(()=>{Gt(),al=setInterval(()=>{Gt()},864e5)},a)};let Yt=null,Zt=null,al=null;return n(async()=>{await kt(),Qt(),Object.keys(localStorage).filter(a=>a.includes("teacher")||a.includes("examiner")||a.includes("schedule")),Object.keys(sessionStorage).filter(a=>a.includes("teacher")||a.includes("examiner")||a.includes("schedule")),Gt(),Xt(),Yt=setInterval(Qt,36e5)}),o(()=>{Yt&&(clearInterval(Yt),Yt=null),Zt&&(clearTimeout(Zt),Zt=null),al&&(clearInterval(al),al=null)}),(a,e)=>{var t,l;const s=b("router-link");return r(),i("div",G,[c("aside",{class:h(["sidebar",{"sidebar-collapsed":et.value}])},[c("div",X,[c("div",Y,[e[17]||(e[17]=c("div",{class:"logo-icon"},[c("img",{src:j,alt:"系统图标",class:"logo-img"})],-1)),d(c("div",Z,[...e[16]||(e[16]=[c("h1",{class:"system-title"},"考试自动排班助手",-1),c("p",{class:"system-subtitle"},"Examiner Assignment Assistant",-1)])],512),[[v,!et.value]])])]),c("nav",aa,[c("div",ea,[m(s,{to:"/",class:"nav-item"},{default:p(()=>[m(g($),{class:"nav-icon"}),d(c("span",ta,"首页",512),[[v,!et.value]])]),_:1}),m(s,{to:"/teachers",class:"nav-item nav-item-active"},{default:p(()=>[m(g(T),{class:"nav-icon"}),d(c("span",la,"考官管理",512),[[v,!et.value]])]),_:1}),m(s,{to:"/instructor-assignment",class:"nav-item"},{default:p(()=>[m(g(W),{class:"nav-icon"}),d(c("span",sa,"考官分配",512),[[v,!et.value]])]),_:1}),m(s,{to:"/schedules",class:"nav-item"},{default:p(()=>[m(g(A),{class:"nav-icon"}),d(c("span",na,"自动排班",512),[[v,!et.value]])]),_:1})])]),d(c("div",oa,[c("div",ia,[e[18]||(e[18]=c("span",{class:"version-label"},"版本",-1)),c("span",ra,"v"+f(at.value),1)])],512),[[v,!et.value]]),c("div",{class:"sidebar-toggle",onClick:St},[m(g(E),{class:h(["toggle-icon",{rotated:et.value}])},null,8,["class"])])],2),c("div",ca,[c("div",ua,[c("div",da,[e[20]||(e[20]=c("h1",{class:"page-title"},"考官管理",-1)),c("div",va,[void 0!==ft.value.cacheHits?(r(),i("div",ma,[c("span",pa,"缓存命中: "+f(ft.value.cacheHits),1),c("span",ba,"数据大小: "+f(ft.value.dataSize),1),c("span",fa," 命中率: "+f(ft.value.cacheHitRate),1)])):u("",!0),e[19]||(e[19]=c("div",{class:"auto-cleanup-info"},[c("span",{class:"info-icon"},"ℹ️"),c("span",{class:"info-text"},"过期的不可用日期将在每日凌晨零点自动清理并恢复可用状态")],-1))])]),c("div",ha,[c("button",{class:h(["action-btn action-btn-secondary",{disabled:!xt.value}]),onClick:At},[m(g(B),{class:"btn-icon"}),e[21]||(e[21]=c("span",null,"删除",-1))],2),c("button",{class:"action-btn action-btn-secondary",onClick:It},[m(g(J),{class:"btn-icon"}),e[22]||(e[22]=c("span",null,"导入",-1))]),c("button",{class:"action-btn action-btn-secondary",onClick:Kt},[m(g(F),{class:"btn-icon"}),e[23]||(e[23]=c("span",null,"导出",-1))]),c("button",{class:"action-btn action-btn-primary",onClick:_t},[m(g(O),{class:"btn-icon"}),e[24]||(e[24]=c("span",null,"新增考官",-1))])])]),c("input",{ref_key:"fileInput",ref:nt,type:"file",accept:".xlsx,.xls,.csv",style:{display:"none"},onChange:Rt},null,544),c("div",ga,[c("table",ya,[c("thead",null,[c("tr",null,[c("th",ka,[c("input",{type:"checkbox",onChange:Pt,checked:gt.value.length>0&&gt.value.every(a=>a.selected)},null,40,wa)]),e[25]||(e[25]=c("th",null,"姓名",-1)),e[26]||(e[26]=c("th",null,"所在科室",-1)),e[27]||(e[27]=c("th",null,"所在班组",-1)),e[28]||(e[28]=c("th",null,"当日班次",-1)),e[29]||(e[29]=c("th",null,"不可用日期",-1)),e[30]||(e[30]=c("th",null,"操作",-1))])]),c("tbody",null,[(r(!0),i(y,null,k(gt.value,a=>(r(),i("tr",{key:a.id,class:h({selected:a.selected})},[c("td",Da,[d(c("input",{type:"checkbox","onUpdate:modelValue":e=>a.selected=e,onChange:e=>(a=>{a.selected=!a.selected})(a)},null,40,Ca),[[_,a.selected]])]),c("td",null,f(a.name),1),c("td",null,f(V(a.department)),1),c("td",null,f(a.group),1),c("td",null,f(a.shift),1),c("td",null,[c("div",xa,[a.unavailablePeriods&&a.unavailablePeriods.length>0?(r(),i("div",Sa,[(r(!0),i(y,null,k(a.unavailablePeriods,a=>(r(),i("div",{key:a.id,class:"date-item",title:a.reason},[c("span",_a,[P(f(a.startDate)+" ",1),a.startDate!==a.endDate?(r(),i("span",ja," ~ "+f(a.endDate),1)):u("",!0)]),a.reason?(r(),i("span",Ea,f(a.reason),1)):u("",!0)],8,Pa))),128))])):(r(),i("span",Ta,"-")),c("button",{onClick:e=>(a=>{mt.value=a;const e=z.toStandardDate(new Date);pt.value={startDate:e,endDate:e,reason:""},vt.value=!0})(a),class:"manage-dates-btn",title:a.unavailablePeriods&&a.unavailablePeriods.length>0?"管理不可用期":"添加不可用期"},[m(g(Q),{class:"btn-icon-small"})],8,$a)])]),c("td",null,[c("div",Aa,[c("button",{class:"action-btn-small action-btn-edit",onClick:e=>(a=>{ot.value=!0,it.value=a.id,Dt.value={name:a.name,department:a.department,group:a.group,shift:a.shift,status:a.status},tt.value=!0})(a),title:"编辑考官"},[m(g(N),{class:"action-icon"})],8,Va),c("button",{class:"action-btn-small action-btn-danger",onClick:e=>(a=>{st.value=a,lt.value=!0})(a),title:"删除考官"},[m(g(B),{class:"action-icon"})],8,Ua)])])],2))),128)),0===gt.value.length?(r(),i("tr",Ia,[c("td",Ra,[c("div",Ha,[m(g(T),{class:"empty-icon"}),e[32]||(e[32]=c("p",null,"暂无考官数据",-1)),c("button",{class:"action-btn action-btn-primary",onClick:_t},[m(g(O),{class:"btn-icon"}),e[31]||(e[31]=c("span",null,"添加第一个考官",-1))])])])])):u("",!0)])])])]),tt.value?(r(),i("div",{key:0,class:"modal-overlay",onClick:Et},[c("div",{class:"modal-content",onClick:e[6]||(e[6]=w(()=>{},["stop"]))},[c("div",La,[c("h2",Oa,f(ot.value?"编辑考官":"新增考官"),1),c("button",{class:"modal-close",onClick:Et},[m(g(K),{class:"close-icon"})])]),c("div",qa,[c("form",{onSubmit:e[5]||(e[5]=w((...a)=>g($t)&&g($t)(...a),["prevent"]))},[c("div",za,[c("div",Ma,[e[33]||(e[33]=c("label",{class:"form-label"},"姓名 *",-1)),d(c("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>Dt.value.name=a),class:"form-input",placeholder:"请输入考官姓名",required:""},null,512),[[D,Dt.value.name]])]),c("div",Wa,[e[35]||(e[35]=c("label",{class:"form-label"},"所在科室 *",-1)),d(c("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>Dt.value.department=a),class:"form-select",required:""},[...e[34]||(e[34]=[x('<option value="" data-v-823bffb1>请选择科室</option><option value="区域一室" data-v-823bffb1>区域一室</option><option value="区域二室" data-v-823bffb1>区域二室</option><option value="区域三室" data-v-823bffb1>区域三室</option><option value="区域四室" data-v-823bffb1>区域四室</option><option value="区域五室" data-v-823bffb1>区域五室</option><option value="区域六室" data-v-823bffb1>区域六室</option><option value="区域七室" data-v-823bffb1>区域七室</option>',8)])],512),[[C,Dt.value.department]])])]),c("div",Ba,[c("div",Fa,[e[37]||(e[37]=c("label",{class:"form-label"},"所在班组",-1)),d(c("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>Dt.value.group=a),class:"form-select",onChange:jt},[...e[36]||(e[36]=[x('<option value="" data-v-823bffb1>请选择班组</option><option value="一组" data-v-823bffb1>一组</option><option value="二组" data-v-823bffb1>二组</option><option value="三组" data-v-823bffb1>三组</option><option value="四组" data-v-823bffb1>四组</option><option value="行政班" data-v-823bffb1>行政班</option>',6)])],544),[[C,Dt.value.group]])]),c("div",Na,[e[38]||(e[38]=c("label",{class:"form-label"},"当日班次",-1)),c("input",{type:"text",value:Dt.value.shift,class:"form-input",placeholder:"根据班组自动显示",readonly:"",disabled:""},null,8,Ja)])]),c("div",Ka,[c("div",Qa,[e[41]||(e[41]=c("label",{class:"form-label"},"状态",-1)),c("div",Ga,[c("label",Xa,[d(c("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=a=>Dt.value.status=a),value:"可用"},null,512),[[S,Dt.value.status]]),e[39]||(e[39]=c("span",{class:"radio-text"},"可用",-1))]),c("label",Ya,[d(c("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=a=>Dt.value.status=a),value:"不可用"},null,512),[[S,Dt.value.status]]),e[40]||(e[40]=c("span",{class:"radio-text"},"不可用",-1))])])])])],32)]),c("div",Za,[c("button",{type:"button",class:"action-btn action-btn-secondary",onClick:Et}," 取消 "),c("button",{type:"button",class:"action-btn action-btn-primary",onClick:Tt},f(ot.value?"保存修改":"保存"),1)])])])):u("",!0),lt.value?(r(),i("div",{key:1,class:"modal-overlay",onClick:Ut},[c("div",{class:"modal-content modal-small",onClick:e[7]||(e[7]=w(()=>{},["stop"]))},[c("div",ae,[e[42]||(e[42]=c("h2",{class:"modal-title"},"确认删除",-1)),c("button",{class:"modal-close",onClick:Ut},[m(g(K),{class:"close-icon"})])]),c("div",ee,[c("div",te,[m(g(q),{class:"confirm-icon"}),c("p",le,f(st.value?`确定要删除考官「${st.value.name}」吗？`:`确定要删除选中的 ${Ct.value.length} 个考官吗？`),1),e[43]||(e[43]=c("p",{class:"confirm-warning"},"此操作不可撤销，请谨慎操作。",-1))])]),c("div",{class:"modal-footer"},[c("button",{type:"button",class:"action-btn action-btn-secondary",onClick:Ut}," 取消 "),c("button",{type:"button",class:"action-btn action-btn-danger",onClick:Vt}," 确认删除 ")])])])):u("",!0),vt.value?(r(),i("div",{key:2,class:"modal-overlay",onClick:Bt},[c("div",{class:"modal-content modal-medium",onClick:e[11]||(e[11]=w(()=>{},["stop"]))},[c("div",se,[c("h2",ne,"管理不可用期 - "+f(null==(t=mt.value)?void 0:t.name),1),c("button",{class:"modal-close",onClick:Bt},[m(g(K),{class:"close-icon"})])]),c("div",oe,[c("div",ie,[e[48]||(e[48]=c("h3",{class:"form-section-title"},"添加不可用期",-1)),c("div",re,[c("div",ce,[e[44]||(e[44]=c("label",{class:"form-label"},[P("开始日期 "),c("span",{class:"required"},"*")],-1)),d(c("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=a=>pt.value.startDate=a),class:"form-input",required:""},null,512),[[D,pt.value.startDate]])]),c("div",ue,[e[45]||(e[45]=c("label",{class:"form-label"},[P("结束日期 "),c("span",{class:"required"},"*")],-1)),d(c("input",{type:"date","onUpdate:modelValue":e[9]||(e[9]=a=>pt.value.endDate=a),class:"form-input",min:pt.value.startDate,required:""},null,8,de),[[D,pt.value.endDate]])])]),c("div",ve,[e[46]||(e[46]=c("label",{class:"form-label"},"原因/备注",-1)),d(c("textarea",{"onUpdate:modelValue":e[10]||(e[10]=a=>pt.value.reason=a),class:"form-textarea",placeholder:"请输入不可用的原因，如：请假、培训、出差等",rows:"3"},null,512),[[D,pt.value.reason]])]),c("button",{type:"button",class:"action-btn action-btn-primary",onClick:Ft},[m(g(O),{class:"btn-icon"}),e[47]||(e[47]=c("span",null,"添加不可用期",-1))])]),(null==(l=mt.value)?void 0:l.unavailablePeriods)&&mt.value.unavailablePeriods.length>0?(r(),i("div",me,[e[51]||(e[51]=c("h3",{class:"form-section-title"},"当前不可用期",-1)),c("div",pe,[(r(!0),i(y,null,k(mt.value.unavailablePeriods,a=>(r(),i("div",{key:a.id,class:h(["unavailable-item",{"period-expired":Nt(a)}])},[c("div",be,[c("div",fe,[e[49]||(e[49]=c("span",{class:"date-label"},"日期:",-1)),c("span",he,f(a.startDate),1),a.startDate!==a.endDate?(r(),i("span",ge,"至")):u("",!0),a.startDate!==a.endDate?(r(),i("span",ye,f(a.endDate),1)):u("",!0),Nt(a)?(r(),i("span",ke,"已过期")):u("",!0)]),c("div",we,[e[50]||(e[50]=c("span",{class:"reason-label"},"原因:",-1)),c("span",De,f(a.reason),1)])]),c("button",{class:"item-delete-btn",onClick:e=>((a,e)=>{if(!a.unavailablePeriods)return;const t=a.unavailablePeriods.findIndex(a=>a.id===e);t>-1&&(a.unavailablePeriods[t],a.unavailablePeriods.splice(t,1),0===a.unavailablePeriods.length&&"不可用"===a.status?(a.status="可用",alert(`不可用期已删除，考官「${a.name}」已恢复为可用状态`)):alert("不可用期已删除"),ht(gt.value))})(mt.value,a.id),title:"删除"},[m(g(B),{class:"delete-icon"})],8,Ce)],2))),128))])])):(r(),i("div",xe,[...e[52]||(e[52]=[c("p",null,"暂无不可用期记录",-1)])]))]),c("div",{class:"modal-footer"},[c("button",{type:"button",class:"action-btn action-btn-secondary",onClick:Bt}," 关闭 ")])])])):u("",!0),rt.value?(r(),i("div",{key:3,class:"modal-overlay",onClick:Wt},[c("div",{class:"modal-content modal-large",onClick:e[15]||(e[15]=w(()=>{},["stop"]))},[c("div",Se,[e[53]||(e[53]=c("h2",{class:"modal-title"},"导入数据检测",-1)),c("button",{class:"modal-close",onClick:Wt},[m(g(K),{class:"close-icon"})])]),c("div",Pe,[ut.value?(r(),i("div",_e,[c("div",je,[c("div",Ee,[e[54]||(e[54]=c("span",{class:"summary-label"},"总计：",-1)),c("span",Te,f(ut.value.items.length)+" 条",1)]),c("div",$e,[e[55]||(e[55]=c("span",{class:"summary-label"},"新数据：",-1)),c("span",Ae,f(ut.value.newCount)+" 条",1)]),ut.value.duplicateCount>0?(r(),i("div",Ve,[e[56]||(e[56]=c("span",{class:"summary-label"},"重复：",-1)),c("span",Ue,f(ut.value.duplicateCount)+" 条",1)])):u("",!0),ut.value.anomalyCount>0?(r(),i("div",Ie,[e[57]||(e[57]=c("span",{class:"summary-label"},"异常：",-1)),c("span",Re,f(ut.value.anomalyCount)+" 条",1)])):u("",!0)]),c("div",He,[e[61]||(e[61]=c("h3",{class:"options-title"},"请选择处理方式：",-1)),c("div",Le,[c("label",Oe,[d(c("input",{type:"radio",value:"new-only","onUpdate:modelValue":e[12]||(e[12]=a=>dt.value=a)},null,512),[[S,dt.value]]),e[58]||(e[58]=c("span",{class:"radio-label"},[c("strong",null,"仅导入新数据"),c("small",null,"（推荐）跳过所有重复和异常数据，只导入新的考官信息")],-1))]),c("label",qe,[d(c("input",{type:"radio",value:"skip","onUpdate:modelValue":e[13]||(e[13]=a=>dt.value=a)},null,512),[[S,dt.value]]),e[59]||(e[59]=c("span",{class:"radio-label"},[c("strong",null,"跳过重复项"),c("small",null,"保留现有数据，导入所有新数据（包括异常数据）")],-1))]),c("label",ze,[d(c("input",{type:"radio",value:"overwrite","onUpdate:modelValue":e[14]||(e[14]=a=>dt.value=a)},null,512),[[S,dt.value]]),e[60]||(e[60]=c("span",{class:"radio-label"},[c("strong",null,"覆盖现有数据"),c("small",null,"用新数据替换重复项（谨慎使用）")],-1))])])]),c("div",Me,[e[62]||(e[62]=c("h3",{class:"details-title"},"数据详情：",-1)),c("div",We,[(r(!0),i(y,null,k(ut.value.items,(a,e)=>(r(),i("div",{key:e,class:h(["detail-item",{"item-new":!a.isDuplicate&&!a.isAnomaly,"item-duplicate":a.isDuplicate,"item-anomaly":a.isAnomaly}])},[c("div",Be,[c("span",Fe,f(a.importedTeacher.name),1),c("span",Ne,f(V(a.importedTeacher.department)),1),c("span",Je,f(a.importedTeacher.group),1),c("span",Ke,f(a.importedTeacher.status),1)]),c("div",Qe,[a.isDuplicate||a.isAnomaly?u("",!0):(r(),i("span",Ge,"新数据")),a.isDuplicate?(r(),i("span",Xe,"重复")):u("",!0),a.isAnomaly?(r(),i("span",Ye,"异常")):u("",!0)]),a.anomalyReasons.length>0?(r(),i("div",Ze,[(r(!0),i(y,null,k(a.anomalyReasons,(a,e)=>(r(),i("span",{key:e,class:"error-reason"},f(a),1))),128))])):u("",!0)],2))),128))])])])):u("",!0)]),c("div",{class:"modal-footer"},[c("button",{type:"button",class:"action-btn action-btn-secondary",onClick:Wt}," 取消 "),c("button",{type:"button",class:"action-btn action-btn-primary",onClick:Mt}," 确认导入 ")])])])):u("",!0)])}}}),[["__scopeId","data-v-823bffb1"]]);export{at as default};
