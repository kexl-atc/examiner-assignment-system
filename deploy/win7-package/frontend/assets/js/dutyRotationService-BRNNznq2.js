import{c as t}from"./_plugin-vue_export-helper-C_eiSiqI.js";import{a as e}from"./departmentNormalizer-3p5zR7gw.js";
/**
 * @license lucide-vue-next v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s=t("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var a=Object.defineProperty,r=(t,e,s)=>((t,e,s)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);const i=t=>{"undefined"!=typeof performance&&performance.mark&&performance.mark(t)};class n extends Error{constructor(t,e,s,a,i){super(t),this.status=e,this.code=s,this.originalError=a,r(this,"timestamp"),r(this,"requestId"),r(this,"context"),this.name="APIError",this.timestamp=(new Date).toISOString(),this.requestId=this.generateRequestId(),this.context=i,a&&a.stack&&(this.stack=a.stack)}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getStatusText(){return this.status?{400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",409:"Conflict",422:"Unprocessable Entity",429:"Too Many Requests",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout"}[this.status]||"Unknown Status":"No Status"}getDetailedMessage(){let t=`[${this.code||"API_ERROR"}] ${this.message}`;return this.status&&(t+=`\nHTTP状态: ${this.status} ${this.getStatusText()}`),this.requestId&&(t+=`\n请求ID: ${this.requestId}`),this.context&&(t+=`\n上下文: ${JSON.stringify(this.context,null,2)}`),this.originalError&&(t+=`\n原始错误: ${this.originalError.message}`),t+=`\n时间: ${this.timestamp}`,t}isNetworkError(){return!this.status||this.status>=500}isClientError(){return void 0!==this.status&&this.status>=400&&this.status<500}isServerError(){return void 0!==this.status&&this.status>=500}toJSON(){var t;return{name:this.name,message:this.message,status:this.status,statusText:this.getStatusText(),code:this.code,requestId:this.requestId,timestamp:this.timestamp,context:this.context,originalError:null==(t=this.originalError)?void 0:t.message,isNetworkError:this.isNetworkError(),isClientError:this.isClientError(),isServerError:this.isServerError()}}}const o=new class{constructor(t,e=15e3){var s,a;r(this,"baseURL"),r(this,"defaultTimeout"),r(this,"cacheManager",{get:t=>null,set:(t,e,s)=>{},delete:t=>{},clear:()=>{},getStats:()=>({hitRate:0,total:0,hits:0,misses:0})}),r(this,"requestId",0),r(this,"metrics"),r(this,"backendPort",8082),r(this,"portInitialized",!1),r(this,"pendingPortInit",null),t||(t="undefined"!=typeof window&&(null==(s=window.electronAPI)?void 0:s.isElectron)?`http://127.0.0.1:${this.backendPort}/api`:"/api"),this.baseURL=t,this.defaultTimeout=e,this.metrics={apiCalls:{total:0,successful:0,failed:0,averageResponseTime:0},cacheHits:{total:0,hitRate:0},errors:{total:0,byType:{}},systemHealth:{memoryUsage:0,cpuUsage:0,diskUsage:0}},"undefined"!=typeof window&&(null==(a=window.electronAPI)?void 0:a.isElectron)&&this.initializePort()}async initializePort(){return this.pendingPortInit?this.pendingPortInit:this.portInitialized?Promise.resolve():(this.pendingPortInit=(async()=>{var t,e,s;try{if("undefined"!=typeof window&&(null==(t=window.electronAPI)?void 0:t.isElectron))if(null==(e=window.electronAPI)?void 0:e.onBackendReady)await new Promise(t=>{(async()=>{try{const e=await window.electronAPI.getBackendStatus();if(e&&e.isRunning&&e.port)return this.backendPort=e.port,this.baseURL=`http://127.0.0.1:${this.backendPort}/api`,void t()}catch(e){}window.electronAPI.onBackendReady(async()=>{try{const t=await window.electronAPI.getBackendPort();t&&t>0&&(this.backendPort=t,this.baseURL=`http://127.0.0.1:${this.backendPort}/api`)}catch(e){this.backendPort=8081,this.baseURL=`http://127.0.0.1:${this.backendPort}/api`}t()})})()});else if(null==(s=window.electronAPI)?void 0:s.getBackendPort){const t=await window.electronAPI.getBackendPort();t&&t>0&&(this.backendPort=t,this.baseURL=`http://127.0.0.1:${this.backendPort}/api`)}this.portInitialized=!0}catch(a){this.backendPort=8081,this.baseURL=`http://127.0.0.1:${this.backendPort}/api`,this.portInitialized=!0}finally{this.pendingPortInit=null}})(),this.pendingPortInit)}async waitForPort(){this.portInitialized||this.pendingPortInit&&await this.pendingPortInit}generateRequestId(){return`req_${Date.now()}_${++this.requestId}`}buildURL(t){return`${this.baseURL}${t.startsWith("/")?"":"/"}${t}`}getCacheKey(t,e){return`api_${e.method||"GET"}_${t}`}async request(t,e={},s){await this.waitForPort();const a=this.generateRequestId(),r=performance.now(),o=this.buildURL(t),c=e.method||"GET",h={url:o,method:c,endpoint:t,headers:e.headers,timestamp:(new Date).toISOString(),requestId:a};i(`api-start-${a}`);try{if(e.cache&&"GET"===c){const t=this.getCacheKey(o,e),s=this.cacheManager.get(t);if(s)return this.metrics.cacheHits.total++,s}const t={method:c,headers:{"Content-Type":"application/json","X-Request-ID":a,...e.headers},signal:AbortSignal.timeout(e.timeout||this.defaultTimeout)};s&&"GET"!==c&&(s instanceof FormData?(delete t.headers["Content-Type"],t.body=s):t.body=JSON.stringify(s));const i=await fetch(o,t);if(!i.ok){let t={};const e=i.headers.get("content-type");try{t=e&&e.includes("application/json")?await i.json():{message:await i.text()}}catch(u){t={message:`HTTP ${i.status}: ${i.statusText}`}}throw new n(t.message||`HTTP ${i.status}: ${i.statusText}`,i.status,t.code||`HTTP_${i.status}`,void 0,{...h,responseStatus:i.status,responseStatusText:i.statusText,responseHeaders:{},errorData:t})}let d;const l=i.headers.get("content-type");d=l&&l.includes("application/json")?await i.json():await i.text();const m={success:!0,data:d.data||d,meta:d.meta};if(e.cache&&"GET"===c){const t=this.getCacheKey(o,e),s=e.cacheTTL||3e5;this.cacheManager.set(t,m,s)}return this.updateMetrics(!0,performance.now()-r),m}catch(d){let t;return t=d instanceof n?d:d instanceof TypeError&&d.message.includes("fetch")?new n("网络连接失败，请检查网络连接",void 0,"NETWORK_ERROR",d,h):d instanceof Error&&"AbortError"===d.name?new n("请求超时，请稍后重试",void 0,"TIMEOUT_ERROR",d,h):new n(d instanceof Error?d.message:"请求处理失败",void 0,"REQUEST_ERROR",d,h),this.updateMetrics(!1,performance.now()-r,t.code),{success:!1,error:t}}finally{i(`api-end-${a}`);try{performance.measure(`api-${a}`,`api-start-${a}`,`api-end-${a}`)}catch{}}}updateMetrics(t,e,s){this.metrics.apiCalls.total++,t?this.metrics.apiCalls.successful++:(this.metrics.apiCalls.failed++,this.metrics.errors.total++,s&&(this.metrics.errors.byType[s]=(this.metrics.errors.byType[s]||0)+1));const a=this.metrics.apiCalls.total,r=this.metrics.apiCalls.averageResponseTime;this.metrics.apiCalls.averageResponseTime=(r*(a-1)+e)/a}async executeScheduling(t){return this.request("/scheduling/execute",{method:"POST",timeout:3e4,cache:!1},t)}async getSchedule(t){return this.request(`/scheduling/${t}`,{method:"GET",cache:!0,cacheTTL:6e5})}async getScheduleHistory(t){const e=new URLSearchParams(t).toString();return this.request(`/scheduling/history?${e}`,{method:"GET",cache:!0,cacheTTL:3e5})}async cancelSchedule(t){return this.request(`/scheduling/${t}/cancel`,{method:"POST",cache:!1})}async getConstraintConfiguration(){return this.request("/schedule/constraints",{method:"GET",cache:!0,cacheTTL:3e5})}async updateConstraintConfiguration(t){return this.request("/schedule/constraints",{method:"PUT",cache:!1},t)}async getTeachers(t){const e=new URLSearchParams(t).toString();return this.request(`/teachers?${e}`,{method:"GET",cache:!0,cacheTTL:3e5})}async getTeacher(t){return this.request(`/teachers/${t}`,{method:"GET",cache:!0,cacheTTL:6e5})}async createTeacher(t){return this.request("/teachers",{method:"POST",cache:!1},t)}async updateTeacher(t,e){return this.request(`/teachers/${t}`,{method:"PUT",cache:!1},e)}async deleteTeacher(t){return this.request(`/teachers/${t}`,{method:"DELETE",cache:!1})}async importTeachers(t){const e=new FormData;return e.append("file",t),this.request("/api/data/teachers/import",{method:"POST",headers:{},timeout:6e4,cache:!1},e)}async getStudents(t){const e=new URLSearchParams(t).toString();return this.request(`/students?${e}`,{method:"GET",cache:!0,cacheTTL:3e5})}async importStudents(t){const e=new FormData;return e.append("file",t),this.request("/data/students/import",{method:"POST",headers:{},timeout:6e4,cache:!1},e)}async getOverviewStats(){return this.request("/overview/stats",{method:"GET",cache:!0,cacheTTL:6e4})}async getRecentActivities(){return this.request("/overview/activities",{method:"GET",cache:!0,cacheTTL:3e4})}async getChartData(t){return this.request(`/overview/charts/${t}`,{method:"GET",cache:!0,cacheTTL:3e5})}async getPerformanceMetrics(){return this.request("/performance/metrics",{method:"GET",cache:!0,cacheTTL:3e4})}getLocalMetrics(){const t=this.cacheManager.getStats();return this.metrics.cacheHits.hitRate=t.hitRate,{...this.metrics}}resetLocalMetrics(){this.metrics={apiCalls:{total:0,successful:0,failed:0,averageResponseTime:0},cacheHits:{total:0,hitRate:0},errors:{total:0,byType:{}},systemHealth:{memoryUsage:0,cpuUsage:0,diskUsage:0}}}clearCache(){this.cacheManager.clear()}async healthCheck(){return this.request("/health",{method:"GET",timeout:5e3,cache:!1})}async get(t,e={}){return this.request(t,{...e,method:"GET"})}async post(t,e,s={}){return this.request(t,{...s,method:"POST"},e)}async put(t,e,s={}){return this.request(t,{...s,method:"PUT"},e)}async delete(t,e={}){return this.request(t,{...e,method:"DELETE"})}async patch(t,e,s={}){return this.request(t,{...s,method:"PATCH"},e)}};function c(t){return e(t)}function h(t,e){const{defaultGroup:s="未知班组",generateId:a=!0}={};return t.map((t,e)=>{const r=c(t.department),i=t.examiner1?c(t.examiner1):void 0;t.examiner2&&c(t.examiner2);let n=t.group;n=null==n||""===n?s:n.trim();const o=r,h=i;return fetch("http://127.0.0.1:7242/ingest/53a25d9f-31ac-4999-bbed-18803cf2b93a",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"assignmentDataService.ts:convertAssignmentToSchedule",message:"converting student data (FIXED)",data:{name:t.name,department:r,group:n,recommendedExaminer1Dept:o,recommendedExaminer2Dept:h,originalExaminer1:t.examiner1,originalExaminer2:t.examiner2,explanation:"HC2 requires examiner1 to be same dept as student"},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"FIX-HC2"})}).catch(()=>{}),{id:a?`assignment_${e+1}`:t.name,name:t.name,department:r,group:n,recommendedExaminer1Dept:o,recommendedExaminer2Dept:h,originalExaminers:{examiner1:t.examiner1,examiner2:t.examiner2},examDays:2,day1Subjects:["现场","模拟机1"],day2Subjects:["模拟机2","口试"]}})}const u="assignment_data_for_schedule",d={saveAssignmentData(t){try{const e={students:t,timestamp:Date.now(),version:"1.0"},s=JSON.stringify(e);localStorage.setItem(u,s)}catch(e){}},getAssignmentData(){try{const t=localStorage.getItem(u);if(!t)return null;return JSON.parse(t).students||null}catch(t){return null}},clearAssignmentData(){try{localStorage.removeItem(u)}catch(t){}},hasAssignmentData(){return null!==this.getAssignmentData()},getDataTimestamp(){try{const t=localStorage.getItem(u);if(!t)return null;return JSON.parse(t).timestamp||null}catch(t){return null}}};var l=Object.defineProperty,m=(t,e,s)=>((t,e,s)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);const p=new class{constructor(){m(this,"BASE_DATE","2025-09-04"),m(this,"ROTATION_PATTERN",{0:{dayShift:"二组",nightShift:"一组"},1:{dayShift:"三组",nightShift:"二组"},2:{dayShift:"四组",nightShift:"三组"},3:{dayShift:"一组",nightShift:"四组"}}),m(this,"ALL_GROUPS",["一组","二组","三组","四组"])}normalizeDateToIso(t){if(!t)return"";if(t instanceof Date&&!isNaN(t.getTime())){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const e=String(t).trim();if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)){const[t,s,a]=e.split("-");return`${t}-${s.padStart(2,"0")}-${a.padStart(2,"0")}`}const s=e.replace(/\//g,"-").replace(/\./g,"-");if(/^\d{1,2}-\d{1,2}$/.test(s)){const t=new Date(this.BASE_DATE).getFullYear(),[e,a]=s.split("-");return`${t}-${e.padStart(2,"0")}-${a.padStart(2,"0")}`}return e}parseIsoToLocalDate(t){const e=t.split("-");if(3!==e.length)return new Date(t);const[s,a,r]=e;return new Date(parseInt(s,10),parseInt(a,10)-1,parseInt(r,10))}calculateDutySchedule(t){if(!t)throw new Error("日期字符串不能为空");const e=this.normalizeDateToIso(t),s=this.parseIsoToLocalDate(e);if(isNaN(s.getTime()))throw new Error(`无效的日期格式: ${t}`);const a=this.parseIsoToLocalDate(this.BASE_DATE),r=(Math.floor((s.getTime()-a.getTime())/864e5)%4+4)%4;if(r<0||r>3)throw new Error(`计算出的循环位置超出范围: ${r}`);const i=this.ROTATION_PATTERN[r];if(!i)throw new Error(`无法找到循环位置 ${r} 对应的轮班模式`);const n=this.ALL_GROUPS.filter(t=>t!==i.dayShift&&t!==i.nightShift);return{date:e,dayShift:i.dayShift,nightShift:i.nightShift,restGroups:n,cyclePosition:r}}calculateDutyScheduleRange(t,e){const s=[],a=new Date(t),r=new Date(e);for(let i=new Date(a);i<=r;i.setDate(i.getDate()+1)){const t=i.toISOString().split("T")[0];s.push(this.calculateDutySchedule(t))}return s}getGroupStatuses(t){const e=this.calculateDutySchedule(t),s=[];for(const a of this.ALL_GROUPS){let t,r,i;a===e.dayShift?(t="day_shift",r=!1,i=4):a===e.nightShift?(t="night_shift",r=!0,i=1):(t="rest",r=!0,i=2),s.push({group:a,status:t,canBeExaminer:r,priority:i})}return s}canTeacherBeExaminer(t,e){if(!t||"无"===t||""===t)return!0;return t!==this.calculateDutySchedule(e).dayShift}getTeacherPriority(t,e){if(!t||"无"===t||""===t)return 3;const s=this.getGroupStatuses(e).find(e=>e.group===t);return s?s.priority:4}canStudentTakeFieldExam(t,e){return t!==this.calculateDutySchedule(e).dayShift}generateDutyReport(t,e){const s=this.calculateDutyScheduleRange(t,e),a=s.filter(t=>{const e=new Date(t.date).getDay();return e>=1&&e<=5}),r={};for(const i of this.ALL_GROUPS)r[i]={dayShifts:0,nightShifts:0,restDays:0};for(const i of a){r[i.dayShift].dayShifts++,r[i.nightShift].nightShifts++;for(const t of i.restGroups)r[t].restDays++}return{schedules:s,summary:{totalDays:s.length,workdaysOnly:a,groupWorkload:r}}}validateRotation(){const t=[],e=[{date:"2025-09-04",expected:{dayShift:"二组",nightShift:"一组"}},{date:"2025-09-05",expected:{dayShift:"三组",nightShift:"二组"}},{date:"2025-09-06",expected:{dayShift:"四组",nightShift:"三组"}},{date:"2025-09-07",expected:{dayShift:"一组",nightShift:"四组"}},{date:"2025-09-08",expected:{dayShift:"二组",nightShift:"一组"}}];for(const s of e){const e=this.calculateDutySchedule(s.date);e.dayShift===s.expected.dayShift&&e.nightShift===s.expected.nightShift||t.push(`日期${s.date}轮转计算错误: 期望${JSON.stringify(s.expected)}, 实际${JSON.stringify({dayShift:e.dayShift,nightShift:e.nightShift})}`)}return{isValid:0===t.length,issues:t}}};export{s as F,o as a,d as b,h as c,p as d};
