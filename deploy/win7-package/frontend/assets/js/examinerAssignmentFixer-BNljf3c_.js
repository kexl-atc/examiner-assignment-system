class e{normalizeDepartment(e){if(!e)return"";const n=String(e).trim();return n.includes("区域一室")||n.includes("一室")||n.includes("1室")||n.includes("第1科室")?"一":n.includes("区域二室")||n.includes("二室")||n.includes("2室")||n.includes("第2科室")?"二":n.includes("区域三室")||n.includes("三室")||n.includes("3室")||n.includes("第3科室")?"三":n.includes("区域四室")||n.includes("四室")||n.includes("4室")||n.includes("第4科室")?"四":n.includes("区域五室")||n.includes("五室")||n.includes("5室")||n.includes("第5科室")?"五":n.includes("区域六室")||n.includes("六室")||n.includes("6室")||n.includes("第6科室")?"六":n.includes("区域七室")||n.includes("七室")||n.includes("7室")||n.includes("第7科室")?"七":n.includes("区域八室")||n.includes("八室")||n.includes("8室")||n.includes("第8科室")?"八":n.includes("区域九室")||n.includes("九室")||n.includes("9室")||n.includes("第9科室")?"九":n.includes("区域十室")||n.includes("十室")||n.includes("10室")||n.includes("第10科室")?"十":n}isValidExaminer1Department(e,n){return!(!e||!n)&&(e===n||("三"===e&&"七"===n||"七"===e&&"三"===n))}fixExaminerAssignments(e,n){var t,i;const r=[];let s=0;const l=[...e];for(let u=0;u<l.length;u++){const e=l[u],a=e.studentName||(null==(t=e.student)?void 0:t.name)||"未知学员";e.examDate||e.date;const d=!e.examiner1||"未分配"===e.examiner1,c=!e.examiner2||"未分配"===e.examiner2,m=e.examiner1&&e.examiner2&&e.examiner1.id===e.examiner2.id;if(!d&&!c&&!m)continue;const o=(null==(i=e.student)?void 0:i.department)||e.studentDepartment,x=this.normalizeDepartment(o),h=n.filter(e=>!1!==e.isActive),p=h.filter(e=>this.normalizeDepartment(e.department)===x),f=h.filter(e=>this.normalizeDepartment(e.department)!==x);if(d||m){const n=this.selectBestExaminer1(p,f,e,l,x);n?(e.examiner1=n,r.push(`✅ 为${a}分配考官1: ${n.name} (${n.department})`),s++):r.push(`❌ 无法为${a}分配考官1`)}if(c||m){const n=this.selectBestExaminer2(f,p,e,e.examiner1,l);n?(e.examiner2=n,r.push(`✅ 为${a}分配考官2: ${n.name} (${n.department})`),s++):r.push(`❌ 无法为${a}分配考官2`)}}const a=l.filter(e=>{const n=e.examiner1&&"未分配"!==e.examiner1,t=e.examiner2&&"未分配"!==e.examiner2,i=!e.examiner1||!e.examiner2||e.examiner1.id!==e.examiner2.id;return!n||!t||!i}).length;return{success:0===a,fixedCount:s,remainingIssues:a,details:r,assignments:l}}selectBestExaminer1(e,n,t,i,r){if(0===e.length)return null;const s=e.filter(e=>this.isValidExaminer1Department(r,this.normalizeDepartment(e.department)));if(0===s.length)return null;return this.selectLeastBusyTeacher(s,t,i)||null}selectBestExaminer2(e,n,t,i,r){var s;const l=this.normalizeDepartment((null==(s=t.student)?void 0:s.department)||t.studentDepartment),a=this.normalizeDepartment(null==i?void 0:i.department),u=null==i?void 0:i.id,d=e.filter(e=>e.id!==u).filter(e=>{const n=this.normalizeDepartment(e.department);return n!==l&&n!==a}),c=n.filter(e=>e.id!==u).filter(e=>{const n=this.normalizeDepartment(e.department);return n!==l&&n!==a});if(d.length>0){const e=this.selectLeastBusyTeacher(d,t,r);if(e)return e}return c.length>0?this.selectLeastBusyTeacher(c,t,r):null}selectLeastBusyTeacher(e,n,t){if(0===e.length)return null;const i=n.examDate||n.date,r=n.id,s=e.filter(e=>!t.some(n=>{var t,s,l;if(n.id===r)return!1;if((n.examDate||n.date)!==i)return!1;const a=(null==(t=n.examiner1)?void 0:t.id)||n.examiner1,u=(null==(s=n.examiner2)?void 0:s.id)||n.examiner2,d=(null==(l=n.backupExaminer)?void 0:l.id)||n.backup,c=e.id;return a===c||u===c||d===c}));if(0===s.length)return null;const l=s.map(e=>{const n=t.filter(n=>{var t,i,r;const s=(null==(t=n.examiner1)?void 0:t.id)||n.examiner1,l=(null==(i=n.examiner2)?void 0:i.id)||n.examiner2,a=(null==(r=n.backupExaminer)?void 0:r.id)||n.backup;return s===e.id||l===e.id||a===e.id}).length;return{teacher:e,workload:n}});l.sort((e,n)=>e.workload-n.workload);return l[0].teacher}}const n=new e;export{e as ExaminerAssignmentFixer,n as examinerAssignmentFixer};
