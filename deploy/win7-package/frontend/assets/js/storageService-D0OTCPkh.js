var t=Object.defineProperty,e=(e,s,a)=>((e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a)(e,"symbol"!=typeof s?s+"":s,a);const s=new class{constructor(){e(this,"config"),e(this,"cache",new Map),e(this,"stats"),e(this,"initialized",!1),this.config={environment:"web",primary:"localStorage",enableCache:!0,cacheTimeout:3e5},this.stats={environment:"web",primary:"localStorage",cacheHits:0,cacheMisses:0,cacheHitRate:"0%",avgResponseTime:0,dataSize:"0 B"}}async init(t){t&&(this.config={...this.config,...t}),this.stats.environment=this.config.environment,this.stats.primary=this.config.primary,this.initialized=!0}async loadTeachers(){const t=Date.now();try{if(this.config.enableCache&&this.cache.has("teachers"))return this.stats.cacheHits++,this.updateCacheHitRate(),this.cache.get("teachers");this.stats.cacheMisses++;const e=localStorage.getItem("teachers"),s=e?JSON.parse(e):[];return this.config.enableCache&&this.cache.set("teachers",s),this.updateCacheHitRate(),this.updateResponseTime(Date.now()-t),s}catch(e){return[]}}async saveTeachers(t){const e=Date.now();try{const s=t.map(t=>({...t,updatedAt:(new Date).toISOString()}));localStorage.setItem("teachers",JSON.stringify(s)),this.config.enableCache&&this.cache.set("teachers",s),this.updateResponseTime(Date.now()-e),this.updateDataSize()}catch(s){throw s}}async saveScheduleResult(t){try{localStorage.setItem("scheduleResult",JSON.stringify(t)),this.config.enableCache&&this.cache.set("scheduleResult",t),this.updateDataSize()}catch(e){throw e}}async loadLatestScheduleResult(){try{if(this.config.enableCache&&this.cache.has("scheduleResult"))return this.stats.cacheHits++,this.updateCacheHitRate(),this.cache.get("scheduleResult");this.stats.cacheMisses++;const t=localStorage.getItem("scheduleResult"),e=t?JSON.parse(t):null;return this.config.enableCache&&e&&this.cache.set("scheduleResult",e),this.updateCacheHitRate(),e}catch(t){return null}}async clearAllData(){try{localStorage.clear(),this.cache.clear(),this.resetStats()}catch(t){throw t}}getStorageStats(){return{...this.stats}}updateCacheHitRate(){const t=this.stats.cacheHits+this.stats.cacheMisses;t>0&&(this.stats.cacheHitRate=`${Math.round(this.stats.cacheHits/t*100)}%`)}updateResponseTime(t){this.stats.avgResponseTime=Math.round((this.stats.avgResponseTime+t)/2)}updateDataSize(){try{const t=JSON.stringify(localStorage).length;this.stats.dataSize=this.formatBytes(t)}catch(t){this.stats.dataSize="未知"}}formatBytes(t){if(0===t)return"0 B";const e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}resetStats(){this.stats.cacheHits=0,this.stats.cacheMisses=0,this.stats.cacheHitRate="0%",this.stats.avgResponseTime=0,this.stats.dataSize="0 B"}},a=s;export{s as default,a as storageService,s as unifiedStorageService};
