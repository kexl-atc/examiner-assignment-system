# ====================================================
# 低配置环境专用配置
# 适用于: 4GB 内存 + 双核 CPU
# ====================================================

# 应用基本配置
quarkus.application.name=examiner-scheduler-low-memory
quarkus.application.version=3.1.2-low-memory

# ==================== HTTP 服务器优化 ====================
quarkus.http.port=8095
quarkus.http.host=0.0.0.0

# 低配置优化：减少线程数
# IO线程: 2（低配置）
quarkus.http.io-threads=2
# 工作线程: 4（低配置）
quarkus.http.worker-threads=4

# 限制请求大小
# 最大请求体 5MB
quarkus.http.limits.max-body-size=5M
# 最大头部 8KB
quarkus.http.limits.max-header-size=8K

# 超时配置
# 空闲超时 60秒
quarkus.http.idle-timeout=60s
# 读取超时 30秒
quarkus.http.read-timeout=30s

# ==================== 日志配置（精简） ====================
# 低配置优化：减少日志输出，节省IO和内存
# 只记录警告和错误
quarkus.log.level=WARN
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{1}] %s%e%n
quarkus.log.console.level=WARN

# 禁用文件日志（节省IO）
quarkus.log.file.enable=false

# 关键日志保持INFO级别
quarkus.log.category."com.examiner.scheduler".level=INFO
quarkus.log.category."org.optaplanner".level=INFO

# ==================== 数据库配置（文件数据库） ====================
quarkus.datasource.db-kind=h2
quarkus.datasource.jdbc.url=jdbc:h2:file:./data/examiner_db;DB_CLOSE_DELAY=-1

# 连接池配置（最小化）
# 最大连接数: 5
quarkus.datasource.jdbc.max-size=5
# 最小连接数: 1
quarkus.datasource.jdbc.min-size=1
# 初始连接数: 1
quarkus.datasource.jdbc.initial-size=1

# 连接超时
quarkus.datasource.jdbc.acquisition-timeout=5
quarkus.datasource.jdbc.idle-removal-interval=1M

# ==================== Hibernate 优化 ====================
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.sql-load-script=no-file

# 禁用SQL日志（节省性能）
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.log.jdbc-warnings=false

# 批处理优化
quarkus.hibernate-orm.jdbc.statement-fetch-size=20
quarkus.hibernate-orm.jdbc.statement-batch-size=10

# ==================== RESTEasy 配置 ====================
quarkus.resteasy-reactive.path=/api
quarkus.resteasy-reactive.fail-on-duplicate=false

# ==================== CORS 配置 ====================
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:*,https://localhost:*,file://
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=*
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-max-age=24H

# ==================== 线程池配置（低配置） ====================
# 核心线程: 2
quarkus.thread-pool.core-threads=2
# 最大线程: 8
quarkus.thread-pool.max-threads=8
# 队列大小: 100
quarkus.thread-pool.queue-size=100
# 增长阻力: 0（快速扩展）
quarkus.thread-pool.growth-resistance=0
# 线程保活: 30秒
quarkus.thread-pool.keep-alive-time=30S

# ==================== WebSocket 配置 ====================
# 最大帧大小: 1MB
quarkus.websocket.max-frame-size=1M
# 不分派到工作线程
quarkus.websocket.dispatch-to-worker=false

# ==================== 性能优化 ====================
# 禁用开发模式特性
quarkus.live-reload.instrumentation=false
quarkus.dev.instrumentation=false

# 禁用不需要的功能（节省内存）
# 禁用 Swagger UI
quarkus.swagger-ui.enable=false
# 禁用健康检查扩展
quarkus.health.extensions.enabled=false
# 禁用指标
quarkus.metrics.enabled=false
# 禁用 Jaeger 追踪
quarkus.jaeger.enabled=false

# ==================== OptaPlanner 配置 ====================
# 使用低配置优化的求解器
quarkus.optaplanner.solver-config-xml=solverConfig-low-memory.xml

# 约束流配置（内存优化）
quarkus.optaplanner.constraint-stream-impl-type=BAVET

# ==================== 其他优化 ====================
# 禁用不必要的扫描
quarkus.arc.exclude-types=io.netty.**,io.vertx.**

# 构建时优化
quarkus.package.type=fast-jar

# 原生镜像优化（如果使用GraalVM）
quarkus.native.additional-build-args=--initialize-at-run-time=org.h2.Driver

# ==================== 安全配置 ====================
# 禁用不必要的安全特性（内网使用）
quarkus.http.auth.basic=false

# ==================== 缓存配置 ====================
# 简单缓存配置
quarkus.cache.caffeine."default".maximum-size=100
quarkus.cache.caffeine."default".expire-after-write=10M

# ==================== 国际化配置 ====================
quarkus.default-locale=zh-CN
quarkus.locales=zh-CN

# ==================== Flyway 配置（如果使用） ====================
# 启用自动迁移
quarkus.flyway.migrate-at-start=true

# ==================== 启动优化 ====================
# 禁用启动横幅
quarkus.banner.enabled=false
# 禁用日志暗化
quarkus.log.console.darken=0
